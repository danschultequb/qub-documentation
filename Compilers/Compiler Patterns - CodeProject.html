<!DOCTYPE html>
<!-- saved from url=(0060)http://www.codeproject.com/Articles/286121/Compiler-Patterns -->
<html style="height: 100%;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Compiler Patterns - CodeProject</title> 
	<link type="text/css" rel="stylesheet" href="./Compiler Patterns - CodeProject_files/Main.min.css">

	

<meta name="Description" content="Traces the evolution of a high-speed EXPRESSION EVALUATOR to demonstrate the various PATTERNS you will need to &quot;roll your own&quot; recursive descent compiler.; Author: DQNOK; Updated: 6 Dec 2011; Section: Algorithms &amp; Recipes; Chapter: General Programming; Updated: 6 Dec 2011">
<meta name="Keywords" content="C, Intermediate, BNF,Algorithms &amp; Recipes,General Programming,Free source code, tutorials">
<meta name="Author" content="DQNOK">
<meta name="Rating" content="General">
<meta name="Revisit-After" content="1 days">
<meta name="application-name" content="CodeProject">
<meta name="google-translate-customization" content="d908bb7ce7aff658-4c2f3a504525c916-g629383f736781a8a-13">

<link rel="dns-prefetch" href="http://ajax.googleapis.com/"> 



<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - All Topics" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=1">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - Android" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=22">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - iOS" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=25">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - C++" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=2">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - C#" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=3">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - Web" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=23">
<link rel="alternate" type="application/rss+xml" title="CodeProject Lounge Postings" href="http://www.codeproject.com/webservices/LoungeRSS.aspx">
<meta name="robots" content="index, follow">
<link rel="search" type="application/opensearchdescription+xml" title="CodeProject" href="http://www.codeproject.com/info/OpenSearch.xml">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!--<base target="_top">--><base href="." target="_top">
	<link rel="icon" href="http://www.codeproject.com/favicon.ico" type="image/ico">
<link rel="shortcut icon" href="http://www.codeproject.com/favicon.ico" type="image/ico">
<link rel="apple-touch-icon" href="http://www.codeproject.com/images/FavIcon-Apple.png" type="image/png">
<script async="" type="text/javascript" src="./Compiler Patterns - CodeProject_files/gpt.js"></script><script type="text/javascript" language="Javascript">//<![CDATA[
function defrm () { /* thanks twitter */ document.write = ''; window.top.location = window.self.location;  setTimeout(function() { document.body.innerHTML = ''; }, 0);  window.self.onload = function(evt) { document.body.innerHTML = ''; }; }if (window.top !== window.self) {  try {  if (window.top.location.host) { /* will throw */ } else { defrm(); /* chrome */ }  } catch (ex) { defrm(); /* everyone else */ } }if (typeof(DemoUrl)!='undefined')   document.write(unescape('%3Cme')+'ta http'+'-equiv="re'+'fresh"                  con'+'tent="1;url='+DemoUrl+unescape('"%3CE'));
(function() { 
	var _dma = document.createElement('script');
        _dma.type = 'text/javascript';
        _dma.async = true;
        _dma.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'cdn2.developermedia.com/a.min.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(_dma);
})();

//]]>
</script><script type="text/javascript" async="" src="./Compiler Patterns - CodeProject_files/a.min.js"></script>

	




<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-1735123-1']);
	_gaq.push(['_trackPageview']);
	_gaq.push(['_setDomainName', 'www.codeproject.com']);
	_gaq.push(['_setSessionTimeout', '1200']); 

	(function () {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
	})(); 
</script><script type="text/javascript" async="" src="./Compiler Patterns - CodeProject_files/ga.js"></script>


<link type="text/css" rel="stylesheet" charset="UTF-8" href="./Compiler Patterns - CodeProject_files/translateelement.css"><script type="text/javascript" charset="UTF-8" src="./Compiler Patterns - CodeProject_files/main.js"></script><script type="text/javascript" charset="UTF-8" src="./Compiler Patterns - CodeProject_files/element_main.js"></script><script src="./Compiler Patterns - CodeProject_files/pubads_impl_83.js" async=""></script><script type="text/javascript" src="./Compiler Patterns - CodeProject_files/osd.js"></script></head>	

<body class="chrome chrome49" style="position: relative; min-height: 100%; top: 0px;">

<a class="access-link" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#Main"><img alt="Click here to Skip to main content" src="./Compiler Patterns - CodeProject_files/t.gif"></a>





<div class="page-background">

	
	

	

	
    <div id="ctl00_STM" class="site-top-menu fixed">
        <div class="main-content">
            

<div class="container memberbar clearfix">

	<div id="ctl00_MemberMenu_GenInfo" class="float-left">12,195,922 members (56,995 online)</div>

	<div class="float-left">
		
	</div>

	<div class="float-right">

		

		

		

			<script type="text/javascript">//<!--
			function doSubmit(secure)
			{
				if (secure)
					document.subForm.action = "https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f286121%2fCompiler-Patterns"
				else
					document.subForm.action = "https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f286121%2fCompiler-Patterns"
				document.subForm.submit();
				return true;
			}//-->
			</script>

			<a name="SignUp"></a>
			<span class="member-signin tooltip">
				<span><a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f286121%2fCompiler-Patterns">Sign in</a></span>

				<div class="tooltip-flyout">
					<form name="subForm" id="subForm" action="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f286121%2fCompiler-Patterns" method="post" class="tight">

						
						<input id="FormName" name="FormName" value="MenuBarForm" type="hidden">

						<div>Email</div>
						<div><input class="small-text" type="email" name="Email" id="Email"></div>
						<div>Password</div>
						<div><input class="small-text" type="password" name="Password" id="Password"></div>
						<div class="action">
							
<script type="text/javascript">
function Join(){
 var url = 'http://www.codeproject.com/script/Membership/Modify.aspx?meml=' + document.subForm.Email.value;
 document.location.href=url;return false;
}
document.write('<input type="button" class="create" onclick="return Join();" value="Join"');
document.write('<input type="hidden" name="fld_quicksign" value="true" />');
</script><input type="button" class="create" onclick="return Join();" value="Join" <input="" name="fld_quicksign">
							<input type="submit" value="Sign in" class="signin" onclick="return doSubmit(false);">
						</div>

						<div class="container">
							
							&nbsp;
							<a id="ctl00_MemberMenu_SendPassword" class="forgot float-right" href="http://www.codeproject.com/script/Membership/SendPassword.aspx?rp=%2fArticles%2f286121%2fCompiler-Patterns">Forgot your password?</a>
						</div>
					</form>

					<hr class="divider-dark">

					Sign in using <a class="oauth" title="Sign in using Facebook" href="http://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=Facebook"><img src="./Compiler Patterns - CodeProject_files/facebook.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>
<a class="oauth" title="Sign in using Google" href="http://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=Google"><img src="./Compiler Patterns - CodeProject_files/google-plus.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>
<a class="oauth" title="Sign in using Linkedin" href="http://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=LinkedIn"><img src="./Compiler Patterns - CodeProject_files/linkedin.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>
<a class="oauth" title="Sign in using Microsoft" href="http://www.codeproject.com/script/Membership/OAuthLogOn.aspx?auth=Microsoft"><img src="./Compiler Patterns - CodeProject_files/microsoft.png" style="vertical-align:middle;padding-right:3px;border:0;"></a>

				</div>
            </span>
		
	</div>
</div>
        </div>
    </div>

	
    <div id="ctl00_SH" class="site-header fixed">
        <div class="main-content">
            <div class="logo"><a href="http://www.codeproject.com/"><img id="ctl00_Logo" tabindex="1" title="CodeProject" src="./Compiler Patterns - CodeProject_files/logo250x135.gif" alt="Home" style="height:135px;width:250px;border-width:0px;"></a></div>
            <div class="promo"><div class="msg-728x90" data-format="728x90" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="General-Programming/Algorithms-Recipes/Compilers" data-tags="C, Intermediate, BNF,rating4.5"><div id="div-gpt-ad-lqm.codeproject.site/general-programming/algorithms-recipes/compilers-1" style="height: 90px; width: 728px; box-sizing: border-box; border: 0px; font-size: 0px;"><div id="google_ads_iframe_/6839/lqm.codeproject.site/general-programming/algorithms-recipes/compilers_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/6839/lqm.codeproject.site/general-programming/algorithms-recipes/compilers_0" title="3rd party ad content" name="google_ads_iframe_/6839/lqm.codeproject.site/general-programming/algorithms-recipes/compilers_0" width="728" height="90" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:&quot;&lt;html&gt;&lt;body style=&#39;background:transparent&#39;&gt;&lt;/body&gt;&lt;/html&gt;&quot;" style="border: 0px; vertical-align: bottom;"></iframe></div><iframe id="google_ads_iframe_/6839/lqm.codeproject.site/general-programming/algorithms-recipes/compilers_0__hidden__" title="" name="google_ads_iframe_/6839/lqm.codeproject.site/general-programming/algorithms-recipes/compilers_0__hidden__" width="0" height="0" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:&quot;&lt;html&gt;&lt;body style=&#39;background:transparent&#39;&gt;&lt;/body&gt;&lt;/html&gt;&quot;" style="border: 0px; vertical-align: bottom; visibility: hidden; display: none;"></iframe></div></div></div>
        </div>
    </div>

	<a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#Main"><img alt="Click here to Skip to main content" class="access-link" src="./Compiler Patterns - CodeProject_files/t.gif"></a>

	
	<div id="ctl00_TPR" class="sub-headerbar clearfix fixed">
    <div class="float-right">
		

<div class="searchbar">

<form method="get" action="http://www.codeproject.com/search.aspx?sbo=kw" name="Search" class="tight">


<table border="0" cellspacing="0" cellpadding="0" class="search"><tbody><tr><td><input tabindex="2" class="search  subdue" id="sb_tb" value="" name="q"></td><td><input type="image" src="./Compiler Patterns - CodeProject_files/search.gif"></td></tr></tbody></table>

<div class="hover-container">
	<div id="SearchFilter" class="search-advanced small-text align-left" style="display: none;">
	<b>Search within:<br></b>
		
		<input type="radio" id="sb_kw" name="sbo" value="kw" checked="true"><label for="sb_kw">Articles</label><br>
<input type="radio" id="sb_qa" name="sbo" value="qa"><label for="sb_qa">Quick Answers</label><br>
<input type="radio" id="sb_fm" name="sbo" value="fm"><label for="sb_fm">Messages</label><br>


		
		

		
		
	</div>
</div>
</form>

</div>
    </div>
    <div class="float-left">
		

<div class="navbar clearfix">
<ul class="navmenu openable">

<li class="desktop-only"><a id="ctl00_TopNavBar_Home" href="http://www.codeproject.com/">home</a>


</li><li class=""><a id="ctl00_TopNavBar_Art" class="down selected" href="http://www.codeproject.com/script/Articles/Latest.aspx">articles</a>

	<ul>
		<li class=""><a id="ctl00_TopNavBar_ArtTopicList" class="fly" onmouseover="navBarMenu.ShowMap(this, &#39;ctl00_TopNavBar_MapFlyout&#39;);" href="http://www.codeproject.com/script/Content/SiteMap.aspx">Chapters and Sections<span class="has-submenu">&gt;</span></a><ul id="ctl00_TopNavBar_MapFlyout">
			<li>
				<div id="siteMap">
					<img src="./Compiler Patterns - CodeProject_files/animated.gif" alt="loading" style="margin:150px;width:100px;height:100px;">
				</div>
			</li>
			</ul>
		</li>
		<li><a id="ctl00_TopNavBar_ArtSearch" class="fly break" href="http://www.codeproject.com/search.aspx?sbo=kw">Search</a></li>
		<li><a id="ctl00_TopNavBar_ArtLatestArts" class="fly" href="http://www.codeproject.com/script/Articles/Latest.aspx?at=1,3,7">Latest Articles</a></li>
		<li><a id="ctl00_TopNavBar_ArtLatestTips" class="fly" href="http://www.codeproject.com/script/Articles/Latest.aspx?at=6">Latest Tips/Tricks</a></li>
		<li><a id="ctl00_TopNavBar_ArtTop" class="fly" href="http://www.codeproject.com/script/Articles/TopArticles.aspx?ta_so=5">Top Articles</a></li>
		<li><a id="ctl00_TopNavBar_ArtBeginner" class="fly" href="http://www.codeproject.com/search.aspx?sbo=kw?aidlst=152&amp;sa_us=True">Beginner Articles</a></li>
		<li><a id="ctl00_TopNavBar_ArtBlogArticles" class="fly break" href="http://www.codeproject.com/script/Articles/BlogArticleList.aspx">Technical Blogs</a></li>
		<li><a id="ctl00_TopNavBar_ArtGuide" class="fly" href="http://www.codeproject.com/info/Submit.aspx">Posting/Update Guidelines</a></li>
		<li><a id="ctl00_TopNavBar_ArtHelpForum" class="fly" href="http://www.codeproject.com/Forums/1641/Article-Writing.aspx">Article Help Forum</a></li>
		<li><a id="ctl00_TopNavBar_ArtCompetition" class="fly break" href="http://www.codeproject.com/script/Awards/CurrentCompetitions.aspx?cmpTpId=1">Article Competition</a></li>
		<li><a id="ctl00_TopNavBar_ArtPostArticle" class="fly highlight1" href="http://www.codeproject.com/script/Articles/Submit.aspx">
			<img src="./Compiler Patterns - CodeProject_files/write13.png" width="13px" height="13px"> Submit an article or tip
			</a></li>
		<li><a id="ctl00_TopNavBar_ArtPostBlog" class="fly highlight2" href="http://www.codeproject.com/script/Articles/BlogFeed.aspx">
			<img src="./Compiler Patterns - CodeProject_files/write13.png" width="13px" height="13px"> Post your Blog
			</a></li>		<li class="last"></li>
	</ul>

</li>



<li class="">
<a id="ctl00_TopNavBar_Answers" href="http://www.codeproject.com/script/Answers/List.aspx?tab=active">
    <span class="desktop-only tablet-only">quick answers</span><span class="mobile-only">Q&amp;A</span>
</a>
	<ul>
		<li id="ctl00_TopNavBar_AQL"><a id="ctl00_TopNavBar_ArticleQuestion" class="fly highlight1" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#_comments">
			<img src="./Compiler Patterns - CodeProject_files/write13.png" width="13px" height="13px"> Ask a Question about this 
			article</a>
		</li>

		<li><a id="ctl00_TopNavBar_QAAsk" class="fly highlight2" href="http://www.codeproject.com/Questions/ask.aspx"><img src="./Compiler Patterns - CodeProject_files/write13.png" width="13px" height="13px"> Ask a Question</a></li>

		
		<li><a id="ctl00_TopNavBar_QAUnanswered" class="fly" href="http://www.codeproject.com/script/Answers/List.aspx?tab=unanswered">View Unanswered Questions</a></li>
		<li><a id="ctl00_TopNavBar_QALatest" class="fly" href="http://www.codeproject.com/script/Answers/List.aspx?tab=active">View All Questions...</a></li>
		
				<li><a id="ctl00_TopNavBar_QATR_ctl00_Tag" class="fly" href="http://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=120" style="padding-left:30px">Linux questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl01_Tag" class="fly" href="http://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=81" style="padding-left:30px">C# questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl02_Tag" class="fly" href="http://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=85" style="padding-left:30px">ASP.NET questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl03_Tag" class="fly" href="http://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=93" style="padding-left:30px">SQL questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl04_Tag" class="fly" href="http://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=842" style="padding-left:30px">VB.NET questions</a></li>
			
		<li class="last"></li>
	</ul>

</li>



<li class=""><a id="ctl00_TopNavBar_Forums" href="http://www.codeproject.com/script/Forums/List.aspx">
        <span class="desktop-only tablet-only">discussions</span><span class="mobile-only">forums</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_MessageBoardsAll" class="fly" href="http://www.codeproject.com/script/Forums/List.aspx">All Message Boards...</a></li>
		<li class=""><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1580997/Application-Lifecycle.aspx">Application Lifecycle<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="http://www.codeproject.com/Forums/1533717/Running-a-Business.aspx">Running a Business</a></li>
<li><a class="fly" href="http://www.codeproject.com/Forums/1533716/Sales-Marketing.aspx">Sales / Marketing</a></li>
<li><a class="fly" href="http://www.codeproject.com/Forums/1651/Collaboration-Beta-Testing.aspx">Collaboration / Beta Testing</a></li>
<li><a class="fly" href="http://www.codeproject.com/Forums/3304/Work-Issues.aspx">Work  Issues</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/369270/Design-and-Architecture.aspx">Design and Architecture</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/12076/ASP-NET.aspx">ASP.NET</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1580226/JavaScript.aspx">JavaScript</a>
</li>
<li class=""><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1647/C-Cplusplus-MFC.aspx">C / C++ / MFC<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="http://www.codeproject.com/Forums/4486/ATL-WTL-STL.aspx">ATL /  WTL / STL</a></li>
<li><a class="fly" href="http://www.codeproject.com/Forums/3785/Managed-Cplusplus-CLI.aspx">Managed C++/CLI</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1649/Csharp.aspx">C#</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1627782/Free-Tools.aspx">Free Tools</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1827460/Objective-C-and-Swift.aspx">Objective-C and Swift</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1725/Database.aspx">Database</a>
</li>
<li class=""><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/186301/Hardware-Devices.aspx">Hardware &amp; Devices<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="http://www.codeproject.com/Forums/1644/System-Admin.aspx">System Admin</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1606152/Hosting-and-Servers.aspx">Hosting and Servers</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1643/Java.aspx">Java</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1650/NET-Framework.aspx">.NET Framework</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1848626/Android.aspx">Android</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1876716/iOS.aspx">iOS</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/13695/Mobile.aspx">Mobile</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1540733/SharePoint.aspx">SharePoint</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1004257/Silverlight-WPF.aspx">Silverlight / WPF</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1646/Visual-Basic.aspx">Visual Basic</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1640/Web-Development.aspx">Web Development</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/suggestions.aspx">Site Bugs / Suggestions</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1652005/Spam-and-Abuse-Watch.aspx">Spam and Abuse Watch</a>
</li>

		<li class="last"></li>
	</ul>

</li>

<li class="desktop-only"><a id="ctl00_TopNavBar_Features" href="http://www.codeproject.com/Feature/">features</a>

	<ul>
		<li><a id="ctl00_TopNavBar_Comps" class="fly" href="http://www.codeproject.com/script/Awards/CurrentCompetitions.aspx?cmpTpId=1&amp;awsac=true">Competitions</a></li>
		<li><a id="ctl00_TopNavBar_News" class="fly" href="http://www.codeproject.com/script/News/List.aspx">News</a></li>
		<li><a id="ctl00_TopNavBar_Insider" class="fly" href="http://www.codeproject.com/Feature/Insider/">The Insider Newsletter</a></li>
    	<li><a id="ctl00_TopNavBar_DailyBuild" class="fly" href="http://www.codeproject.com/Feature/DailyBuild">The Daily Build Newsletter</a></li>
		<li><a id="ctl00_TopNavBar_Newsletters" class="fly" href="http://www.codeproject.com/script/Mailouts/Archive.aspx?mtpid=1">Newsletter archive</a></li>
		<li><a id="ctl00_TopNavBar_Surveys" class="fly" href="http://www.codeproject.com/script/Surveys/List.aspx">Surveys</a></li>
		<li><a id="ctl00_TopNavBar_Showcase" class="fly" href="http://www.codeproject.com/KB/showcase/">Product Showcase</a></li>
		<li><a id="ctl00_TopNavBar_Research" class="fly" href="http://www.codeproject.com/script/ResearchLibrary/Index.aspx">Research Library</a></li>

		<li><a id="ctl00_TopNavBar_Stuff" class="fly" href="http://www.codeproject.com/Info/Stuff.aspx">CodeProject Stuff</a></li>
		<li class="last"></li>
	</ul>

</li>


<li class=""><a id="ctl00_TopNavBar_Lounge" href="http://www.codeproject.com/Lounge.aspx">
            <span class="desktop-only tablet-only">community</span><span class="mobile-only">lounge</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_WhosWho" class="fly" href="http://www.codeproject.com/script/Membership/Profiles.aspx">Who's Who</a></li>
		<li><a id="ctl00_TopNavBar_MVPs" class="fly break" href="http://www.codeproject.com/script/Awards/MVPWinners.aspx">Most Valuable Professionals</a></li>
		

		<li><a id="ctl00_TopNavBar_LoungeLnk" class="fly highlight2" href="http://www.codeproject.com/Lounge.aspx">The Lounge &nbsp;</a></li>
		<li><a id="ctl00_TopNavBar_InsiderLnk" class="fly" href="http://www.codeproject.com/Insider.aspx">The Insider News</a></li>
		<li><a id="ctl00_TopNavBar_WeirdWonderful" class="fly" href="http://www.codeproject.com/Feature/WeirdAndWonderful.aspx">The Weird &amp; The Wonderful</a></li>
		<li><a id="ctl00_TopNavBar_SoapBoxLnk" class="fly" href="http://www.codeproject.com/Forums/1536756/The-Soapbox.aspx">The Soapbox</a></li>
		<li><a id="ctl00_TopNavBar_PRLnk" class="fly break" href="http://www.codeproject.com/Forums/1738007/Press-Releases.aspx">Press Releases</a></li>

		
		<li class=""><a class="fly" href="http://www.codeproject.com/Forums/1580229/Hindi.aspx">Non-English Language
			<span class="has-submenu">&gt;</span></a>
		<ul>
		<li><a class="fly" href="http://www.codeproject.com/Forums/1580229/Hindi.aspx">General Indian Topics</a></li>
		<li><a class="fly" href="http://www.codeproject.com/Forums/1580230/Chinese.aspx">General Chinese Topics</a></li>
		</ul>
		</li><li class="last"></li>
		
	</ul>

</li>


<li class="desktop-only tablet-only" style="margin-left:20px"><a id="ctl00_TopNavBar_Help" href="http://www.codeproject.com/KB/FAQs/">help</a>

	<ul>
		<li><a id="ctl00_TopNavBar_HelpWhatIs" class="fly" href="http://www.codeproject.com/info/guide.aspx">What is 'CodeProject'?</a></li>
		<li><a id="ctl00_TopNavBar_HelpGeneral" class="fly break" href="http://www.codeproject.com/KB/FAQs/">General FAQ</a></li>
		<li><a id="ctl00_TopNavBar_HelpPostQuestion" class="fly break highlight2" href="http://www.codeproject.com/Questions/ask.aspx">Ask a Question</a></li>
		<li><a id="ctl00_TopNavBar_HelpBugs" class="fly" href="http://www.codeproject.com/suggestions.aspx">Bugs and Suggestions</a></li>
		<li><a id="ctl00_TopNavBar_HelpArticles" class="fly" href="http://www.codeproject.com/Forums/1641/Article-Writing.aspx">Article Help Forum</a></li>
		<li><a id="ctl00_TopNavBar_HelpSiteMap" class="fly" href="http://www.codeproject.com/script/Content/SiteMap.aspx">Site Map</a></li>
		<li><a id="ctl00_TopNavBar_HelpAdvertise" class="fly" href="http://developermedia.com/">Advertise with us</a></li>
		<li><a id="ctl00_TopNavBar_HelpJobs" class="fly" href="http://www.codeproject.com/info/Jobs/">Employment Opportunities</a></li>
		<li><a id="ctl00_TopNavBar_HelpAboutUs" class="fly" href="http://www.codeproject.com/info/about.aspx">About Us</a></li>
		<li class="last"></li>
	</ul>

</li>

</ul>

</div>
    </div>
	<div class="sub-headerbar-divider"></div>
	</div>		
	

	<div id="A" class="container-content-wrap fixed"> 

	<div itemscope="" itemtype="http://schema.org/Article" class="container-content"> 


		<div class="clearfix">
			<div class="container-breadcrumb float-left ">
				<div><a href="http://www.codeproject.com/script/Content/SiteMap.aspx">Articles</a> » <a href="http://www.codeproject.com/Chapters/6/General-Programming.aspx">General Programming</a> » <a href="http://www.codeproject.com/KB/recipes/"><span itemprop="articleSection">Algorithms &amp; Recipes</span></a> » <a href="http://www.codeproject.com/KB/recipes/#Compilers">Compilers</a></div>
			</div>

			<div class="float-left">
				
			</div>

			<div class="edit-links float-right">
				


 
&nbsp;










			</div>

			<div class="article-nav float-right">
					
		        
		        
					

                
				

<a id="ctl00_ActionLinks_BookmarkMd_ImgBt" title="Bookmark" alternatetext="Bookmark" name="bm_286121_2" onclick="return bookmarkMe(286121,2,&#39;/script/Bookmarks/Ajax/Add.aspx?obid=286121&amp;obtid=2&amp;action=AddBookmark&amp;bio=true&amp;bis=medium&#39;,&#39;medium&#39;);" href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=286121&amp;obtid=2&amp;action=AddBookmark&amp;bio=true&amp;bis=medium" style="display:inline-block;height:24px;width:24px;"><img title="Bookmark" src="./Compiler Patterns - CodeProject_files/bookmark24.png" alt="" style="border-width:0px;"></a>


<span id="ctl00_ActionLinks_BookmarkMd_StatusMsg" class="tiny-text" style="display:none" name="bm_286121_2"></span>
<a id="ctl00_ActionLinks_PrintMd" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?display=Print">
	<img src="./Compiler Patterns - CodeProject_files/print24.png" title="Print" width="24px" height="24px" style="border:0">
</a>
			</div>
		</div>

		<table class="extended container-article-parts" cellpadding="0" cellspacing="0">
        <tbody><tr valign="top">
		<td width="117px" class="article-wing-left">

			<div id="ctl00_Nav" class="container-article-tabs" style="position: static; top: 235px; left: 203.5px;">
    			

<div class="tabs">
	<div class="selected">Article</div><div class="unselected"><a href="http://www.codeproject.com/script/Articles/ViewDownloads.aspx?aid=286121">Browse Code</a></div><div class="unselected"><a href="http://www.codeproject.com/script/Articles/Statistics.aspx?aid=286121">Stats</a></div><div class="unselected"><a href="http://www.codeproject.com/script/Articles/ListVersions.aspx?aid=286121">Revisions (5)</a></div><div class="unselected"><a href="http://www.codeproject.com/script/Articles/ListAlternatives.aspx?aid=286121">Alternatives</a></div>

	<div class="unselected"><a href="http://www.codeproject.com/Articles/286121/WebControls/#_comments" id="ctl00_ArticleTabs_CommentLink" class="anchorLink">Comments 
        <span id="ctl00_ArticleTabs_CmtCnt">(13)</span></a>
	</div>
</div>	


				<a id="ctl00_AddAlternative" title="Write a related article about upgrades or translate this into a different language." class="add-item" href="http://www.codeproject.com/script/Articles/SubmissionWizard.aspx?at=1&amp;apid=286121">Add your own<br>alternative version</a>

			    <div class="tags"> 
                    <h4>Tagged as</h4>
                    
                    <div class="tags">
<span class="t"><a href="http://www.codeproject.com/search.aspx?sbo=kw&amp;aidlst=80">C</a></span><span class="t"><a href="http://www.codeproject.com/search.aspx?sbo=kw&amp;aidlst=1114">BNF</a></span></div>
			    </div>
                

                <div class="stats">
                <h4>Stats</h4>
                <div id="ctl00_ArtStats"><div class="stats"><div>21.8K views</div><div>548 downloads</div><div>57 bookmarked</div></div></div>
                </div>

                <div class="subdue padded-top" title="Date First posted">Posted 
                    <span itemprop="datePublished" content="2011-11-18">18 Nov 2011</span></div>

                
			</div>

		</td>
		<td>
			
			<div id="AT" class="container-article  fixed"> 

				<div class="article">

					<form name="aspnetForm" method="post" action="http://www.codeproject.com/Articles/286121/Compiler-Patterns" id="aspnetForm" style="margin:0;padding:0">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="ZpcMpMG+lVkmHsrHdogoJy8kAcNYHA8GPDbSVQJABCWnRFMCssRS8IOnmTaOuP7N2i1dz4/k7fwhlWtK1zdRbbdzV0Hn+iYRg7RtidcvzQMFuJ9jtZv317qOcg28NtpzJBjCjmkcD2q6PnrWB2LIi10laQHQu4RrvJY701VdjToUO190hpYTOCOueW0VJzRtYzEx7Q+sJgSYjZk7FtytdXIF8YdDRBjKmHbLnIv1aadUIi4Tn3H6FA8taFc0kChP9+9qzDT+qFyLc5EWus1fEnSIKEFDrpgr75Z8P9W4nFjl7rTd7IQYsqHv5sJ6dPiXgtOBdEeoIvcARDoz1Qy1DyRxjPTItQ/rpwPdc9r13F56cMRdNP7e/uwJuvqc+uHFmMVFoLPTybRoQ1UMbyHOW9dnTeWpoTSoUkKWI5EQaVOE/Ei41NM9BdIP/F1XeYOk4504K9qtrp+2B2NClI3xFHYK+5cH02EzJ7r5WURRxlX4oDF4JLZL9zYKAFNDpHKzRoKHTDrJGg0/BX4ucSB2PDXZYQgKIRicm/KXaJaqbKee4pfLzEOT2XiSIgq7QizzHv9JqnJYiUpO9KI0eubIgGzq1mF2f2+ZwY15sWl7pACvkch7Lmn9tNirZIhgjrtkDU2ijmsvrB+/cjES/23QDzgu77GBxZSWZbBZYQCa/OPjny0wsuCPw32f38RyLIDz0WSqFcwPSGFpsp3ZS01osnKNgy+my7xmZ64959TxZJ1edWllKP1ZqqZw1Gm0U8KbO5wTDkz9EjZ0lrx4Bz9VvTt9Qh1AeUn9jaWfbpSRpSaforrdw6sfDqIHAxjLlgQpIxRJAPAWvde+/xNJdMclH6mV80J7caE3d7JLLaDaawmaQJNhDrdXfbVQ7fwsBwfMygd6zc2xmNxYitsQDmDEvYUw636I6NGN5u8wE4jeotpl/HXfpv2808oSryTV2Y2GurfjzLGaDI0S5NqtGzDQCfsdqt0MhE1st5hZ02Qj8057eVmi+3pDIyB/KSp0EYmsu0lxUpnhasodYEOIxXdBy9oaNNMjzfN8kNVZNqNkFv3RsaqqsHYQCg/5d3m85QJoGlDu0Ni+cyF6wYHveW2tkVbIT46R1DjSTB6baOZPt/BCojlCZt+I04cht2HZzNKK7tADLCVfj9KzyCv63dgCcz4DsXzGvLxo9C+HXQ3FGEFQLSFFB1xerl41N4fl2rwLcU1dkACRhcMCbVhUhCQ0Kqe8ItN5tPXIMBETSfmWxEbawHV7XKt4IotzhLXqWfyPa+CxJuS+2v+r72D2EbZlJrJknL4y6hEnhASxM6FfxcDB4OQTPPbSjfCObTMc+OcIy7OTuQEdfRVNUgF8E4rg1yHtlicQGbSMz8NXgFeT5FRTLLYyHLMZWDcwix59XwnDoV3Uu86sSf3Agc+SN2oDD51Xz9lscbOrzUL2ekCLiO91Bc5XF8uCjiGCq0EsMlVLRs3bYnNUxuLyvA8V06vm3P+PJzAglydq+P2pBIVDY/0cyX9jzfIuaN/jgmtzY7CZMLfvKiLmAN4aekLlktpuEYZRuvlm0k5SWBvbqVdFXSq6WS1lSa0FObdXpLkwacuy2NG5P7V5IQ3Ce1QWR6iNUbB9UgJ9Dvc3TT8iInpYqZ6179i8KpAGqRnl17zRCuH8N96CuPAGNX60I3pVo5O/SuzwuHFJDbF0wjMU4qP8A/boRtnvxAWcyFg0ytV8wBPe0y3AQZ+6cokyAGxihm1PyRNLZsSRbJ+WZ8NYyNSiFwpdUgo9MOIy0cwmIMFhtpBF/EzEF/le7lGBplAZHS+z3+E5M6vfb2cuo/FwPHn1QJdaxUrhUlQVcS50AZpr7Ow1iOQIf707pRlOqz3uebnRAdAzeGqCdBl46GSISjLwkHjjUQIjWBzYJp2mcuBibqRznHxkNW0spllsBBhsTtGr+HlKXj58I2TxHO5YClk9B73eM7GEVTwDBe5UyQkbhRjdxPNorQQv1pwXySH7m1tNN6JlHDaVTzapypKU+OwqtUuMizL08NCPylIQrPS+2pKsKl0GFiztMJIJMH34w041yfchSUnmK0o9C2JQwzgfuvYZARG2WOieeXS7oMVSfruHk6h6uDfYjYSpYxZSDo05lr6USVFdQsibNnEmbTKfSHFg5QaWwAC3+tI3+IqLqXBtUTq5/cE6lkl1efjSm9gUbPk1/2IyXzBITZbUNFUjgQaduqPnXp4UMcF1/E3A3M6xIwIn+HkidsFoDc1lum7zarcNx4e65bC04PGcZ1fSDkYO5dg+eeBjfQ7WeX4twnI3bKH27zySXcqDqxg7KOgn5gwEd3ZWMx0FbgfBM2dgKvrabVDSfwp7gyUO0mJxmCo1df8tWTfY+PgGAtftyzgHbK0HjBb3/adPVLj+EW+tC2QP1qi9sd/GCBPA8AA0nXPqqF3RHa7WHaqoEKFosl15F1oYRxY=">
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="10C1FD69">
</div>

					
					 
					<div class="header">
					    <a name="Main"></a>

					    
					    <a name="_articleTop" id="_articleTop"></a>
					    <div class="title">
					        
					        <h1 id="ctl00_ArticleTitle" itemprop="name">Compiler Patterns</h1> 
					    </div>

                        <div style="height:34px">
					        
					        <div class="entry float-left">
                                
                                <div class="float-left">

						            <span class="author"><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=3403440" rel="author"><span itemprop="author" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">DQNOK</span></span></a></span>, 
						            <span class="date" itemprop="dateModified" title="Date last updated" content="2011-12-06 11:54:00">
							            6 Dec 2011</span>
			
                                    <a id="ctl00_LicenseLink" title="The Code Project Open License (CPOL)" class="license" href="http://www.codeproject.com/info/cpol10.aspx">CPOL</a><div id="ctl00_CurRat" class="tooltip anchorLink" style="cursor:pointer;margin-top: 5px" name="CurRat_286121">
				
							            

<table cellpadding="0" cellspacing="0" class="small-text" itemprop="aggregateRating" itemscope="" itemtype="http://schema.org/AggregateRating"> 
<tbody><tr>
	
	<td class="nowrap">

		
			<meta itemprop="bestRating" content="5"> 
			<meta itemprop="worstRating" content="1">
		

		<span id="ctl00_ArticleRating_VI">
		<div class="nowrap rating-stars-medium" style="height:18px;width:80px;position:relative;">
	<div class="clipped align-left float-left" style="height:16px;width:78px;">
		<img src="./Compiler Patterns - CodeProject_files/stars-fill-md.png" style="border-width:0px;">
	</div><div class="clipped" style="height:16px;width:2px;position:relative;">
		<img src="./Compiler Patterns - CodeProject_files/stars-empty-md.png" style="border-width:0px;position:absolute;top:0;right:0;">
	</div>
</div>
		</span>

		
	</td>
	
	<td id="ctl00_ArticleRating_VR" class="nowrap">
		&nbsp;
		<span id="ctl00_ArticleRating_VotesR">&nbsp;<span itemprop="ratingValue" class="rating">4.93</span> (<span itemprop="ratingCount" class="count">28</span> votes)</span>
		
	</td>

</tr>

</tbody></table>


							            <div id="ctl00_RB" class="speech-bubble-container-up">
								            <div class="speech-bubble-up" style="width:150px !important">
									                        
<div>
<table class="feature" width="100%" height="50px" title="Voting Distribution. Recent data only" cellpadding="0" cellspacing="0"><tbody><tr class="chart-row"><td class="chart-column"><span title="0 votes">1</span></td>
<td class="chart-column"><span title="0 votes">2</span></td>
<td class="chart-column"><span title="0 votes">3</span></td>
<td class="chart-column"><div><img src="./Compiler Patterns - CodeProject_files/pollcol.gif" width="20pxpx" height="6px" border="0px" alt="3 votes, 10.7%" title="3 votes, 10.7%"></div><span title="3 votes">4</span></td>
<td class="chart-column"><div><img src="./Compiler Patterns - CodeProject_files/pollcol.gif" width="20pxpx" height="50px" border="0px" alt="25 votes, 89.3%" title="25 votes, 89.3%"></div><span title="25 votes">5</span></td>
</tr></tbody></table><div class="small-text align-center">4.93/5 - 28 votes</div><div class="small-text align-center subdue">μ 4.93, σ<sub>a</sub> 1.03 [<a href="http://www.codeproject.com/KB/FAQs/RatingReputationFAQ.aspx#noisefilter">?</a>]</div>
</div>
								            </div>
								            <div class="speech-bubble-pointer-up">
									            <div class="speech-bubble-pointer-up-inner"></div>
								            </div>
							            </div>
						            </div>
                                </div>
					        </div>

                            
						    <div id="ctl00_RateArticleRow" class="float-right align-right voting-bar">
						        <div id="ctl00_RateArticle_RateItemWrapper" class="small-text" name="RateItem_286121">

	<table width="100%" cellpadding="0" cellspacing="0" class="small-text">
	<tbody><tr>
		<td id="ctl00_RateArticle_VoteResultDiv" class="rating-result align-right">
			<span class="align-right"></span>
			<img class="loaderImg" width="16px" alt="loading..." height="16px" src="./Compiler Patterns - CodeProject_files/animated_loading_blue.gif" style="display:none;"> 
		</td>

	
		<td class="voteTbl" style="white-space:nowrap" align="right">
			<table class="small-text">
			<tbody><tr>
				<td id="ctl00_RateArticle_RateText" class="rating-prompt">
					Rate this:
				</td>

				
				<td id="ctl00_RateArticle_VoteFormDiv" class="nowrap rating-stars-voter-large">
					

					<span id="ctl00_RateArticle_RB" class="tooltip ajaxHist radio voting">
						<span id="ctl00_RateArticle_VoteRBL"><input id="ctl00_RateArticle_VoteRBL_0" type="radio" name="ctl00$RateArticle$VoteRBL" value="1" style="display: none;"><input id="ctl00_RateArticle_VoteRBL_1" type="radio" name="ctl00$RateArticle$VoteRBL" value="2" style="display: none;"><input id="ctl00_RateArticle_VoteRBL_2" type="radio" name="ctl00$RateArticle$VoteRBL" value="3" style="display: none;"><input id="ctl00_RateArticle_VoteRBL_3" type="radio" name="ctl00$RateArticle$VoteRBL" value="4" style="display: none;"><input id="ctl00_RateArticle_VoteRBL_4" type="radio" name="ctl00$RateArticle$VoteRBL" value="5" style="display: none;"></span> 

						
					<div class="rating-star-block"><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" rating="1" class="star outline" title="vote 1">vote 1</a><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" rating="2" class="star outline" title="vote 2">vote 2</a><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" rating="3" class="star outline" title="vote 3">vote 3</a><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" rating="4" class="star outline" title="vote 4">vote 4</a><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" rating="5" class="star outline" title="vote 5">vote 5</a></div></span>

				</td>

				
				<td style="padding-left:5px">	
					<input type="submit" name="ctl00$RateArticle$SubmitRateBtn" value="Vote!" id="ctl00_RateArticle_SubmitRateBtn" class="button" style="display: none;">
				</td>
			</tr>
			</tbody></table>
			
		</td>
	</tr>
	</tbody></table>
	<div class="hover-container">
		
        <div id="ctl00_RateArticle_RSU" class="rating-comment align-left float-right">
            <div class="padded">
            Please <a id="ctl00_RateArticle_SignUp" href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f286121%2fCompiler-Patterns">Sign up or sign in</a> to vote.
            </div>
        </div>
	</div>
</div>
						    </div>
						    	
                        </div>

   					    
                        <div id="ctl00_description" class="summary" itemprop="headline">Traces the evolution of a high-speed EXPRESSION EVALUATOR to demonstrate the various PATTERNS you will need to "roll your own" recursive descent compiler.</div><span id="ctl00_thumbnailUrl" class="date" itemprop="image" content="http://www.codeproject.com/KB/recipes/CompilerPatterns/Thumb-286121.png"></span>			

                    </div>
                    
					
					

					

					
					
					

						
					

					

						
						<div id="contentdiv" class="text" itemprop="articleBody">
						



<ul class="download">
<li><a href="http://www.codeproject.com/KB/recipes/CompilerPatterns/expression_src.zip">Download source - 29.02 KB</a> </li>
</ul>
<img style="WIDTH: 640px; HEIGHT: 845px" alt="Sample Image Screenshot" src="./Compiler Patterns - CodeProject_files/image001_small.png" width="640" height="845" complete="true"> 
<h2>Summary</h2>

<p>Depending on the complexity of the grammar, a hand-built recursive descent compiler may actually be the best option. It can be quicker to implement than learning a compiler-compiler system, plus it avoids having to integrate the compiler-compiler's runtime into your source code base. But it also involves risks that must be carefully weighed. </p>

<h2>Introduction</h2>

<p>Many years ago, smart people recognized that building compilers was tough. BUT, they also recognized that there were many repeated patterns within the code for compilers. And where there is the combination of smart people, AND patterns, software magically evolves*. Thus was born "compiler-compilers" to assist in converting grammar specifications into compilers without the tedium of writing the same code over and over for those patterns. Famous among these compiler-compilers is YACC -- Yet Another Compiler Compiler.</p>

<p>This article demonstrates a few of the patterns of compilers, and how to go about implementing a simple compiler WITHOUT a compiler-compiler. To help make the ideas concrete, we work through the task of building an expression evaluator.</p>

<p>This is NOT a tutorial on compiler theory or on language design. There are several textbooks on that subject. Plus there's always that repository of all useful knowledge, <a href="http://en.wikipedia.org/wiki/Formal_grammar">Wikipedia</a> if you want that. Rather, this article is a pragmatic look at the patterns that go into building a simple recursive descent compiler. If you want, you can download the full <a href="http://www.codeproject.com/Articles/286121/expression_src.zip">source code</a> for the expression evaluator.</p>

<p>But first, some important preliminaries: Before reading this article thinking that you're going to implement a compiler, follow this flowchart:</p>

<div class="pre-action-link" id="premain333841" style="width:100%;display:block;"><span id="prehide333841" onclick="processCodeBlocks.togglePre(333841);">Hide</span>  &nbsp; <span id="preShrink333841" onclick="processCodeBlocks.shrinkExpand(333841);">Shrink</span> <img id="preimg333841" src="./Compiler Patterns - CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(333841);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(333841);">Copy Code</span></div><pre lang="text" id="pre333841" processed="true" style="margin-top: 0px;">Do you need to implement a fairly simple parser/compiler?
- no
  { save a link to this article, and come back when you need it.
    If you're anything like me, you won't remember enough of the
    details to make it worth reading anyway.  Heck, I wrote it,
    and I don't even remember what's in here!
  }
- yes
  { Can you afford to hire someone who really understands
    compilers?
    - yes
      { just do it!  Save yourself a lot of pain.
      }
    - no
      { Do you have enough time to learn to use a good
        compiler-compiler?
        - yes
          { this is probably the smart move.  Good compiler-
            compilers reduce the risk of missing things, or of
            accidentally coming up with a compiler that accepts
            constructs you hadn't planned on, which are
            probably meaningless anyway.
          }
        - no
          { I feel sorry for you.  Be sure you implement an
            exhaustive test suite.
          }
      }
  }</pre>

<p>Several years back, I needed to implement a very small compiler for reading and processing industry-standard stacking sequence codes for lamina layup in composite structural materials (like fiberglass or carbon-fiber composites) into strength and stiffness results for the final product. Because the grammar was quite small, I opted to not dig out my compiler-compiler (a commercial product called "LALR" written by Paul B. Mann, one of the geniuses of our day) and decided instead to implement a simple top-down recursive descent parser. It took me a few hours of focused thought to get it working correctly.</p>

<p>One of the advantages of NOT using a compiler-compiler is that you don't have to drag in all the (possibly licensed) parsing engine and lexing engine code. Another advantage, as I alluded to earlier, is that it MIGHT actually be quicker than learning (or re-learning) the compiler-compiler's system. All compiler-compilers that I'm aware of have their own syntax for inputs, then requirements for where to put output files, how to build the resulting generated code, etc. Once you learn all that, it's pretty quick to make changes and re-generate. But there IS DEFINITELY a learning curve.</p>

<p>Even if you do use a compiler-compiler, you still have to implement the action code associated with each individual grammar production. That means you STILL have to REALLY UNDERSTAND what you're trying to accomplish. The compiler-compiler really only helps you implement the parser. The actions you take as the parser dissects the input are still up to you. You still have to build the backend data structures, the logic, the compiler's output, etc.</p>

<p>The risks of rolling your own compiler (instead of using a compiler-compiler) is that you are building the code for each production from scratch, and you can miss little things that will cause your parser to misbehave, or to behave differently on similar productions on which it SHOULD behave pretty much the same.</p>

<p>Well, having said all that, let's throw caution to the wind and get started.</p>

<h2>Getting Started: The Project Requirements</h2>

<p>In my expression evaluator project, I needed to read in a mathematical expression from an appropriate <em>.ini</em> file, and then to evaluate the result of that expression at run-time, with parameter values that could only be known at run-time. The expression was to be evaluated tens of thousands of times so it needed to be compiled only once into an intermediate-form that would be very fast to evaluate. I also wanted it to be able to deal with differences in the formula for different points in the domain; just like a real mathematical function would:</p>

<div class="pre-action-link" id="premain566076" style="width:100%;display:block;"><span id="prehide566076" onclick="processCodeBlocks.togglePre(566076);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(566076);">Copy Code</span></div><pre lang="text" id="pre566076" style="margin-top: 0px;">f(x) = {0 when x&lt;0, x when 0 &lt;= x &lt;= 2, 4-x when x&gt;2}</pre>

<p>Thus, my goal was to implement an expression evaluator that: </p>

<ol>
<li>Accepts replaceable parameters </li>

<li>Accepts logical constructs </li>

<li>Executes branching based on logical results </li>

<li>Produces a pre-compiled version for speedy execution </li>
</ol>

<p>The simple approach for my application would have been to drag in a scripting language that could handle all of these with ease. If you have the environment available to you, using PERL, or VBScript would probably take care of all the details for you (actually, I don't know whether they pre-compile an expression, or whether they recompile the expression each time it's evaluated). Unfortunately, in my environment, I had no pre-made scripting language that would be available, so I needed to implement the expression evaluation code myself.</p>

<p>The three primary tasks here are: </p>

<ol>
<li>Come up with the intermediate-form. This is quite independent of writing the compiler. The compiler will simply put the human-written expression INTO that intermediate-form. Part of this task is also to implement the evaluator function that turns the compiled expression plus replaceable parameters into a final single number. </li>

<li>Come up with an appropriate grammar. This part is critical, and determines the precedence and associativity of the operators. If this part is wrong, nothing else is going to work as expected. I'll share with you some of the joys I had in getting certain aspects of the grammar incorrect, and having to work thru them. </li>

<li>Implement a compiler that both recognizes and parses the grammar correctly, AND takes appropriate construction actions (constructing that intermediate-form from part 1) along the way. </li>
</ol>

<h2>--Task 1: Design the Intermediate Form -- </h2>

<p>The intermediate-form I settled on is very similar to RPN (Reverse Polish notation: see <a href="http://www.hpmuseum.org/rpn.htm">http://www.hpmuseum.org/rpn.htm</a>), a stack based representation of an expression formally called "postfix" form. Humans write expressions in "infix" form where the operators are in-between the operands. As such, we frequently have to add parenthesis to indicate precedence. Postfix expressions don't need parenthesis because they just perform all operations in left to right order. Here are a couple of examples.</p>

<div class="pre-action-link" id="premain356004" style="width:100%;display:block;"><span id="prehide356004" onclick="processCodeBlocks.togglePre(356004);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(356004);">Copy Code</span></div><pre lang="text" id="pre356004" style="margin-top: 0px;">infix form  :  7 + 2
postfix form:  7 2 +

infix form  :  5*sqrt( 4 + 3*4 )
postfix form:  3 4 * 4 + sqrt 5 *</pre>

<p>To evaluate a postfix expression, a pointer into the postfix expression represents the "top of the stack". As the expression is traversed from left to right, when operators are encountered, the appropriate number of operands to the left of the operator is processed and the results replace the operator.</p>

<p>Stepping through that last example expression, stopping when operators are recognized and executed, the expression evolves as follows:</p>

<div class="pre-action-link" id="premain706571" style="width:100%;display:block;"><span id="prehide706571" onclick="processCodeBlocks.togglePre(706571);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(706571);">Copy Code</span></div><pre lang="text" id="pre706571" style="margin-top: 0px;">3 4 *  4  + sqrt 5 *
^
3 4 12 4  + sqrt 5 *
    ^
3 4 12 4 16 sqrt 5 *
          ^
3 4 12 2 16  4   5 *
             ^
3 4 12 2 16  4   5 20
                   ^
</pre>

<p>When finished, the final answer is on the top of the stack (last position of the postfix expression).</p>

<p>The problem with using this exact process is that I needed to be able to repeat the process many times. You can see that the postfix expression is consumed along the way, making it unavailable for re-use. Also, so far there is no provision for replaceable parameters. And lastly, the expression evaluator must recognize that '+', '*', and "sqrt" are operators, not operands. That likely involves decision making at run time, which, for speed sake I wanted to avoid or to make as simple as possible. All of these obstacles could probably be overcome using a strict postfix idiom, but I chose a slightly different approach.</p>

<p>After stewing about it for a while, I settled on a hybrid approach that involved four arrays: one array of constants that is populated at compile time, one array of instructions that is also populated at compile time, one array of parameters that is passed to the evaluator routine for use at evaluation time, and a scratch-pad array -- the stack, used at evaluation time. The structure looks something like this:</p>

<div class="pre-action-link" id="premain907876" style="width:100%;display:block;"><span id="prehide907876" onclick="processCodeBlocks.togglePre(907876);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(907876);">Copy Code</span></div><pre lang="C++" id="pre907876" style="margin-top: 0px;"><span class="code-keyword">typedef</span> <span class="code-keyword">struct</span> ExpressionStruct {

   <span class="code-keyword">double</span> *constants;
   <span class="code-keyword">int</span>     constantsLen;
   <span class="code-keyword">int</span>    *instructions;
   <span class="code-keyword">int</span>     instructionsLen;

} Expression_T;</pre>

<p>For the following input, "<code>6 * sqrt( 5 + 3*4 )</code>", the generated arrays are:</p>

<div class="pre-action-link" id="premain89970" style="width:100%;display:block;"><span id="prehide89970" onclick="processCodeBlocks.togglePre(89970);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(89970);">Copy Code</span></div><pre lang="text" id="pre89970" style="margin-top: 0px;">constants:      3       4            5                  6
instructions: PUSH_C  PUSH_C  MUL  PUSH_C  ADD  SQRT  PUSH_C  MUL</pre>

<p>Where <code>PUSH_C</code> means "get the next constant from the constants array and push it onto the local stack". There is also a <code>PUSH_P</code> "Push Parameter" instruction. See the algorithm below.</p>

<p>The evaluation routine runs through the entire instructions array, and depending on the instruction either copies the next constant to the scratch-pad stack, copies one of the parameters to the same stack, or executes the indicated instruction (like <code>SQRT </code>or <code>ADD </code>or <code>MULT</code>) using values near the top of the stack. It looks like this:</p>

<div class="pre-action-link" id="premain339804" style="width:100%;display:block;"><span id="prehide339804" onclick="processCodeBlocks.togglePre(339804);">Hide</span>  &nbsp; <span id="preShrink339804" onclick="processCodeBlocks.shrinkExpand(339804);">Shrink</span> <img id="preimg339804" src="./Compiler Patterns - CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(339804);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(339804);">Copy Code</span></div><pre lang="C++" id="pre339804" processed="true" style="margin-top: 0px;"><span class="code-keyword">double</span> evaluate( Expression_T* ep, <span class="code-keyword">double</span>* parameters )
{
   <span class="code-keyword">int</span> constantIndex = <span class="code-digit">0</span>; <span class="code-comment">//</span><span class="code-comment">next constant to push to stack.
</span>   <span class="code-keyword">int</span> ndx;               <span class="code-comment">//</span><span class="code-comment">our current position on the
</span>                          <span class="code-comment">//</span><span class="code-comment">instruction stack.
</span>   <span class="code-keyword">double</span> stack[<span class="code-digit">50</span>];      <span class="code-comment">//</span><span class="code-comment">50 Oreo "Double Stack" cookies.
</span>                          <span class="code-comment">//</span><span class="code-comment">I'm drooling already...
</span>   <span class="code-keyword">int</span> stktop = -<span class="code-digit">1</span>;       <span class="code-comment">//</span><span class="code-comment">last item ON the evaluation stack.
</span>                          <span class="code-comment">//</span><span class="code-comment">Nothing on the stack yet.
</span>
 <span class="code-comment">//</span><span class="code-comment">for each instruction in the array,
</span>   <span class="code-keyword">for</span>( ndx=<span class="code-digit">0</span>; ndx &lt; ep-&gt;instructionLen; ndx++ )
   {
    <span class="code-comment">//</span><span class="code-comment">get the instruction.
</span>      <span class="code-keyword">int</span> instruction = ep-&gt;instructions[ndx];

    <span class="code-comment">//</span><span class="code-comment">Zero is the instruction number for "PUSH_C", which
</span>    <span class="code-comment">//</span><span class="code-comment">means "push the next constant to the stack."
</span>      <span class="code-keyword">if</span>( <span class="code-digit">0</span> == instruction )
         stack[++stktop] = ep-&gt;constants[constantIndex++] ;

    <span class="code-comment">//</span><span class="code-comment">Negative instruction numbers means "push the
</span>    <span class="code-comment">//</span><span class="code-comment">indicated parameter to the stack."  Convert the
</span>    <span class="code-comment">//</span><span class="code-comment">negative number to a positive, zero-based index.
</span>      <span class="code-keyword">else</span> <span class="code-keyword">if</span>( instruction &lt; <span class="code-digit">0</span> )
         stack[++stktop] = parameters[-instruction-<span class="code-digit">1</span>];

    <span class="code-comment">//</span><span class="code-comment">Positive instruction numbers are the regular
</span>    <span class="code-comment">//</span><span class="code-comment">mathematical operators.
</span>      <span class="code-keyword">else</span> <span class="code-keyword">switch</span>( instruction )
      {
         <span class="code-keyword">case</span> ADD:  <span class="code-comment">//</span><span class="code-comment">binary operators decrement the stack by one.
</span>                      stktop-- ;
                    <span class="code-comment">//</span><span class="code-comment">do the addition
</span>                      stack[stktop] += stack[stktop+1];
                      <span class="code-keyword">break</span>;

         <span class="code-keyword">case</span> MUL:  <span class="code-comment">//</span><span class="code-comment">another binary operator.
</span>                      stktop-- ;
                    <span class="code-comment">//</span><span class="code-comment">do the multiplication
</span>                      stack[stktop] *= stack[stktop+1];
                      <span class="code-keyword">break</span>;

         <span class="code-keyword">case</span> SQRT: <span class="code-comment">//</span><span class="code-comment">unary operators leave the stack
</span>                    <span class="code-comment">//</span><span class="code-comment">height unchanged.
</span>                    <span class="code-comment">//</span><span class="code-comment">do the square root operation.
</span>                      stack[stktop] = sqrt( stack[stktop] );
                      <span class="code-keyword">break</span>;

         <span class="code-keyword">default</span>:   <span class="code-comment">//</span><span class="code-comment">print an error message and abort.
</span>                      error(<span class="code-string">"</span><span class="code-string">Unrecognized operator"</span>);
      }
   }
   <span class="code-keyword">return</span> stack[<span class="code-digit">0</span>]; <span class="code-comment">//</span><span class="code-comment">final answer will be here now.
</span>}</pre>

<p>The actual code is quite a bit longer owing to a much longer <code>switch </code>statement (more operators). Plus it includes lots of debugging and tracing code. It can be downloaded from links elsewhere in this post.</p>

<p>Note that in the example code in this article, there are some hard limits embedded within the code; like the "<code>double stack[50]</code>" above. This is especially bad form unless you plan to test the stack height at every <code>PUSH</code>, and throw a runtime error if something goes wrong. If you use the code where you expose the functions to the outside world, like if you're getting the infix expression from a web-form or some such thing, using hard limits exposes you to nasty runtime things like buffer overruns. For example, the expression...</p>

<div class="pre-action-link" id="premain782206" style="width:100%;display:block;"><span id="prehide782206" onclick="processCodeBlocks.togglePre(782206);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(782206);">Copy Code</span></div><pre lang="text" id="pre782206" style="margin-top: 0px;">"1*(1*(1*(1*(1*(...)))))" </pre>

<p>...will eventually overflow the 50 element stack if continued long enough. The actual code uses dynamic memory for the stack as well as for the instructions and constants arrays. While I won't discuss it in the article, the actual stack usage can be computed at compile time, and the correct amount of stack pre-allocated so that run-time stack-overflow tests won't even be necessary. Again, you can see how this is done in the actual code within the <code>addInstruction() </code>function.</p>

<p>That finishes the task of designing the intermediate form that the compiler will generate.</p>

<h2>--Task 2: Design the Expression Grammar -- </h2>

<p>We're going to be recognizing human-readable infix expressions. Later in task 3, we'll implement the production actions associated with each grammar rule, converting them to the quasi-postfix format discussed above. For now, we just need to write the BNF that describes the grammar.</p>

<p>The first thing to note is that we want the compiling process to end when it hits the end-of-<code>string </code>marker (the <code>null </code>terminator). Before then, it better have recognized an "expression". Thus, we can say: </p>

<div class="pre-action-link" id="premain545703" style="width:100%;display:block;"><span id="prehide545703" onclick="processCodeBlocks.togglePre(545703);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(545703);">Copy Code</span></div><pre lang="text" id="pre545703" style="margin-top: 0px;">goal:
  -&gt; expression '\0'</pre>

<p>where "<code>expression</code>" is one of the non-terminals we're going to implement. </p>

<p>I'm going to attempt to express the expression grammar from the "bottom-up". That is, thinking about the lowest, most primitive forms, and then building upon them.</p>

<p>It seemed to me that the most primitive operands within the grammar would be literal numbers, and parameters. That is, everything that ends up on either side of an operator must ultimately come down to something that can be reduced to just a number. To indicate the most basic of operands, I use the non-terminal name t0. As we progress to more complicated forms, we'll march through <code>t1</code>, <code>t2</code>, <code>t3</code>, etc. </p>

<div class="pre-action-link" id="premain236543" style="width:100%;display:block;"><span id="prehide236543" onclick="processCodeBlocks.togglePre(236543);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(236543);">Copy Code</span></div><pre lang="text" id="pre236543" style="margin-top: 0px;">t0:
  -&gt; number
  -&gt; parameter</pre>

<p>It also occurs to me that among the most basic forms, we should include anything within parenthesis. Thus, we should add: </p>

<div class="pre-action-link" id="premain88650" style="width:100%;display:block;"><span id="prehide88650" onclick="processCodeBlocks.togglePre(88650);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(88650);">Copy Code</span></div><pre lang="text" id="pre88650" style="margin-top: 0px;">-&gt; '(' expression ')'
</pre>

<p>where we've yet to define what an expression is, but it will end-up being just what you think it is; a series of operands and operators that reduce to express a single number. </p>

<p>We should also count function calls as most basic. Thus, we should add: </p>

<div class="pre-action-link" id="premain505826" style="width:100%;display:block;"><span id="prehide505826" onclick="processCodeBlocks.togglePre(505826);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(505826);">Copy Code</span></div><pre lang="text" id="pre505826" style="margin-top: 0px;">-&gt; funcname '(' list ')'
</pre>

<p>where a list will be a comma separated list of expressions. </p>

<p>And one last thing: if we want to allow named constants, like "<code>pi</code>", we should do it here. I only implemented "<code>pi</code>", but more could be added if desired.</p>

<p>Thus, the complete description of the <code>t0 </code>non-terminal is:</p>

<div class="pre-action-link" id="premain132666" style="width:100%;display:block;"><span id="prehide132666" onclick="processCodeBlocks.togglePre(132666);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(132666);">Copy Code</span></div><pre lang="text" id="pre132666" style="margin-top: 0px;">t0:
  -&gt; number
  -&gt; parameter
  -&gt; '(' expression ')'
  -&gt; funcname '(' list ')'
  -&gt; named_constant         //I'm actually only allowing pi for simplicity.  </pre>

<p>I'll go ahead and note here that on my first pass, I thought the branching construct should go here. Thus, I had another production rule like this: </p>

<div class="pre-action-link" id="premain794541" style="width:100%;display:block;"><span id="prehide794541" onclick="processCodeBlocks.togglePre(794541);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(794541);">Copy Code</span></div><pre lang="text" id="pre794541" style="margin-top: 0px;">-&gt; expression  '?'  expression ':' expression
</pre>

<p>where you'll recognize the use of the C language "conditional". More about this later. Here I just want to point out that this was a mistake, and caused the parser to act in very odd ways, looking for and processing tokens in a way that I had not intended at all. After looking to the C language specification to see how THEY implemented it, I realized it needed to be at the LOWEST precedence, not the highest. Thus, I moved it out of the definition for <code>t0</code>. </p>

<p>Having decided what our "primitives" are, we begin progressively adding complexity to our terms by following the old PEMDAS pattern: Parenthesis, Exponentiation, Multiplication, Division, Addition, Subtraction (or as my kids learned it, "Parachute Expert My Dear Aunt Sally"). We've already taken care of parenthesis, so we can begin progressively creating non-terminals for each precedence level of operator, paying close attention to the operator's associativity.</p>

<p>Actually, the PEMDAS pattern is not completely correct as we should apply unary negation ahead of exponentiation. I want to be able to say -2^3 and have it mean (-2)^3, not -(2^3). In this example, you get the same answer, but what about in a formula that uses a parameter instead of a literal: for example, -p1 ^ 3.2 where you know ahead of time that the parameter value p1 is negative, and its sign must be changed BEFORE attempting to exponentiate it with a fractional exponent. Obviously the binding should be <code>(-p1)^3.2</code>. </p>

<div class="pre-action-link" id="premain618527" style="width:100%;display:block;"><span id="prehide618527" onclick="processCodeBlocks.togglePre(618527);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(618527);">Copy Code</span></div><pre lang="text" id="pre618527" style="margin-top: 0px;">t1:           //unary prefix operators.
  -&gt; t0
  -&gt; '-' t0
  -&gt; '+' t0</pre>

<p>The purist in me says we ought to be able to negate (or posate?) ANY single term, and thus we should rewrite it with a recursive definition as follows: </p>

<div class="pre-action-link" id="premain17294" style="width:100%;display:block;"><span id="prehide17294" onclick="processCodeBlocks.togglePre(17294);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(17294);">Copy Code</span></div><pre lang="text" id="pre17294" style="margin-top: 0px;">t1:
  -&gt; t0
  -&gt; '-' t1
  -&gt; '+' t1  </pre>

<p>making this a right recursive rule (because the non-terminal symbol "<code>t1</code>" shows-up on the right end of (at least) one production rule). But the pragmatist in me says, "how many times should we really allow...</p>

<div class="pre-action-link" id="premain319300" style="width:100%;display:block;"><span id="prehide319300" onclick="processCodeBlocks.togglePre(319300);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(319300);">Copy Code</span></div><pre lang="text" id="pre319300" style="margin-top: 0px;">x + - - - - + + + - - 5 </pre>

<p>...anyway?" Thus, I'm overruling the purist, and sticking to my decision to ONLY allow a single negation (or posation, er uh, positivation, or maybe positively_plusillyation) operator, and leaving it as originally written. </p>

<p>NOW that unary operators are handled, let's do exponentiation:</p>

<div class="pre-action-link" id="premain673596" style="width:100%;display:block;"><span id="prehide673596" onclick="processCodeBlocks.togglePre(673596);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(673596);">Copy Code</span></div><pre lang="text" id="pre673596" style="margin-top: 0px;">t2:
  -&gt; t1
  -&gt; t1 '^' t2  </pre>

<p>Note the right recursion. This guarantees that the ^ operator will bind from right to left. That is, in a sequence of operations like 4 ^ 3 ^ 2, the compiler will recognize that "4" must remain as a <code>t1</code>, and "3 ^ 2" must be reduced to a <code>t2</code>. In reducing "3 ^ 2" to a t2, it must leave "3" as a <code>t1</code>, but reduce "2" to a <code>t2</code>. Thus, the implied binding will be from right to left, effecting 4^(3^(2)).</p>

<p>Next is multiplication and division. They are at the same level of precedence, and thus all go within the same non-terminal, and are evaluated in first-come first-served (left to right) order. We're going to add another operator to the classic PEMDAS, and implement modulo as well.</p>

<div class="pre-action-link" id="premain113638" style="width:100%;display:block;"><span id="prehide113638" onclick="processCodeBlocks.togglePre(113638);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(113638);">Copy Code</span></div><pre lang="text" id="pre113638" style="margin-top: 0px;">t3:
  -&gt; t2
  -&gt; t3 '*' t2
  -&gt; t3 '/' t2
  -&gt; t3 '%' t2  </pre>

<p>Note the left recursion. Again, this is what forces left associativity of the operators. We'll find that most of our operators are actually left associative. </p>

<p>And finally addition and subtraction: Again, we want them to associate left to right, so we need left recursion.</p>

<div class="pre-action-link" id="premain414699" style="width:100%;display:block;"><span id="prehide414699" onclick="processCodeBlocks.togglePre(414699);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(414699);">Copy Code</span></div><pre lang="text" id="pre414699" style="margin-top: 0px;">t4:
  -&gt; t3
  -&gt; t4 '+' t3
  -&gt; t4 '-' t3</pre>

<p>That finishes the simple calculator part of formula evaluation. However, as stated earlier, I want the ability to do tests and branching to different formulas based on those tests. Thus, the first thing we need to implement is logical comparisons: less than, greater than, equals, etc. Turns out that the precedence of logical equals needs to be lower than the comparison operators, so we need to do the less than and greater than first.</p>

<div class="pre-action-link" id="premain582906" style="width:100%;display:block;"><span id="prehide582906" onclick="processCodeBlocks.togglePre(582906);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(582906);">Copy Code</span></div><pre lang="text" id="pre582906" style="margin-top: 0px;">t5:
  -&gt; t4
  -&gt; t5 "&lt;"  t4
  -&gt; t5 "&lt;=" t4
  -&gt; t5 "&gt;"  t4
  -&gt; t5 "&gt;=" t4

t6:
  -&gt; t5
  -&gt; "not" t5</pre>

<p>By placing "<code>not</code>" at one precedence level lower than the comparison operators,</p>

<div class="pre-action-link" id="premain609508" style="width:100%;display:block;"><span id="prehide609508" onclick="processCodeBlocks.togglePre(609508);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(609508);">Copy Code</span></div><pre lang="text" id="pre609508" style="margin-top: 0px;">not x &lt; 7
</pre>

<p>evaluates as <code>not(x &lt; 7)</code>, instead of <code>(not x) &lt; 7</code>. I believe this makes more intuitive sense than having the "<code>not</code>" bind with <code>x </code>first. </p>

<p>Note that by putting it at this level of precedence, "<code>not x</code>" cannot be used in contexts that require a <code>t5</code>, a <code>t4</code>, a <code>t3</code>, a <code>t2</code>, a <code>t1</code>, or a <code>t0</code>. That is, you can't say "<code>6 * not p2</code>" to effect a 0 or 6 toggle based on <code>p2</code>. You CAN however effect exactly this by simply enclosing the "<code>not p2</code>" in parens. "<code>6 * (not p2)</code>" DOES effect a 0 or 6 toggle. Because of the parenthesis, "<code>(not p2)</code>" is a primitive (i.e. a <code>t0</code>) and can be used in any context, whereas "<code>not p2</code>" is a <code>t6 </code>and is limited in where it can be used.</p>

<p>Note also that we're patterning this after the unary negation (<code>t1</code>). Thus we only test <code>t5</code>s on the right hand side. As with unary negation, it is NOT recursively defined.</p>

<div class="pre-action-link" id="premain440400" style="width:100%;display:block;"><span id="prehide440400" onclick="processCodeBlocks.togglePre(440400);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(440400);">Copy Code</span></div><pre lang="text" id="pre440400" style="margin-top: 0px;">t7:
  -&gt; t6
  -&gt; t7 "eq" t6
  -&gt; t7 "not_eq" t6  </pre>

<p>One might wonder why not to include equality tests as higher precedence than "<code>not</code>" so that... </p>

<div class="pre-action-link" id="premain345076" style="width:100%;display:block;"><span id="prehide345076" onclick="processCodeBlocks.togglePre(345076);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(345076);">Copy Code</span></div><pre lang="text" id="pre345076" style="margin-top: 0px;">not y eq x
</pre>

<p>...evaluates as <code>not(y eq x) </code>instead of how it's actually going to evaluate: <code>(not y) eq x</code>. </p>

<p>The answer is that there is a separate operator for not-equal, and to compute not equal, we should just use that operator. Again, if "<code>not y eq x</code>" bound as <code>not(y eq x)</code>, how would we effect <code>(not y) eq x</code>? We would be forced to use parens.</p>

<p>I'll note here that I was well into the testing aspect of the project when it finally dawned on me (via a test) that the "<code>eq</code>" token created a slight conflict. Consider this construct:</p>

<div class="pre-action-link" id="premain69349" style="width:100%;display:block;"><span id="prehide69349" onclick="processCodeBlocks.togglePre(69349);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(69349);">Copy Code</span></div><pre lang="text" id="pre69349" style="margin-top: 0px;">6.5eq7.0
</pre>

<p>Obviously this is false, but it illustrates the problem. Because I'm using <code>strtod() </code>to pick up numbers, the <code>strtod() </code>function scans up through 6.5e thinking it's getting a scientific notation number, like 6.5e3 for 6500. Then it sees the 'q' and aborts. Yes, I could have fixed this by writing my own number scanning function. But this seemed like overkill. Instead, I just added the C operators "==" and "!=" to the <code>t7 </code>rule so someone can write "<code>6.5==7.0</code>" and get the result they want (of course they could also have just added spaces: "<code>6.5 eq 7.0</code>" works just fine). Besides, when the "<code>6.5eq</code>" fails it throws an error and does not quietly march forward and produce erroneous results. I deemed that "good enough"!</p>

<div class="pre-action-link" id="premain555980" style="width:100%;display:block;"><span id="prehide555980" onclick="processCodeBlocks.togglePre(555980);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(555980);">Copy Code</span></div><pre lang="text" id="pre555980" style="margin-top: 0px;">t7:
  -&gt; t6
  -&gt; t7 "eq" t6
  -&gt; t7 "==" t6
  -&gt; t7 "not_eq" t6
  -&gt; t7 "!=" t6</pre>

<p>For logical completeness, here are the <code>and</code>s and <code>or</code>s.</p>

<div class="pre-action-link" id="premain78333" style="width:100%;display:block;"><span id="prehide78333" onclick="processCodeBlocks.togglePre(78333);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(78333);">Copy Code</span></div><pre lang="text" id="pre78333" style="margin-top: 0px;">t8:
  -&gt; t7
  -&gt; t8 "and" t7

t9:
  -&gt; t8
  -&gt; t9 "or" t8 </pre>

<p>Both are left recursive meaning they associate left to right. Since "<code>and</code>" is higher precedence than "<code>or</code>",</p>

<div class="pre-action-link" id="premain285181" style="width:100%;display:block;"><span id="prehide285181" onclick="processCodeBlocks.togglePre(285181);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(285181);">Copy Code</span></div><pre lang="text" id="pre285181" style="margin-top: 0px;">x and y or z and w
</pre>

<p>evaluates as (<code>x and y</code>) or (<code>z and w</code>) </p>

<p>We're only lacking two things now: "expression"s, and "list"s for use with function parameters. First, the left associative list:</p>

<div class="pre-action-link" id="premain894604" style="width:100%;display:block;"><span id="prehide894604" onclick="processCodeBlocks.togglePre(894604);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(894604);">Copy Code</span></div><pre lang="text" id="pre894604" style="margin-top: 0px;">list:
  -&gt; expression
  -&gt; list ',' expression</pre>

<p>Note that, unless we allow <code>null</code> expressions, this way of defining a list is not going to permit empty lists. In our grammar, that is not a problem since we’re not going to be calling functions with empty parameter lists anyway. But in a more general grammar where we wanted to allow empty parameter lists, we would need to consider implementing empty expressions (and consider how to deal with the complexity that will produce) or add another production to permit empty lists:</p>

<div class="pre-action-link" id="premain394039" style="width:100%;display:block;"><span id="prehide394039" onclick="processCodeBlocks.togglePre(394039);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(394039);">Copy Code</span></div><pre lang="text" id="pre394039" style="margin-top: 0px;">list:
   -&gt; expression
   -&gt; list ',' expression
   -&gt; ''  </pre>

<p>But now we’ve introduced some interesting issues. First, input like the following is now legal:</p>

<div class="pre-action-link" id="premain287914" style="width:100%;display:block;"><span id="prehide287914" onclick="processCodeBlocks.togglePre(287914);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(287914);">Copy Code</span></div><pre lang="C++" id="pre287914" style="margin-top: 0px;">somefunc( , , <span class="code-digit">2</span>) </pre>

<p>Unless you know what you want to do with such input, that is, what kind of structures you want the compiler to build in response to such input, they are meaningless anyway and you don’t want to allow them.</p>

<p>Next, you’ve just introduced a conflict into the grammar. Consider how such a grammar should parse a simple function call: <code>sin( 2 )</code>. Realize that before the “<code>2</code>”, there is an empty <code>string</code> (of zero length). It’s invisible to us, but not to the parser. Should the parser first accept the zero-length <code>string</code>, reducing it to a “list”? Or should it first attempt to recognize and accept an expression? It is clear to US that the right answer is to look for an expression first, then if one is not found, to accept nothingness as a valid list. But to implement this, you’ll have to be careful of the order in which you do things.</p>

<p>Turns out, if all you want is to implement empty parameter lists (and not to accept constructs like <code>somefunc( , , 2))</code>, this is probably the wrong place to do it. You should probably modify the t0 non-terminal by adding the following rule:</p>

<div class="pre-action-link" id="premain938092" style="width:100%;display:block;"><span id="prehide938092" onclick="processCodeBlocks.togglePre(938092);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(938092);">Copy Code</span></div><pre lang="text" id="pre938092" style="margin-top: 0px;">-&gt; funcname '(' ')' </pre>

<p>We'll talk more about this when we implement the list non-terminal. </p>

<p>This finishes everything except the "choose which expression" operator. Since only the expression non-terminal is left to define, this is the place to incorporate the branching operator. I opted to use the C language ?: conditional operator for branching.</p>

<div class="pre-action-link" id="premain923728" style="width:100%;display:block;"><span id="prehide923728" onclick="processCodeBlocks.togglePre(923728);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(923728);">Copy Code</span></div><pre lang="text" id="pre923728" style="margin-top: 0px;">expression:
  -&gt; t9
  -&gt; expression '?' expression ':' expression</pre>

<p>That finishes the grammar. Now on to task number 3: actually implementing it as a compiler.</p>

<h2>--Task 3: Building the Compiler -- </h2>

<p>Parsers (input language recognizers) are broadly placed into one of two categories: Top-down, or bottom-up. In a bottom-up parser, a list of "next legal tokens" is generated for each "state" the parser finds itself in. If the next token read from the input doesn't match one of the items in the list, there's an error in the input. If it does match, the parser executes whatever action (that you design as part of making the "parser" into a "compiler") that is associated with that state and that token, and then moves to the next parser state associated with that state and that token. Bottom-up parsers may execute faster than top-down parsers, but they are difficult to build by hand.</p>

<p>Top-down parsers on the other hand can be built in a "recursive-descent" fashion almost directly from the grammar specification. Consider the t2 non-terminal, </p>

<div class="pre-action-link" id="premain442110" style="width:100%;display:block;"><span id="prehide442110" onclick="processCodeBlocks.togglePre(442110);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(442110);">Copy Code</span></div><pre lang="text" id="pre442110" style="margin-top: 0px;">t2:
  -&gt; t1
  -&gt; t1 '^' t2</pre>

<p>we can implement this very simply with the following function. In this function, the parameter "<code>ifp</code>" is the infix expression pointer address. We need the address of the pointer so we can modify where the expression pointer is pointing to as we "consume" tokens from the input. As you'll see, all the non-terminal functions return a value that can be use to express success or failure: success when one of the production rules is recognized, and failure when none of the rules are recognized. </p>

<div class="pre-action-link" id="premain116749" style="width:100%;display:block;"><span id="prehide116749" onclick="processCodeBlocks.togglePre(116749);">Hide</span>  &nbsp; <span id="preShrink116749" onclick="processCodeBlocks.shrinkExpand(116749);">Shrink</span> <img id="preimg116749" src="./Compiler Patterns - CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(116749);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(116749);">Copy Code</span></div><pre lang="C++" id="pre116749" processed="true" style="margin-top: 0px;"><span class="code-keyword">int</span> t2( Expression_T* ep, <span class="code-keyword">const</span> <span class="code-keyword">char</span>** ifp )
{
   <span class="code-keyword">if</span>( <span class="code-keyword">not</span> t1(ep, ifp) ) <span class="code-comment">//</span><span class="code-comment">if not getting a t1,
</span>   {
    <span class="code-comment">//</span><span class="code-comment">since both productions begin with t1, if we don't get a t1 first,
</span>    <span class="code-comment">//</span><span class="code-comment">we can't go forward.
</span>      <span class="code-keyword">return</span> <span class="code-digit">0</span>;  <span class="code-comment">//</span><span class="code-comment">return failure indicator.
</span>   }
  <span class="code-comment">//</span><span class="code-comment">OK, we got a t1.  We at least got the first production.  Now we need to
</span>  <span class="code-comment">//</span><span class="code-comment">see if we're actually getting the second production instead of the first
</span>  <span class="code-comment">//</span><span class="code-comment">by checking if there's a " ^ t2 " following the t1 we just accepted.
</span>
  <span class="code-comment">//</span><span class="code-comment">Note that the t1 function moved what ifp is pointing at forward to just
</span>  <span class="code-comment">//</span><span class="code-comment">after the t1 that was just accepted.
</span>
  <span class="code-comment">//</span><span class="code-comment">Before each terminal (actual input token) we can have arbitrary white
</span>  <span class="code-comment">//</span><span class="code-comment">space. Therefore, we always ltrim before looking for an actual input token.
</span>    ltrim( ifp );       <span class="code-comment">//</span><span class="code-comment">skip over white space.
</span>
    <span class="code-keyword">if</span>( **ifp == <span class="code-string">'</span><span class="code-string">^'</span> )  <span class="code-comment">//</span><span class="code-comment">we got the '^' symbol,
</span>    {
       *ifp++ ;         <span class="code-comment">//</span><span class="code-comment">move the input past the '^' symbol.
</span>       <span class="code-keyword">if</span>( t2(ep, ifp) )<span class="code-comment">//</span><span class="code-comment">look for a trailing t2 non-terminal.  RECURSIVE CALL.
</span>       {<span class="code-comment">//</span><span class="code-comment">yes, we got the second production: "t1 '^' t2", instead of the first.
</span>          addInstruction( ep, EXPON ); <span class="code-comment">//</span><span class="code-comment">push an enumeration value indicating
</span>                                       <span class="code-comment">//</span><span class="code-comment">we saw an exponentiation action.
</span>          <span class="code-keyword">return</span> <span class="code-digit">1</span>;   <span class="code-comment">//</span><span class="code-comment">indicate success.
</span>       }
       <span class="code-keyword">else</span>
       {
        <span class="code-comment">//</span><span class="code-comment">We got a '^' but not a t2.  There are no rules in t2
</span>        <span class="code-comment">//</span><span class="code-comment">that begin with t1 '^' , so we've failed to see a t2.
</span>          <span class="code-keyword">return</span> <span class="code-digit">0</span>;
       }
    }
  <span class="code-comment">//</span><span class="code-comment">at this point we got a t1 only which is good enough to produce a t2.
</span>  <span class="code-comment">//</span><span class="code-comment">No compiler action needed; just indicate success.
</span>    <span class="code-keyword">return</span> <span class="code-digit">1</span>;
}</pre>

<p><strong>Pattern:</strong> Recursive descent parsers can be written almost directly from the grammar definition. You check for the existence of non-terminals in the input by simply calling the function that implements that non-terminal, then testing the return to see if it succeeded. You check for literals in the input by first bypassing white-space, then doing a direct '==' character comparison, or a <code>strcmp()</code>. As we "consume" the input (match literals), we advance the input pointer past the literals.</p>

<p><strong>Pattern:</strong> Anytime you have two rules that begin the same, make sure you don't prematurely accept the shorter rule (like <code>t2 -&gt; t1 </code>in the above example) without checking if a longer rule is actually present (like <code>t2 -&gt; t1 '^' t2 </code>in the above example). If a rule is seen, execute a construction action (if required). Indicate whether any of the rules were seen by returning a zero (for failure) or non-zero (for success).</p>

<h3>Saving State</h3>

<p>Note that in each case where we returned zero (failed to see a valid production), we just glibly returned, without restoring the input pointer (<code>ifp</code>) to where it had been before our failed <code>t1 </code>or <code>t2 </code>attempt, even though either of those actions could have advanced the pointer to who-knows where, and made it impossible to continue with an alternate action. For example, consider the following grammar:</p>

<div class="pre-action-link" id="premain409007" style="width:100%;display:block;"><span id="prehide409007" onclick="processCodeBlocks.togglePre(409007);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(409007);">Copy Code</span></div><pre lang="text" id="pre409007" style="margin-top: 0px;">tx:
  -&gt; first_production
  -&gt; next_production
  -&gt; last_production

first_production:
  -&gt; "hello world" ';'

next_production:
  -&gt; "hello world" '?'</pre>

<p>We implement <code>first_production </code>like this:</p>

<div class="pre-action-link" id="premain336258" style="width:100%;display:block;"><span id="prehide336258" onclick="processCodeBlocks.togglePre(336258);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(336258);">Copy Code</span></div><pre lang="C++" id="pre336258" style="margin-top: 0px;"><span class="code-keyword">int</span> first_production( Expression_T* ep, <span class="code-keyword">const</span> <span class="code-keyword">char</span>** ifp )
{
   ltrim( ifp );        <span class="code-comment">//</span><span class="code-comment">skip leading white.
</span>   <span class="code-keyword">if</span>( <span class="code-digit">0</span> == strncmp( *ifp, <span class="code-string">"</span><span class="code-string">hello world"</span>, <span class="code-digit">11</span> ) <span class="code-comment">//</span><span class="code-comment">got "hello world"
</span>   <span class="code-keyword">and</span> ( *ifp += <span class="code-digit">11</span>,    <span class="code-comment">//</span><span class="code-comment">advance past "hello world" in side-effect context
</span>          ltrim( ifp ), <span class="code-comment">//</span><span class="code-comment">advance past white space in side-effect context
</span>         <span class="code-string">'</span><span class="code-string">;'</span> == **ifp ) ) <span class="code-comment">//</span><span class="code-comment">GOT IT!
</span>   {
      *ifp ++ ;  <span class="code-comment">//</span><span class="code-comment">advance past the ';'
</span>      <span class="code-keyword">return</span> <span class="code-digit">1</span>;  <span class="code-comment">//</span><span class="code-comment">indicate success.
</span>   {
   <span class="code-keyword">else</span>
      <span class="code-keyword">return</span> <span class="code-digit">0</span>;  <span class="code-comment">//</span><span class="code-comment">indicate failure.
</span>}</pre>

<p>Now suppose the actual input looks like this:</p>

<div class="pre-action-link" id="premain972942" style="width:100%;display:block;"><span id="prehide972942" onclick="processCodeBlocks.togglePre(972942);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(972942);">Copy Code</span></div><pre lang="text" id="pre972942" style="margin-top: 0px;">"hello world?"</pre>

<p>Within <code>first_production</code>, the input is advanced past "<code>hello world</code>" and is pointing at the '<code>?</code>' when the production fails and returns. <code>tx </code>now attempts <code>next_production</code>, but since the input is pointing at the '<code>?</code>' instead of at "<code>hello world?</code>" it will also fail, even though it should succeed.</p>

<p>Clearly, if <code>first_production </code>fails, before trying <code>next_production</code>, we must restore the pointer to where it was at the beginning of the function. The same thing if <code>next_production </code>fails; before trying <code>last_production</code>, we must restore the input pointer (the state). </p>

<p>And while we're talking about it, note that state is actually much more than just the input position pointer. In our compiler, state also includes the instruction array end pointer, and the constants array end pointer. In a more complicated compiler, it might include other things as well. </p>

<p>The question is, WHERE should we restore state? That is, which function should be responsible for restoring state: the calling function, or the called function?</p>

<p>The way <code>t2 </code>is implemented, we are clearly ASSUMING that if a function in the call chain ahead of <code>t2 </code>needs the state restored, it will take care of it, because <code>t2 </code>certainly didn't do it!</p>

<p>This gets down to a design decision: should the caller, or the called function do state restoration. Well, consider the first few non-terminals and production rules of our grammar:</p>

<div class="pre-action-link" id="premain483700" style="width:100%;display:block;"><span id="prehide483700" onclick="processCodeBlocks.togglePre(483700);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(483700);">Copy Code</span></div><pre lang="text" id="pre483700" style="margin-top: 0px;">t1: -&gt; t0
    ...

t2: -&gt; t1
    ...

t3: -&gt; t2
    ...

t4: -&gt; t3
    ...</pre>

<p>If we rely on the called function to restore state, we're going to have code that looks like this:</p>

<div class="pre-action-link" id="premain695552" style="width:100%;display:block;"><span id="prehide695552" onclick="processCodeBlocks.togglePre(695552);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(695552);">Copy Code</span></div><pre lang="C++" id="pre695552" style="margin-top: 0px;"><span class="code-keyword">int</span> t1( Expression_T* ep, <span class="code-keyword">const</span> <span class="code-keyword">char</span>** ifp )
{
   State_T s;
   save_state( &amp;s, ep, ifp );
   <span class="code-keyword">if</span>( <span class="code-keyword">not</span> t0( ep, ifp ) )
   {
      restore_state( &amp;s, ep, ifp );
      <span class="code-keyword">return</span> <span class="code-digit">0</span>;
   }
   <span class="code-keyword">else</span> ...
}

<span class="code-keyword">int</span> t2( Expression_T* ep, <span class="code-keyword">const</span> <span class="code-keyword">char</span>** ifp )
{
   State_T s;
   save_state( &amp;s, ep, ifp );
   <span class="code-keyword">if</span>( <span class="code-keyword">not</span> t1( ep, ifp ) )
   {
      restore_state( &amp;s, ep, ifp );
      <span class="code-keyword">return</span> <span class="code-digit">0</span>;
   }
   <span class="code-keyword">else</span> ...
}

etc.</pre>

<p>Each non-terminal function must save a local copy of the state before it does anything else. Thus, saving and restoring state becomes a rather time and stack consuming process as each non-terminal function drills into the next lower non-terminal function.</p>

<p>Now suppose we let the calling function take care of restoring state. Then the example functions above become:</p>

<div class="pre-action-link" id="premain857794" style="width:100%;display:block;"><span id="prehide857794" onclick="processCodeBlocks.togglePre(857794);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(857794);">Copy Code</span></div><pre lang="C++" id="pre857794" style="margin-top: 0px;"><span class="code-keyword">int</span> t1( Expression_T* ep, <span class="code-keyword">const</span> <span class="code-keyword">char</span>** ifp )
{
   <span class="code-keyword">if</span>( <span class="code-keyword">not</span> t0( ep, ifp ) )
   {
      <span class="code-keyword">return</span> <span class="code-digit">0</span>;
   }
   <span class="code-keyword">else</span> ...
}

<span class="code-keyword">int</span> t2( Expression_T* ep, <span class="code-keyword">const</span> <span class="code-keyword">char</span>** ifp )
{
   <span class="code-keyword">if</span>( <span class="code-keyword">not</span> t1( ep, ifp ) )
   {
      <span class="code-keyword">return</span> <span class="code-digit">0</span>;
   }
   <span class="code-keyword">else</span> ...
}</pre>

<p>Much simpler, much faster, and uses less stack space for local variables. </p>

<p><strong>Pattern:</strong> Let the calling functions restore their own state if they need to. Any time there are alternate rules (that is, if failing the first rule doesn't doom the whole non-terminal), that non-terminal will need to save state before drilling down with other non-terminal calls.</p>

<p>As we will see, most of our grammar rules will be like the <code>t2 </code>rule implemented above, where, if the first production fails, there's no point in moving forward; that non-terminal has already failed. Since there was no alternative, there was no point in saving the state within that non-terminal.</p>

<p>Before moving forward with more code, lets update our <code>Expression_T </code>type to take care of that annoying double pointer input "<code>**ifp</code>".</p>

<div class="pre-action-link" id="premain257101" style="width:100%;display:block;"><span id="prehide257101" onclick="processCodeBlocks.togglePre(257101);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(257101);">Copy Code</span></div><pre lang="C++" id="pre257101" style="margin-top: 0px;"><span class="code-keyword">typedef</span> <span class="code-keyword">struct</span> ExpressionStruct {

   <span class="code-keyword">double</span> *constants;
   <span class="code-keyword">int</span>     constantsLen;
   <span class="code-keyword">int</span>    *instructions;
   <span class="code-keyword">int</span>     instructionsLen;
   <span class="code-keyword">const</span> <span class="code-keyword">char</span>* infix;       <span class="code-comment">//</span><span class="code-comment">replaces **ifp that we were using.
</span>
} Expression_T;</pre>

<p>This will allow us to pass just one argument to the non-terminal functions, and make manipulating the input pointer easier. When we kick-off the compiling process, we'll set the infix member to the actual expression the user wants compiled.</p>

<h3>Left Recursion Pattern</h3>

<p>Now let's demonstrate more patterns by writing the functions for different non-terminals. The <code>t2 </code>rule demonstrated right recursion. Now let's demonstrate left recursion by implementing <code>t4</code>.</p>

<div class="pre-action-link" id="premain327551" style="width:100%;display:block;"><span id="prehide327551" onclick="processCodeBlocks.togglePre(327551);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(327551);">Copy Code</span></div><pre lang="text" id="pre327551" style="margin-top: 0px;">t4:
  -&gt; t3              //rule #1
  -&gt; t4 '+' t3       //rule #2
  -&gt; t4 '-' t3       //rule #3</pre>

<p>Before we get started, note that the ONLY way to get a <code>t4 </code>(from a non-<code>t4</code>) is by seeing a <code>t3</code>. If we don't begin by seeing a <code>t3</code>, there is no way to move forward. Thus, while there ARE three separate rules, implying we should save state, the first one is mandatory, so there's really no point is saving state before it.</p>

<div class="pre-action-link" id="premain925177" style="width:100%;display:block;"><span id="prehide925177" onclick="processCodeBlocks.togglePre(925177);">Hide</span>  &nbsp; <span id="preShrink925177" onclick="processCodeBlocks.shrinkExpand(925177);">Shrink</span> <img id="preimg925177" src="./Compiler Patterns - CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(925177);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(925177);">Copy Code</span></div><pre lang="C++" id="pre925177" processed="true" style="margin-top: 0px;"><span class="code-keyword">int</span> t4( Expression_T* ep )
{
   InstructionEnum_T ins; <span class="code-comment">//</span><span class="code-comment">which instruction (ADD or SUBT(ract)) we're seeing.
</span>
   <span class="code-keyword">if</span>( <span class="code-keyword">not</span> t3( ep ) )
   {
    <span class="code-comment">//</span><span class="code-comment">notice that if we naively attempt to move on and try the next rule
</span>    <span class="code-comment">//</span><span class="code-comment">  if( t4( ep ) )
</span>    <span class="code-comment">//</span><span class="code-comment">   //great, got a t4 so move forward...
</span>    <span class="code-comment">//</span><span class="code-comment">we have just created an infinite loop.
</span>    <span class="code-comment">//</span><span class="code-comment">If we don't start this non-terminal by FIRST getting a t3,
</span>    <span class="code-comment">//</span><span class="code-comment">we simply don't have any basis to move forward.  PERIOD.
</span>
      <span class="code-keyword">return</span> <span class="code-digit">0</span>;
   }

 <span class="code-comment">//</span><span class="code-comment">OK, got here, so we must have gotten a t3, which is good enough from
</span> <span class="code-comment">//</span><span class="code-comment">rule #1 to reduce to a t4.  Thus, since we now have a t4, we can now
</span> <span class="code-comment">//</span><span class="code-comment">look at the subsequent rules to see if we're actually getting one of
</span> <span class="code-comment">//</span><span class="code-comment">them. That is, look at the next token to see if it is a '+', or a '-'.
</span>
 <span class="code-comment">//</span><span class="code-comment">Note that if we DO get a successful production, it also reduces to a
</span> <span class="code-comment">//</span><span class="code-comment">t4, and we should restart the process of again looking for one of the
</span> <span class="code-comment">//</span><span class="code-comment">rules that begins with t4 followed by one of the '+' or '-' tokens.
</span>
   <span class="code-keyword">while</span>(
 <span class="code-comment">//</span><span class="code-comment">We keep looping while seeing one of the last two production rules.
</span>
 <span class="code-comment">//</span><span class="code-comment">Remember, we always allow arbitrary white space before tokens.
</span>           ltrim( &amp;(ep-&gt;infix) ), <span class="code-comment">//</span><span class="code-comment">trim white in side-effect context.
</span>
  <span class="code-comment">//</span><span class="code-comment">use side-effect context to store info about the token we're recognizing.
</span>          (ins=ADD ,   <span class="code-string">'</span><span class="code-string">+'</span> == *(ep-&gt;infix))
      <span class="code-keyword">or</span>  (ins=SUBT,   <span class="code-string">'</span><span class="code-string">/'</span> == *(ep-&gt;infix))  )
   {
    <span class="code-comment">//</span><span class="code-comment">YES, we got one of the addition or subtraction operator tokens,
</span>      ep-&gt;infix += <span class="code-digit">1</span>;       <span class="code-comment">//</span><span class="code-comment">skip past the token.
</span>      <span class="code-keyword">if</span>( t3( ep ) )        <span class="code-comment">//</span><span class="code-comment">try the rest of the rule.
</span>      {
       <span class="code-comment">//</span><span class="code-comment">YES, we got another "t4 OP t3" reduction.
</span>         addInstruction( ep, ins ); <span class="code-comment">//</span><span class="code-comment">push whichever instruction we got.
</span>      }
      <span class="code-keyword">else</span>
    <span class="code-comment">//</span><span class="code-comment">Now we're in a quandary.  We must have seen a t4 or we wouldn't be here.
</span>    <span class="code-comment">//</span><span class="code-comment">So we should return success, right?  But then we saw a '+' or '-'
</span>    <span class="code-comment">//</span><span class="code-comment">NOT followed by a t3.  We don't have any rules for which THAT should
</span>    <span class="code-comment">//</span><span class="code-comment">be considered success.  If we return failure, we're indicating that
</span>    <span class="code-comment">//</span><span class="code-comment">the WHOLE rule failed, from the very first t4 -&gt; t3, which is not
</span>    <span class="code-comment">//</span><span class="code-comment">true; that rule succeeded.  Oh my, oh my!  What should we do?
</span>    <span class="code-comment">//</span><span class="code-comment">Let's take a break and discuss it...
</span>   }
   <span class="code-keyword">return</span> <span class="code-digit">1</span>; <span class="code-comment">//</span><span class="code-comment">at least the original t4 -&gt; t3 rule succeeded.
</span>}</pre>

<p><strong>Pattern:</strong> Implement grammar left recursion via a "<code>while</code>" loop. Don't carelessly create an infinite loop by recursively calling a non-terminal that will bring you right back to the same position in the code!</p>

<h3>More State Saving</h3>

<p>So, what should we do about that '<code>else</code>' clause after seeing "<code>t4 OP </code>", but then NOT seeing a successful <code>t3 </code>non-terminal? I know of two possible approaches.</p>

<h3>The Purist Approach</h3>

<p>In the purist approach, we should attempt to isolate the <code>t4 </code>non-terminal logic from every other non-terminal, and make it stand alone. In this way, if any other parts of the grammar should ever change, the <code>t4 </code>is rock-solid, and will not need to change. Let's think about how to do this. Regardless of whether we want to be a purist, it's worth examining anyway because there may be other situations where this is the only choice we have.</p>

<p>Let's consider input that looks like this:</p>

<div class="pre-action-link" id="premain660223" style="width:100%;display:block;"><span id="prehide660223" onclick="processCodeBlocks.togglePre(660223);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(660223);">Copy Code</span></div><pre lang="text" id="pre660223" style="margin-top: 0px;">"4 + 5 - 6 * 7"
</pre>

<p>The first '<code>4</code>' is a <code>t0 </code>which ultimately reduces to a <code>t3</code>, which generates success for rule #1. We then move into the while loop looking for a '+' or a '-' sign. We get it at the '+' sign. We then call <code>t3 </code>to see what's on the right hand side of the '+' sign. The '<code>5</code>' reduces to a <code>t3 </code>and returns success, which signals we can again reduce via rule #2 to t4. We then continue the <code>while </code>loop and see the '-' sign. We call <code>t3 </code>again and now the entire "6 * 7" reduces to a <code>t3</code>. We move forward still within the <code>while </code>loop looking for the next '+' or '-' sign. There isn't one so the while loop exits and we return <code>1 </code>(the last line of the function).</p>

<p>Now consider this input:</p>

<div class="pre-action-link" id="premain371786" style="width:100%;display:block;"><span id="prehide371786" onclick="processCodeBlocks.togglePre(371786);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(371786);">Copy Code</span></div><pre lang="text" id="pre371786" style="margin-top: 0px;">"4 + 5 - &amp;x"
</pre>

<p>This isn't legal input for our expression grammar, BUT as stated earlier, perhaps the grammar will be extended in the future and we want our rule to stand alone and still work correctly. We need to somehow indicate that the "<code>4 + 5</code>" portion reduced successfully, but return failure for the "<code>- &amp;x</code>" portion of the input. Suppose that we add a rule to the <code>t1 </code>non-terminal:</p>

<div class="pre-action-link" id="premain802627" style="width:100%;display:block;"><span id="prehide802627" onclick="processCodeBlocks.togglePre(802627);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(802627);">Copy Code</span></div><pre lang="text" id="pre802627" style="margin-top: 0px;">t1:           //unary prefix operators.
  -&gt; t0
  -&gt; '-' t0
  -&gt; '+' t0
  -&gt; '&amp;' t0   //new rule</pre>

<p>In this case, since <code>t1 </code>is higher precedence than <code>t4</code>, the "<code>&amp;x</code>" input will successfully reduce to a <code>t3</code>, and everything will work fine: NO ERROR.</p>

<p>But suppose instead that the <code>t6 </code>non-terminal gets a new rule:</p>

<div class="pre-action-link" id="premain326944" style="width:100%;display:block;"><span id="prehide326944" onclick="processCodeBlocks.togglePre(326944);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(326944);">Copy Code</span></div><pre lang="text" id="pre326944" style="margin-top: 0px;">t6:
  -&gt; t5
  -&gt; "not" t5
  -&gt; t6 '-' '&amp;' t0   //new rule  </pre>

<p>Remember our input: </p>

<div class="pre-action-link" id="premain254651" style="width:100%;display:block;"><span id="prehide254651" onclick="processCodeBlocks.togglePre(254651);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(254651);">Copy Code</span></div><pre lang="text" id="pre254651" style="margin-top: 0px;">"4 + 5 - &amp;x"</pre>

<p>Within the <code>t4 </code>non-terminal, the "<code>4 + 5</code>" reduces to a <code>t4</code>, then the minus sign is consumed and the <code>t3 </code>fails with the "<code>&amp;x</code>" input. If we could somehow indicate that the "<code>4+5</code>" successfully reduced to a <code>t4</code>, then it would in-turn reduce to a <code>t5 </code>(via <code>t5 </code>rule #1), which would reduce to a <code>t6 </code>(via <code>t6 </code>rule #1), and we'd be ready to move forward with the rule "<code>t6 -&gt; t6 '-' '&amp;' t0</code>" PROVIDED the minus sign that was consumed in the <code>t4 </code>was replaced.</p>

<p>That is, within the <code>t4 </code>non-terminal, within the <code>while </code>loop, we should keep track of the state at the LAST SUCCESS, and if we do encounter a failure, restore that state before returning SUCCESS.</p>

<p>Let's rewrite <code>t4 </code>with this new information (most of the comments removed to highlight our new-found policy):</p>

<div class="pre-action-link" id="premain486531" style="width:100%;display:block;"><span id="prehide486531" onclick="processCodeBlocks.togglePre(486531);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(486531);">Copy Code</span></div><pre lang="C++" id="pre486531" style="margin-top: 0px;"><span class="code-keyword">int</span> t4( Expression_T* ep )
{
   InstructionEnum_T ins;
   State_T s;

   <span class="code-keyword">if</span>( <span class="code-keyword">not</span> t3( ep ) )
   {
      <span class="code-keyword">return</span> <span class="code-digit">0</span>;
   }
   <span class="code-keyword">while</span>(
           ltrim( &amp;(ep-&gt;infix) ),
          (ins=ADD ,   <span class="code-string">'</span><span class="code-string">+'</span> == *(ep-&gt;infix))
      <span class="code-keyword">or</span>  (ins=SUBT,   <span class="code-string">'</span><span class="code-string">/'</span> == *(ep-&gt;infix))  )
   {
      saveState( &amp;s, ep );  <span class="code-comment">//</span><span class="code-comment">do this BEFORE consuming any tokens.
</span>      ep-&gt;infix += <span class="code-digit">1</span>;       <span class="code-comment">//</span><span class="code-comment">skip past the '+' or '-' (consume it).
</span>      <span class="code-keyword">if</span>( t3( ep ) )        <span class="code-comment">//</span><span class="code-comment">try the rest of the rule.
</span>      {<span class="code-comment">//</span><span class="code-comment">success.
</span>         addInstruction( ep, ins );
      }
      <span class="code-keyword">else</span>  <span class="code-comment">//</span><span class="code-comment">t3 failed.
</span>      {<span class="code-comment">//</span><span class="code-comment">put things back like they were immediately after the last success.
</span>         restoreState( &amp;s, ep );
         <span class="code-keyword">break</span>;                  <span class="code-comment">//</span><span class="code-comment">return success.
</span>      }
   }
   <span class="code-keyword">return</span> <span class="code-digit">1</span>;
}</pre>

<p>This represents a deviation from our earlier policy of not restoring state prior to returning to a calling function. But in this case, since we are inside of a loop, there's just no way for the calling function to know how far along we got before we quit seeing successful reductions. </p>

<p>Actually, since the <code>while </code>loop represents recursion (left recursion), once we get into the loop, THIS FUNCTION IS the calling function (as well as the called function). It is implicitly calling itself. Thus, when we restore state, <code>t4 </code>essentially IS the calling function restoring the context. So this actually is not a deviation from earlier policy.</p>

<p><strong>Pattern:</strong> Within a <code>while </code>loop that represents left recursion, you should save state after each successful production, and if you advance state while looking for a pattern, but the pattern fails, restore state before returning the success indicator. Remember, if you saw ANY successful rules, you return "<code>SUCCESS</code>", not "<code>FAILURE</code>".</p>

<h3>The Pragmatic Approach</h3>

<p>I started the last section by saying there were TWO WAYS to deal with the else clause, and the way we just discussed was the "purist" approach. The other approach is to simply look around the grammar and see where else the '+' and '-' signs appear. Turns out they only appear in this <code>t4 </code>rule, and in the higher-precedence <code>t1 </code>rule. Unlike our fictitious example where we purposely installed a '-' sign in a lower-precedence rule, in the real grammar, once you get a "<code>t4 '-' </code>" there simply are NO OTHER LEGAL productions. If you DON'T get a <code>t3</code>, you have an error in the input. So for our real grammar, we can simplify <code>t4 </code>even more by just raising an error if we get a '+' or '-' but then DON'T get a <code>t3</code>.</p>

<div class="pre-action-link" id="premain754615" style="width:100%;display:block;"><span id="prehide754615" onclick="processCodeBlocks.togglePre(754615);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(754615);">Copy Code</span></div><pre lang="C++" id="pre754615" style="margin-top: 0px;"><span class="code-keyword">int</span> t4( Expression_T* ep )
{
   InstructionEnum_T ins;
   <span class="code-keyword">const</span> <span class="code-keyword">char</span>* oldfix;    <span class="code-comment">//</span><span class="code-comment">instead of the State_T variable "s"
</span>
   <span class="code-keyword">if</span>( <span class="code-keyword">not</span> t3( ep ) )
   {
      <span class="code-keyword">return</span> <span class="code-digit">0</span>;
   }
   <span class="code-keyword">while</span>(
           ltrim( &amp;(ep-&gt;infix) ),
          (ins=ADD ,   <span class="code-string">'</span><span class="code-string">+'</span> == *(ep-&gt;infix))
      <span class="code-keyword">or</span>  (ins=SUBT,   <span class="code-string">'</span><span class="code-string">/'</span> == *(ep-&gt;infix))  )
   {
      ep-&gt;infix += <span class="code-digit">1</span>;       <span class="code-comment">//</span><span class="code-comment">skip past the input token.
</span>      oldfix = ep-&gt;infix;   <span class="code-comment">//</span><span class="code-comment">to get a decent error message if needed.
</span>      <span class="code-keyword">if</span>( t3( ep ) )
         addInstruction( ep, ins );
      <span class="code-keyword">else</span>                  <span class="code-comment">//</span><span class="code-comment">t3 failed.
</span>         error( oldfix );   <span class="code-comment">//</span><span class="code-comment">print the bad input, and abort the compilation.
</span>   }
   <span class="code-keyword">return</span> <span class="code-digit">1</span>;
}</pre>

<p>We still sort-of saved state via the oldfix variable, just not as much state -- it's only a single pointer instead of stack-tops, etc. AND we saved it AFTER advancing past the '+' or '-' token. We needed this in order to get a decent error message if the <code>t3 </code>does fail. If we don't care about telling the user what went wrong, we could even skip this part. BUT, not giving some clue to the user about what went wrong is BAD FORM. Your users will hate you... They will curse you as they pull their hair out hunting for what went wrong. They will lay in bed at night and dream-up bad things to do to you -- ways to make you PAY! SAVE YOURSELF! Just give them a decent error message for pity's sake.</p>

<p>As noted earlier, this version of <code>t4 </code>is no longer independent of the rest of the grammar. If other parts of the grammar change, <code>t4 </code>needs to be reexamined to see whether it is still correct to raise an error within this context.</p>

<p><strong>Pattern:</strong> If you KNOW within a production that you've encountered an error in the input, you can just abort right there (with a nice error message of course), and not worry about returning up the call chain.</p>

<h3>Greedy Input</h3>

<p>Now let's implement the <code>t5 </code>non-terminal. As you'll see, it is pretty much exactly like <code>t4</code>, EXCEPT that there is a subtlety in how to match "<code>&lt;=</code>" instead of "<code>&lt;</code>", and "<code>&gt;=</code>" instead of "<code>&gt;</code>". Here we must be sure to use a greedy algorithm when attempting to consume the comparison token. If we don't, we can incorrectly match the shorter token.</p>

<div class="pre-action-link" id="premain250464" style="width:100%;display:block;"><span id="prehide250464" onclick="processCodeBlocks.togglePre(250464);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(250464);">Copy Code</span></div><pre lang="text" id="pre250464" style="margin-top: 0px;">t5:
  -&gt; t4
  -&gt; t5 "&lt;"  t4
  -&gt; t5 "&lt;=" t4
  -&gt; t5 "&gt;"  t4
  -&gt; t5 "&gt;=" t4</pre>

<div class="pre-action-link" id="premain633263" style="width:100%;display:block;"><span id="prehide633263" onclick="processCodeBlocks.togglePre(633263);">Hide</span>  &nbsp; <span id="preShrink633263" onclick="processCodeBlocks.shrinkExpand(633263);">Shrink</span> <img id="preimg633263" src="./Compiler Patterns - CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(633263);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(633263);">Copy Code</span></div><pre lang="C++" id="pre633263" processed="true" style="margin-top: 0px;"><span class="code-keyword">int</span> t5( Expression_T* ep )
{
   InstructionEnum_T ins;
   <span class="code-keyword">const</span> <span class="code-keyword">char</span>* oldfix;

 <span class="code-comment">//</span><span class="code-comment">this next variable is new to this non-terminal.  It wasn't in the
</span> <span class="code-comment">//</span><span class="code-comment">t3 or t4 nonterminals.  It is the length of the matched token.
</span>   <span class="code-keyword">int</span>  toklen;

   <span class="code-keyword">if</span>( <span class="code-keyword">not</span> t4( ep ) )
   {
      <span class="code-keyword">return</span> <span class="code-digit">0</span>;
   }

 <span class="code-comment">//</span><span class="code-comment">Note that in the following test section, if we search for "&lt;" first,
</span> <span class="code-comment">//</span><span class="code-comment">it will match both "&lt;" and "&lt;=" and will take precedence over "&lt;=".
</span> <span class="code-comment">//</span><span class="code-comment">Thus, we must use a "greedy algorithm" and search for the longest
</span> <span class="code-comment">//</span><span class="code-comment">matching string FIRST.  That is, we must search for "&lt;=" BEFORE
</span> <span class="code-comment">//</span><span class="code-comment">searching for "&lt;", and for "&gt;=" before "&gt;".
</span>
   <span class="code-keyword">while</span>(
           ltrim( &amp;(ep-&gt;infix) ), <span class="code-comment">//</span><span class="code-comment">do this in side-effect context.
</span>
  <span class="code-comment">//</span><span class="code-comment">Now we ALSO store TOKEN LENGTH in side effect context.
</span>          (ins=LT_EQ, toklen=<span class="code-digit">2</span>, <span class="code-digit">0</span> == strncmp( ep-&gt;infix, <span class="code-string">"</span><span class="code-string">&lt;="</span>, <span class="code-digit">2</span> )) / /this first,
      <span class="code-keyword">or</span>  (ins=LT   , toklen=<span class="code-digit">1</span>, <span class="code-digit">0</span> == strncmp( ep-&gt;infix, <span class="code-string">"</span><span class="code-string">&lt;"</span>,  <span class="code-digit">1</span> ))  <span class="code-comment">//</span><span class="code-comment">then this.
</span>      <span class="code-keyword">or</span>  (ins=GT_EQ, toklen=<span class="code-digit">2</span>, <span class="code-digit">0</span> == strncmp( ep-&gt;infix, <span class="code-string">"</span><span class="code-string">&gt;="</span>, <span class="code-digit">2</span> ))  <span class="code-comment">//</span><span class="code-comment">this first,
</span>      <span class="code-keyword">or</span>  (ins=GT   , toklen=<span class="code-digit">1</span>, <span class="code-digit">0</span> == strncmp( ep-&gt;infix, <span class="code-string">"</span><span class="code-string">&gt;"</span>,  <span class="code-digit">1</span> ))) <span class="code-comment">//</span><span class="code-comment">then this.
</span>   {
      ep-&gt;infix += toklen;  <span class="code-comment">//</span><span class="code-comment">skip past the token.
</span>      oldfix = ep-&gt;infix;
      <span class="code-keyword">if</span>( t4( ep ) )        <span class="code-comment">//</span><span class="code-comment">try the rest of the rule.
</span>         addInstruction( ep, ins ); <span class="code-comment">//</span><span class="code-comment">push whichever instruction it was.
</span>      <span class="code-keyword">else</span>
      {
    <span class="code-comment">//</span><span class="code-comment">there are no other uses of these comparator tokens anywhere in the
</span>    <span class="code-comment">//</span><span class="code-comment">grammar.  If they are not being used correctly here, it's
</span>    <span class="code-comment">//</span><span class="code-comment">definitely an error.
</span>         error( oldfix );
      }
   }
   <span class="code-keyword">return</span> <span class="code-digit">1</span>; <span class="code-comment">//</span><span class="code-comment">at least the original t5 -&gt; t4 rule succeeded.
</span>}</pre>

<h3>Primitives</h3>

<p>The code for the <code>t0 </code>(primitives) non-terminal illustrates the requirement to store state between rules, and it illustrates a greedy algorithm in searching for function names.</p>

<p>But before we write it, we need a list of function names that we're going to allow. We'll binary-search this list when looking for a match within the input, so it must be in alphabetic order.</p>

<div class="pre-action-link" id="premain72265" style="width:100%;display:block;"><span id="prehide72265" onclick="processCodeBlocks.togglePre(72265);">Hide</span>  &nbsp; <span id="preShrink72265" onclick="processCodeBlocks.shrinkExpand(72265);">Shrink</span> <img id="preimg72265" src="./Compiler Patterns - CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(72265);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(72265);">Copy Code</span></div><pre lang="C++" id="pre72265" processed="true" style="margin-top: 0px;"><span class="code-keyword">const</span> <span class="code-keyword">char</span>* funcnames[] =
{ <span class="code-string">"</span><span class="code-string">abs"</span>, <span class="code-string">"</span><span class="code-string">acos"</span>, <span class="code-string">"</span><span class="code-string">asin"</span>, <span class="code-string">"</span><span class="code-string">atan"</span>, <span class="code-string">"</span><span class="code-string">atan2"</span>, <span class="code-string">"</span><span class="code-string">ceil"</span>, <span class="code-string">"</span><span class="code-string">cos"</span>, <span class="code-string">"</span><span class="code-string">cosh"</span>, <span class="code-string">"</span><span class="code-string">erf"</span>
, <span class="code-string">"</span><span class="code-string">erfc"</span>, <span class="code-string">"</span><span class="code-string">exp"</span>, <span class="code-string">"</span><span class="code-string">fact"</span>, <span class="code-string">"</span><span class="code-string">floor"</span>, <span class="code-string">"</span><span class="code-string">gamma"</span>, <span class="code-string">"</span><span class="code-string">ln"</span>, <span class="code-string">"</span><span class="code-string">lngamma"</span>, <span class="code-string">"</span><span class="code-string">log10"</span>
, <span class="code-string">"</span><span class="code-string">mod"</span>, <span class="code-string">"</span><span class="code-string">pow"</span>, <span class="code-string">"</span><span class="code-string">sin"</span>, <span class="code-string">"</span><span class="code-string">sinh"</span>, <span class="code-string">"</span><span class="code-string">sqrt"</span>, <span class="code-string">"</span><span class="code-string">tan"</span>, <span class="code-string">"</span><span class="code-string">tanh"</span>
};

<span class="code-keyword">int</span> t0( Expression_T* ep )
{
 <span class="code-comment">//</span><span class="code-comment"> implements primary terms.
</span> <span class="code-comment">//</span><span class="code-comment"> t0:
</span> <span class="code-comment">//</span><span class="code-comment">   -&gt; number
</span> <span class="code-comment">//</span><span class="code-comment">   -&gt; parameter
</span> <span class="code-comment">//</span><span class="code-comment">   -&gt; "pi"
</span> <span class="code-comment">//</span><span class="code-comment">   -&gt; '(' expression ')'
</span> <span class="code-comment">//</span><span class="code-comment">   -&gt; funcname '(' list ')'
</span>
   <span class="code-keyword">double</span>    val;
   <span class="code-keyword">char</span>*     end;
   <span class="code-keyword">const</span> <span class="code-keyword">char</span>* oldfix;
   <span class="code-keyword">int</span>       numargs;  <span class="code-comment">//</span><span class="code-comment">to confirm we got the right number of function args.
</span>   State_T   s;

   FindRet_T fr;

   ltrim( &amp;(ep-&gt;infix) );
   oldfix = ep-&gt;infix ;

 <span class="code-comment">//</span><span class="code-comment"> -&gt; number
</span>   <span class="code-keyword">if</span>( val = strtod( ep-&gt;infix, &amp;end ), (ep-&gt;infix != end) )  <span class="code-comment">//</span><span class="code-comment"> got a number
</span>   {
      addConstant( ep, val );         <span class="code-comment">//</span><span class="code-comment">put this number on the constants array.
</span>      addInstruction( ep, PUSH_C );    <span class="code-comment">//</span><span class="code-comment">push next constant to stack.
</span>      ep-&gt;infix = end;
   }

 <span class="code-comment">//</span><span class="code-comment"> -&gt; parameter
</span>   <span class="code-keyword">else</span> <span class="code-keyword">if</span>((<span class="code-string">'</span><span class="code-string">p'</span> == *(ep-&gt;infix) <span class="code-keyword">or</span> <span class="code-string">'</span><span class="code-string">P'</span> == *(ep-&gt;infix)) <span class="code-comment">//</span><span class="code-comment"> -&gt; parameter
</span>       <span class="code-keyword">and</span> isdigit( *(ep-&gt;infix + <span class="code-digit">1</span>) )                  <span class="code-comment">//</span><span class="code-comment"> 2'nd char is a digit: pd
</span>       <span class="code-keyword">and</span> (    <span class="code-digit">0</span> == *(ep-&gt;infix + <span class="code-digit">2</span>)                   <span class="code-comment">//</span><span class="code-comment">string ends after pd
</span>             <span class="code-keyword">or</span> <span class="code-keyword">not</span> isdigit( *(ep-&gt;infix + <span class="code-digit">2</span>) )         <span class="code-comment">//</span><span class="code-comment">pdx; where x is NOT a digit
</span>             <span class="code-keyword">or</span> <span class="code-digit">0</span> == *(ep-&gt;infix + <span class="code-digit">3</span>)                   <span class="code-comment">//</span><span class="code-comment">string ends after pdd
</span>             <span class="code-keyword">or</span> <span class="code-keyword">not</span> isdigit( *(ep-&gt;infix + <span class="code-digit">3</span>) )) )      <span class="code-comment">//</span><span class="code-comment">pddx; where x is NOT a digit,
</span>   {
      <span class="code-keyword">int</span> pnum = *(ep-&gt;infix + <span class="code-digit">1</span>) - <span class="code-string">'</span><span class="code-string">0'</span>;  <span class="code-comment">//</span><span class="code-comment">convert first digit to a number.
</span>
      ep-&gt;infix += <span class="code-digit">2</span>;  <span class="code-comment">//</span><span class="code-comment">skip past "pd" where d is the first digit.
</span>
      <span class="code-keyword">if</span>( isdigit( *(ep-&gt;infix) ) )  <span class="code-comment">//</span><span class="code-comment">got another digit,
</span>      {
         pnum *= <span class="code-digit">10</span>;
         pnum += *(ep-&gt;infix) - <span class="code-string">'</span><span class="code-string">0'</span> ;<span class="code-comment">//</span><span class="code-comment">add second digit.
</span>         ep-&gt;infix += <span class="code-digit">1</span>;             <span class="code-comment">//</span><span class="code-comment">skip past second digit.
</span>      }
      <span class="code-keyword">if</span>( <span class="code-digit">0</span> == pnum )     <span class="code-comment">//</span><span class="code-comment">parameter numbers begin with 1, not 0.
</span>         error( oldfix );
      addInstruction( ep, (Operation_T)(-pnum) ); <span class="code-comment">//</span><span class="code-comment">negative means
</span>				<span class="code-comment">//</span><span class="code-comment">"push the numbered parameter to stack".
</span>   }

 <span class="code-comment">//</span><span class="code-comment"> -&gt; "pi"
</span>   <span class="code-keyword">else</span> <span class="code-keyword">if</span>( <span class="code-digit">0</span> == strncmp(ep-&gt;infix, <span class="code-string">"</span><span class="code-string">pi"</span>, <span class="code-digit">2</span>) )
   {
      addConstant( ep, <span class="code-digit">3</span>.<span class="code-digit">1415926535897932384626433832795</span> );
      addInstruction( ep, PUSH_C );    <span class="code-comment">//</span><span class="code-comment">push next constant to stack.
</span>      ep-&gt;infix += <span class="code-digit">2</span>; <span class="code-comment">//</span><span class="code-comment">skip past "pi"
</span>   }

 <span class="code-comment">//</span><span class="code-comment"> -&gt; '(' expression ')'
</span> <span class="code-comment">//</span><span class="code-comment">Up to this point in the function, as each of the previous productions
</span> <span class="code-comment">//</span><span class="code-comment">failed, we had not called any other non-terminal functions, and had not
</span> <span class="code-comment">//</span><span class="code-comment">advanced the input pointer.  Therefore we had not needed to save state.
</span> <span class="code-comment">//</span><span class="code-comment">In this rule, however, we're going to drill into the expression non-
</span> <span class="code-comment">//</span><span class="code-comment">terminal, and if that fails, attempt to match the funcname rule.
</span> <span class="code-comment">//</span><span class="code-comment">Therefore, we must save state prior to adjusting anything so that it
</span> <span class="code-comment">//</span><span class="code-comment">will be available for us to restore before attempting the funcname rule.
</span>
   <span class="code-keyword">else</span> <span class="code-keyword">if</span>(  saveState( &amp;s, ep )  , <span class="code-comment">//</span><span class="code-comment">save state in side-effect context
</span>           ( ( <span class="code-string">'</span><span class="code-string">('</span> == *(ep-&gt;infix)) <span class="code-comment">//</span><span class="code-comment">got a leading '('
</span>        <span class="code-keyword">and</span> (ep-&gt;infix++ , expression( ep )) <span class="code-comment">//</span><span class="code-comment">skipped past '(' then got an expression,
</span>        <span class="code-keyword">and</span> (ltrim( &amp;(ep-&gt;infix) ), <span class="code-string">'</span><span class="code-string">)'</span> == *(ep-&gt;infix)) )) <span class="code-comment">//</span><span class="code-comment">got trailing ')'
</span>   {
      ep-&gt;infix++; <span class="code-comment">//</span><span class="code-comment">advance past that last ')'.  No other action req'd.
</span>   }

 <span class="code-comment">//</span><span class="code-comment"> -&gt; funcname '(' list ')'
</span> <span class="code-comment">//</span><span class="code-comment">Here we must be careful to do another greedy comparison.  If we attempt
</span> <span class="code-comment">//</span><span class="code-comment">to search the funcnames array with ep-&gt;infix pointing to "cosh(p3)...",
</span> <span class="code-comment">//</span><span class="code-comment">a binary or linear search will match the "cos" function name UNLESS we
</span> <span class="code-comment">//</span><span class="code-comment">tell it to search for a string of length 4, or we insist on the longest
</span> <span class="code-comment">//</span><span class="code-comment">possible match.
</span> <span class="code-comment">//</span><span class="code-comment">Since the standard library bsearch function does not allow us to pass
</span> <span class="code-comment">//</span><span class="code-comment">an extra argument with the comparison function (i.e. length 4 for the
</span> <span class="code-comment">//</span><span class="code-comment">cosh funcname), we have to come up with a different approach.  We can
</span> <span class="code-comment">//</span><span class="code-comment">either copy out the longest series of letters to a local variable, and
</span> <span class="code-comment">//</span><span class="code-comment">then search the array with that, or use a specialized comparison function.
</span> <span class="code-comment">//</span><span class="code-comment">I chose the second option and implemented funcAryNameCompare.
</span>
   <span class="code-keyword">else</span> <span class="code-keyword">if</span>( restoreState( &amp;s, ep ),   <span class="code-comment">//</span><span class="code-comment">restore state from previous failed attempt,
</span>            fr = binarySearch(oldfix,funcnames,
		FUNCNAMES_LENGTH,<span class="code-keyword">sizeof</span>(<span class="code-keyword">char</span>*),funcAryNameCompare) ,
            (    <span class="code-keyword">not</span> fr.notfound <span class="code-comment">//</span><span class="code-comment">we DID find it in the list,
</span>             <span class="code-keyword">and</span> ( ep-&gt;infix += strlen(funcnames[fr.index]), <span class="code-comment">//</span><span class="code-comment">skip past func name
</span>                   ltrim( &amp;(ep-&gt;infix) ),                    <span class="code-comment">//</span><span class="code-comment">skip past white space
</span>                   <span class="code-string">'</span><span class="code-string">('</span> == *(ep-&gt;infix) )                     <span class="code-comment">//</span><span class="code-comment">got '('
</span>             <span class="code-keyword">and</span> (ep-&gt;infix++ , (numargs=list( ep )))        <span class="code-comment">//</span><span class="code-comment">skip past '('
</span>           <span class="code-comment">//</span><span class="code-comment">list() is unusual in that it returns the number of elements in the list,
</span>             <span class="code-keyword">and</span> (ltrim( &amp;(ep-&gt;infix) ), <span class="code-string">'</span><span class="code-string">)'</span> == *(ep-&gt;infix)) ) <span class="code-comment">//</span><span class="code-comment">got ')'
</span>          )
   {
      <span class="code-keyword">if</span>( numargs-<span class="code-digit">1</span> != opStkUse[fr.index] )
         error( oldfix ); <span class="code-comment">//</span><span class="code-comment">wrong number of args for this func.
</span>      ep-&gt;infix++; <span class="code-comment">//</span><span class="code-comment">advance past that last ')'.
</span>      addInstruction( ep, (Operation_T)(fr.index) ); <span class="code-comment">//</span><span class="code-comment">add a function call.
</span>   }
   <span class="code-keyword">else</span>
   {
      <span class="code-keyword">return</span> False;  <span class="code-comment">//</span><span class="code-comment">didn't get any of the mandatory reductions.
</span>   }
   <span class="code-keyword">return</span> True;
}</pre>

<p><strong>Pattern:</strong> When accepting one of the language tokens, always use greedy input. Look for and accept the longest legal token.</p>

<p>Note that the <code>list() </code>non-terminal function returned the number of items in the list (see the line containing “<code>numargs=list( ep )</code>”), NOT a Boolean value as every other non-terminal does. There’s no reason why you can’t return whatever information you need from any non-terminal function -- including a structure, if that makes sense. Here, we needed to verify that the number of parameters being passed to a function was the correct number. To do this, we encoded success and failure within the return value: zero for failure, and <code>num_items+1</code> otherwise. That way, we can accept empty parameter lists but still get a “success” indicator. Remember, we talked earlier about other changes we would have to make to actually accept empty parameter lists. Here I just wanted to point out how we might want to deal with a "<code>list</code>" non-terminal if it did accept zero parameters. </p>

<p><strong>Pattern</strong>: The return value from a non-terminal does not have to be Boolean – it can be whatever makes sense. You just have to be able to determine from the return value whether the non-terminal succeeded, or failed. </p>

<h3>More Interesting Subtleties</h3>

<p>The "list" non-terminal brought up some interesting points regarding empty lists that we should probably look at. Although not used within the expression evaluator being built for this project, it's worth looking at how "empty" rules might be dealt with.</p>

<p>Let's look at two different scenarios: The first is where we just want to accept empty parameter lists, and return the value "<code>1</code>", indicating success, but "<code>1-1</code>" (or zero) items actually in the list. Here's the code:</p>

<div class="pre-action-link" id="premain987554" style="width:100%;display:block;"><span id="prehide987554" onclick="processCodeBlocks.togglePre(987554);">Hide</span>  &nbsp; <span id="preShrink987554" onclick="processCodeBlocks.shrinkExpand(987554);">Shrink</span> <img id="preimg987554" src="./Compiler Patterns - CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(987554);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(987554);">Copy Code</span></div><pre lang="C++" id="pre987554" processed="true" style="margin-top: 0px;"><span class="code-keyword">static</span> <span class="code-keyword">int</span> list( StaticExpression* ep )
{<span class="code-comment">//</span><span class="code-comment"> implements
</span> <span class="code-comment">//</span><span class="code-comment"> list:
</span> <span class="code-comment">//</span><span class="code-comment">   -&gt; expression
</span> <span class="code-comment">//</span><span class="code-comment">   -&gt; list ',' expression
</span>
<span class="code-comment">//</span><span class="code-comment">returns the number of expressions in the list.
</span>  <span class="code-keyword">const</span> <span class="code-keyword">char</span>* oldfix;
  <span class="code-keyword">int</span>         ret = <span class="code-digit">1</span>;

  <span class="code-keyword">if</span>( <span class="code-keyword">not</span> expression(ep) )  <span class="code-comment">//</span><span class="code-comment">didn't get the first production,
</span>  {<span class="code-comment">//</span><span class="code-comment">this next section is how we accept empty parameter lists.
</span>   <span class="code-comment">//</span><span class="code-comment">this is NOT actually part of the grammar described by
</span>   <span class="code-comment">//</span><span class="code-comment">the BNF above.  It's a short-circuit way of adding another
</span>   <span class="code-comment">//</span><span class="code-comment">formal rule to the t0 non-terminal.  Since the t0()
</span>   <span class="code-comment">//</span><span class="code-comment">function already knows how to deal with zero items in the
</span>   <span class="code-comment">//</span><span class="code-comment">list, it's a no-brainer to add it here.
</span>     <span class="code-keyword">if</span>( ep-&gt;infix = ltrim( ep-&gt;infix ),
         <span class="code-string">'</span><span class="code-string">)'</span> == *(ep-&gt;infix) )
     {
      <span class="code-comment">//</span><span class="code-comment">DON'T consume the ')' token! The funcname rule in t0 needs it.
</span>        <span class="code-keyword">return</span> <span class="code-digit">1</span>;  <span class="code-comment">//</span><span class="code-comment">indicate success, but with empty list.
</span>     }
   <span class="code-comment">//</span><span class="code-comment">OK, apparently it wasn't an empty list.. some other weirdness.
</span>     <span class="code-keyword">return</span> <span class="code-digit">0</span>;             <span class="code-comment">//</span><span class="code-comment">can't go anywhere without getting prod1.
</span>  }
 <span class="code-comment">//</span><span class="code-comment">else, got production 1.
</span>
  <span class="code-keyword">while</span>( ep-&gt;infix = ltrim( ep-&gt;infix ),
         <span class="code-string">'</span><span class="code-string">,'</span> == *(ep-&gt;infix) )
  {<span class="code-comment">//</span><span class="code-comment">looks like we may have (another?) production 2.  Try it.
</span>     ret++ ;
     ep-&gt;infix += <span class="code-digit">1</span>;            <span class="code-comment">//</span><span class="code-comment">advance past the ','.
</span>     oldfix = ep-&gt;infix;
     <span class="code-keyword">if</span>( <span class="code-keyword">not</span> expression(ep) ) <span class="code-comment">//</span><span class="code-comment">no, apparently not production 2.
</span>        error( oldfix );
   <span class="code-comment">//</span><span class="code-comment">no instruction to add.
</span>  }
  <span class="code-keyword">return</span> ret;
}</pre>

<p>And here's another shot at it, but this time we actually accommodate the empty <code>string</code> production, which allows inputs like <code>somefunc( , , 1.5, )</code>. You'll have to decide what <code>eval()</code> action should happen for a <code>null</code> parameter.</p>

<div class="pre-action-link" id="premain565178" style="width:100%;display:block;"><span id="prehide565178" onclick="processCodeBlocks.togglePre(565178);">Hide</span>  &nbsp; <span id="preShrink565178" onclick="processCodeBlocks.shrinkExpand(565178);">Shrink</span> <img id="preimg565178" src="./Compiler Patterns - CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(565178);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(565178);">Copy Code</span></div><pre lang="C++" id="pre565178" processed="true" style="margin-top: 0px;"><span class="code-comment">//</span><span class="code-comment">alternate implementation that allows null strings to be list elements.
</span><span class="code-keyword">static</span> <span class="code-keyword">int</span> list( StaticExpression* ep )
{<span class="code-comment">//</span><span class="code-comment"> implements
</span> <span class="code-comment">//</span><span class="code-comment"> list:
</span> <span class="code-comment">//</span><span class="code-comment">   -&gt; expression           //rule #1
</span> <span class="code-comment">//</span><span class="code-comment">   -&gt; ''                   //rule #2
</span> <span class="code-comment">//</span><span class="code-comment">   -&gt; list ',' expression  //rule #3
</span> <span class="code-comment">//</span><span class="code-comment">   -&gt; list ',' ''          //rule #4
</span>
<span class="code-comment">//</span><span class="code-comment">returns the number of expressions in the list.
</span>  <span class="code-keyword">int</span>         ret = <span class="code-digit">1</span>;
  State_T s;

  saveState(&amp;s, ep);
  <span class="code-keyword">if</span>( <span class="code-keyword">not</span> expression(ep) )  <span class="code-comment">//</span><span class="code-comment">didn't get the first rule,
</span>  {<span class="code-comment">//</span><span class="code-comment">no worries. We'll just assume an empty string (rule #2) and press forward.
</span>     restoreState(&amp;s, ep);
     addInstruction( ep, NULL_LIST_ELEMENT ); <span class="code-comment">//</span><span class="code-comment">not actually implemented.
</span>  }
 <span class="code-comment">//</span><span class="code-comment">check for rule #3
</span>  <span class="code-keyword">while</span>( ep-&gt;infix = ltrim( ep-&gt;infix ),
         <span class="code-string">'</span><span class="code-string">,'</span> == *(ep-&gt;infix) )
  {<span class="code-comment">//</span><span class="code-comment">looks like we may have (another?) rule #3.  Try it.
</span>     ret++ ;
     ep-&gt;infix += <span class="code-digit">1</span>;            <span class="code-comment">//</span><span class="code-comment">advance past the ','.
</span>     saveState(&amp;s, ep);
     <span class="code-keyword">if</span>( <span class="code-keyword">not</span> expression(ep) ) <span class="code-comment">//</span><span class="code-comment">apparently not rule #3.
</span>     {<span class="code-comment">//</span><span class="code-comment">assume rule #4.
</span>        restoreState(&amp;s, ep);
        addInstruction( ep, NULL_LIST_ELEMENT ); <span class="code-comment">//</span><span class="code-comment">not actually implemented.
</span>     }
  }
  <span class="code-keyword">return</span> ret;
}</pre>

<h3>The Branching Mechanism</h3>

<p>The last thing I want to cover in depth in this article is the branching mechanism used to implement the <code>?:</code> conditional operator. It is contained within the "expression" non-terminal.</p>

<p>The branching construct implemented here is effectively an <code>if</code>/<code>else </code>construct (as opposed to a simple "<code>if</code>" construct). As such, it needs two jumps: one conditional jump to the "do this if test is <code>FALSE</code>" section, and one unconditional jump to the "after the whole thing" section. The flow is like this:</p>

<div class="pre-action-link" id="premain63798" style="width:100%;display:block;"><span id="prehide63798" onclick="processCodeBlocks.togglePre(63798);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(63798);">Copy Code</span></div><pre lang="text" id="pre63798" style="margin-top: 0px;">  if( test is false )         //these two lines form the
     goto FALSE_SECTION;      //conditional jump section.
//otherwise, just proceed.

  &lt;code for true section&gt;
  ...
  goto AFTER_SECTION;         //unconditional jump.

 FALSE_SECTION
  &lt;code for false section&gt;
  ...

 AFTER_SECTION
  &lt;code that follows the z?x:y construct&gt;
  ...
</pre>

<p>The way we'll execute these jumps is to store the current state of the instructions array and constants array inside the constants array, along with some <code>PUSH_C</code> instructions to push those constants onto the stack, then well jump to those positions by restoring the state of the two arrays. We'll do this at two different points along the parse of the <code>?: </code>construct; once at each jump.</p>

<p>To help explain how this is going to work, here are the <code>COND_JMP </code>and <code>UNCOND_JMP </code>instructions as they will be executed within the evaluate function. You can see that they pull their operands off the stack, just like every other operation does.</p>

<div class="pre-action-link" id="premain886573" style="width:100%;display:block;"><span id="prehide886573" onclick="processCodeBlocks.togglePre(886573);">Hide</span>  &nbsp; <span id="preShrink886573" onclick="processCodeBlocks.shrinkExpand(886573);">Shrink</span> <img id="preimg886573" src="./Compiler Patterns - CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(886573);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(886573);">Copy Code</span></div><pre lang="C++" id="pre886573" processed="true" style="margin-top: 0px;"><span class="code-keyword">double</span> evaluate( Expression_T* ep, <span class="code-keyword">double</span>* parameters )
{
   <span class="code-keyword">double</span> stack[<span class="code-digit">50</span>];
   <span class="code-keyword">int</span> stktop = -<span class="code-digit">1</span>;       <span class="code-comment">//</span><span class="code-comment">last item ON stack.
</span>   <span class="code-keyword">int</span> constantIndex = <span class="code-digit">0</span>; <span class="code-comment">//</span><span class="code-comment">next constant to push to stack.
</span>   <span class="code-keyword">int</span> indx;
   ...
   <span class="code-keyword">for</span>( indx=<span class="code-digit">0</span>; indx &lt; ep-&gt;instructionsLen; indx++ )
   {
   ...
      <span class="code-keyword">switch</span>( instruction )
      {
         ...
       <span class="code-comment">//</span><span class="code-comment">unconditional jump.  Last operation executed after the "Then" part.
</span>         <span class="code-keyword">case</span> UNCOND_JMP: <span class="code-comment">//</span><span class="code-comment"> Binary operator with no resultant
</span>                 assert( stktop &gt;= <span class="code-digit">1</span> );
                 stktop -= <span class="code-digit">2</span>;  <span class="code-comment">//</span><span class="code-comment">totally remove this construct from the stack.
</span>                 cndx = (<span class="code-keyword">int</span>)stack[stktop+1];    <span class="code-comment">//</span><span class="code-comment">restore the constants array position.
</span>                 indx = (<span class="code-keyword">int</span>)stack[stktop+2]-<span class="code-digit">1</span>;  <span class="code-comment">//</span><span class="code-comment">execute jump: -1 because
</span>                                                 <span class="code-comment">//</span><span class="code-comment"> next thing is an
</span>                                                 <span class="code-comment">//</span><span class="code-comment">increment of this indx loop counter!
</span>                 <span class="code-keyword">break</span>;

       <span class="code-comment">//</span><span class="code-comment">conditional jump. First operation executed as part of the ?: operator.
</span>         <span class="code-keyword">case</span> COND_JMP: <span class="code-comment">//</span><span class="code-comment"> Trinary operator with no resultant
</span>                 assert( stktop &gt;= <span class="code-digit">2</span> );
                 stktop -= <span class="code-digit">3</span>;  <span class="code-comment">//</span><span class="code-comment">totally remove this construct, INCLUDING the test.
</span>                 <span class="code-keyword">if</span>( <span class="code-keyword">not</span> stack[stktop+1] )         <span class="code-comment">//</span><span class="code-comment">if the test evaluated false
</span>                 {<span class="code-comment">//</span><span class="code-comment">execute jump to the "else" part; the ':' part.
</span>                    cndx = (<span class="code-keyword">int</span>)stack[stktop+2];   <span class="code-comment">//</span><span class="code-comment">restore the constants array position.
</span>                    indx = (<span class="code-keyword">int</span>)stack[stktop+3]-<span class="code-digit">1</span>; <span class="code-comment">//</span><span class="code-comment">execute jump: -1 because
</span>                                                   <span class="code-comment">//</span><span class="code-comment">next thing is an
</span>                                                   <span class="code-comment">//</span><span class="code-comment">increment of this indx loop counter!
</span>                 }
               <span class="code-comment">//</span><span class="code-comment">else, test was true: stay and do the "then" part; the '?' part.
</span>                 <span class="code-keyword">break</span>;

         ...
      }
   }
   <span class="code-keyword">return</span> stack[<span class="code-digit">0</span>]; <span class="code-comment">//</span><span class="code-comment">final answer will be here now.
</span>}</pre>

<p>To do all this, however, we're going to need a little more detail within the <code>Expression_T </code>structure.</p>

<div class="pre-action-link" id="premain793918" style="width:100%;display:block;"><span id="prehide793918" onclick="processCodeBlocks.togglePre(793918);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(793918);">Copy Code</span></div><pre lang="C++" id="pre793918" style="margin-top: 0px;"><span class="code-keyword">typedef</span> <span class="code-keyword">struct</span> ExpressionStruct {

   <span class="code-keyword">double</span> *constants;
   <span class="code-keyword">int</span>     constantsLen;
   <span class="code-keyword">int</span>     cndx;            <span class="code-comment">//</span><span class="code-comment">current top of constants "stack"
</span>   <span class="code-keyword">int</span>    *instructions;
   <span class="code-keyword">int</span>     instructionsLen;
   <span class="code-keyword">int</span>     indx;            <span class="code-comment">//</span><span class="code-comment">current top of the instructions "stack"
</span>   <span class="code-keyword">const</span> <span class="code-keyword">char</span>* infix;

} Expression_T;</pre>

<p>It should be obvious that as we call <code>addConstant() </code>and <code>addInstruction() </code>we are incrementing the <code>cndx </code>and <code>indx </code>members respectively.</p>

<div class="pre-action-link" id="premain838486" style="width:100%;display:block;"><span id="prehide838486" onclick="processCodeBlocks.togglePre(838486);">Hide</span>  &nbsp; <span id="preShrink838486" onclick="processCodeBlocks.shrinkExpand(838486);">Shrink</span> <img id="preimg838486" src="./Compiler Patterns - CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(838486);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(838486);">Copy Code</span></div><pre lang="C++" id="pre838486" processed="true" style="margin-top: 0px;">expression:
   -&gt; t9
   -&gt; expression <span class="code-string">'</span><span class="code-string">?'</span> expression : expression

<span class="code-keyword">int</span> expression( Expression_T* ep )
{
   <span class="code-keyword">if</span>( <span class="code-keyword">not</span> t9( ep ) )
      <span class="code-keyword">return</span> <span class="code-digit">0</span>;

 <span class="code-comment">//</span><span class="code-comment">now do the left recursive part.
</span>   <span class="code-keyword">while</span>( ltrim( &amp;(ep-&gt;infix) ), <span class="code-comment">//</span><span class="code-comment">always trim prior to a token
</span>          <span class="code-string">'</span><span class="code-string">?'</span> == *(ep-&gt;infix) )
   {
      <span class="code-keyword">int</span> condJmpConstant;
      <span class="code-keyword">int</span> uncondJmpConstant;

      condJmpConstant = ep-&gt;cndx;   <span class="code-comment">//</span><span class="code-comment">remember where we are on the constants array.
</span>                                    <span class="code-comment">//</span><span class="code-comment">We'll come back to this position later and put
</span>                                    <span class="code-comment">//</span><span class="code-comment">in the "if false" jump targets.  Right now,
</span>                                    <span class="code-comment">//</span><span class="code-comment">we don't know what those targets are.
</span>    <span class="code-comment">//</span><span class="code-comment">we'll come back later and put in the correct target values instead of zeros.
</span>      addConstant( ep, <span class="code-digit">0</span> ); <span class="code-comment">//</span><span class="code-comment">where we'll put the target constants index.
</span>      addConstant( ep, <span class="code-digit">0</span> ); <span class="code-comment">//</span><span class="code-comment">where we'll put the target instructions index.
</span>      addInstruction( ep, PUSH_C );    <span class="code-comment">//</span><span class="code-comment">push constants index to stack.
</span>      addInstruction( ep, PUSH_C );    <span class="code-comment">//</span><span class="code-comment">push instructions index to stack.
</span>      addInstruction( ep, COND_JMP );  <span class="code-comment">//</span><span class="code-comment">the conditional jump instruction.
</span>                                       <span class="code-comment">//</span><span class="code-comment">Uses values on the stack to restore the
</span>                                       <span class="code-comment">//</span><span class="code-comment">indexes of the constants array and the
</span>                                       <span class="code-comment">//</span><span class="code-comment">instructions array.
</span>
      ep-&gt;infix++ ;    <span class="code-comment">//</span><span class="code-comment">move past '?'
</span>      oldfix = ep-&gt;infix;
    <span class="code-comment">//</span><span class="code-comment">Now compile the "Then_exp" part of the if(test)Then_exp else Else_exp
</span>      <span class="code-keyword">if</span>( <span class="code-keyword">not</span> expression( ep ) )
      {
         error( oldfix ); <span class="code-comment">//</span><span class="code-comment"> '?' is only used here, so must be an error.
</span>      }
    <span class="code-comment">//</span><span class="code-comment">We just successfully compiled the "Then" part of the construct.
</span>
    <span class="code-comment">//</span><span class="code-comment">The last instruction of the "Then" part is an unconditional jump past the "Else" part
</span>      uncondJmpConstant = ep-&gt;cndx; <span class="code-comment">//</span><span class="code-comment">remember where to put the unconditional jump targets
</span>    <span class="code-comment">//</span><span class="code-comment">we'll come back later and put in the correct target values instead of zeros.
</span>      addConstant( ep, <span class="code-digit">0</span> ); <span class="code-comment">//</span><span class="code-comment">where we'll put the target constants index.
</span>      addConstant( ep, <span class="code-digit">0</span> ); <span class="code-comment">//</span><span class="code-comment">where we'll put the target instructions index.
</span>      addInstruction( ep, PUSH_C );    <span class="code-comment">//</span><span class="code-comment">push constants index to stack.
</span>      addInstruction( ep, PUSH_C );    <span class="code-comment">//</span><span class="code-comment">push instructions index to stack.
</span>      addInstruction( ep, UNCOND_JMP ); <span class="code-comment">//</span><span class="code-comment">the UNconditional jump instruction.
</span>
    <span class="code-comment">//</span><span class="code-comment">we're now completely past the "Then" phrase.  Now we know what the
</span>    <span class="code-comment">//</span><span class="code-comment">"if false" jump targets are (where we are right now).  Go back and
</span>    <span class="code-comment">//</span><span class="code-comment">fill them in.
</span>      ep-&gt;constants[condJmpConstant]   = ep-&gt;cndx;
      ep-&gt;constants[condJmpConstant+1] = ep-&gt;indx;

    <span class="code-comment">//</span><span class="code-comment">continue parsing. Move past the "   :" part of the production rule.
</span>      ltrim( &amp;(ep-&gt;infix);
      <span class="code-keyword">if</span>( <span class="code-string">'</span><span class="code-string">:'</span> != *(ep-&gt;infix) ) <span class="code-comment">//</span><span class="code-comment">didn't get the ':' expected,
</span>      {
         error( oldfix ); <span class="code-comment">//</span><span class="code-comment"> '?' is only used here, so must be an error.
</span>      }
      ep-&gt;infix++ ;    <span class="code-comment">//</span><span class="code-comment">move past the ':'
</span>      oldfix = ep-&gt;infix;

    <span class="code-comment">//</span><span class="code-comment">We're ready now to compile the "Else" part.
</span>      <span class="code-keyword">if</span>( <span class="code-keyword">not</span> expression( ep ) )
      {
         error( oldfix );
      }
    <span class="code-comment">//</span><span class="code-comment">We just successfully compiled the "Else" part of the construct.
</span>    <span class="code-comment">//</span><span class="code-comment">That is, we're at the very end of the z?x:y construct.
</span>
    <span class="code-comment">//</span><span class="code-comment">fill in where to jump to after the "Then" part; the unconditional jump.
</span>      ep-&gt;constants[uncondJmpConstant]   = ep-&gt;cndx;
      ep-&gt;constants[uncondJmpConstant+1] = ep-&gt;indx;
   }
   <span class="code-keyword">return</span> True;
}</pre>

<p><strong>Pattern:</strong> You may have to write a good bit of "compiler" code within your "parser". I can't think of any way we could have fully accepted the <code>?:</code> construct in one step, THEN gone back and filled in the details. We had to mix it up along the way.</p>

<h3>The main() Routine</h3>

<p>Any time you implement a compiler, and especially if you do it by hand as we have done the expression compiler, you should build a really good test suite. While I'm not going to discuss building it, I will say that it's a good idea to start by testing the simplest constructs first, and then slowly build upon success. The "<code>main()</code>" routine in the expression source contains the tests I implemented.</p>

<p>By the time I have software up and running, I usually have it just chock-full of debugging statements. I find the most effective debugging to be a combination of an interactive debugger (like Visual C++) AND a logfile generation mechanism. The logfile lets me quickly jump to the position in the execution where I'm trying to figure out what's going on. The <em>expression.c</em> source code is no different. The actual code (as opposed to the example code I've included in the article) is full of assertions and debugging code.</p>

<p>It's also a good idea when writing a test routine to NOT fill up the output screen on success, but rather to only throw error messages on actual errors. On my 3GHz machine, if I have full debugging output turned on, it takes about 7 seconds to output all the data from the test cases. On the other hand, if I have the debugging turned off, and ONLY ask it to run the internal tests (without tracing), it completes as quickly as I hit the return key. This is a whole lot better option in case someone wants to put a script together to run test suites on many different libraries.</p>

<p>One thing that occurred to me during testing was that there is not a sure-fire way of determining HOW the expression system is going to compile any particular infix expression handed to it at run time. Here is the scenario: I put in an expression into my <em>.ini</em> file, read it in, compile it, and HOPE that the expression compiler interprets it the same way I intended! Yes, I could write a separate program to read in the expression and compute it and compare against known outputs, but that seems a lot of work for the USER of these routines. Therefore, I included a section within the <code>main() </code>program that can be used interactively for just this purpose. Additionally, if someone is uncertain that the compiler is actually parsing the expression correctly, I included the "<code>-trace</code>" option to show the top few elements on the stack during evaluation, and how the operation is being performed. One can compare this against a hand-generated RPN version of the same expression.</p>

<p>I have found the test version of the program to be so useful for everyday work, that I renamed it "<em>eval.exe</em>" and put it in my path so I can call it from the command line. Now I use it regularly for quick little computations that I used to use the Windows "<code>calc</code>" program for, or would break open a spreadsheet for.</p>

<h2>Summary</h2>

<p>With careful consideration, and a simple enough grammar, the patterns identified in this article can be used to successfully roll your own recursive descent parser/compiler. Considering the time it takes to learn a compiler-compiler system, it MAY be a more effective use of your time to roll your own compiler than to learn a new system. I'd say that the complexity of the expression grammar implemented in this article is on the ragged edge of needing to break out a compiler-compiler.</p>

<p>Regardless of whether you roll your own, or use a compiler-compiler, you must CLEARLY UNDERSTAND what the compiler needs to do upon recognizing each production rule. The non-terminal function that implemented the branching construct (the "<code>expression()</code>" non-terminal above) should have been a good example of that principle. A compiler-compiler cannot help you with this. The compiler-compiler just helps you implement the grammar correctly, and get the production actions in the right place.</p>

<h2>*Final Thoughts</h2>

<p>*From the introduction paragraph: "...software magically evolves" (wink) when smart people are in the presence of patterns. Of course, WE know there's nothing magical about it: it's a lot of thought and hard work. But biological machines (living organisms), which are orders of magnitude more complex than any software or hardware ever seen, apparently do evolve without the benefit of any "smartness" (or intelligence) whatsoever. They just spring into existence by pure random chance.</p>

<p>I once heard a very smart programmer say that trusting things to chance was not a good way to write software. As a mechanical engineer myself, I can affirm that this principle also applies in machine design; randomly stringing mechanical-components together just doesn't cut it. Apparently, however, random chance works GREAT in biological design. Pure random chance composed not just any-old biological machine, but machines so complex that they can reproduce, and one of them is so sophisticated that it even designs computers and writes software! Just unbelievable...</p>

<p>Hmmmm. A compiler-compiler "writes" software, kind-of mimicking the actions of a biological machine (it mimics the actions of those so-called "humans"). I'm thinking a really great compiler-compiler can be had by just randomly scrambling lots of instructions together. And hey, isn't that how YACC originally came about (but it evolved in the days of slower computers. Today, we have better random number generators and faster computers so this new compiler-compiler will be much smarter / more evolved). I'M ON IT!<nbsp><nbsp> <img src="./Compiler Patterns - CodeProject_files/smiley_wink.gif" align="top" alt="Wink | ;-)"> </nbsp></nbsp></p>

<p>Have fun building YOUR compiler!</p>

<p>David Qualls</p>

<h2>History</h2>

<ul>
<li>17<sup>th</sup> November, 2011: Initial version </li>

<li>5<sup>th</sup> December, 2011: Article updated </li>
</ul>


						</div>
						

						<div class="float-right" style="margin:20px 0 0 10px;border:1px solid #ccc">
						<div class="msg-300x250" data-format="300x250" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="General-Programming/Algorithms-Recipes/Compilers" data-loadonview="true" data-tags="C, Intermediate, BNF,rating4.5"></div>
						</div>
                        
                        
						
						<h2>License</h2>
						<div id="LicenseTerms"><p>This article, along with any associated source code and files, is licensed under <a href="http://www.codeproject.com/info/cpol10.aspx" rel="license">The Code Project Open License (CPOL)</a></p></div>
						

                        
						<h2>Share</h2>
				        <div class="share-list">
					        



<!-- Buttons start here. Copy this ul to your document. -->
<ul class="rrssb-buttons clearfix rrssb-1">
    <li class="email" data-initwidth="16.666666666666668" data-size="34" style="width: calc(50% - 84px);">

        <a href="mailto:?subject=Compiler%20Patterns%20-%20CodeProject&amp;body=Here%27s%20an%20interesting%20article%20on%20for%20you%20on%20codeproject.com%0a%0ahttp%3a%2f%2fwww.codeproject.com%2fArticles%2f286121%2fCompiler-Patterns%0a">
            <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve"><g>
                        <path d="M20.111 26.147c-2.336 1.051-4.361 1.401-7.125 1.401c-6.462 0-12.146-4.633-12.146-12.265 
                            c0-7.94 5.762-14.833 14.561-14.833c6.853 0 11.8 4.7 11.8 11.252c0 5.684-3.194 9.265-7.399 
                            9.3 c-1.829 0-3.153-0.934-3.347-2.997h-0.077c-1.208 1.986-2.96 2.997-5.023 2.997c-2.532 
                            0-4.361-1.868-4.361-5.062 c0-4.749 3.504-9.071 9.111-9.071c1.713 0 3.7 0.4 4.6 0.973l-1.169 
                            7.203c-0.388 2.298-0.116 3.3 1 3.4 c1.673 0 3.773-2.102 3.773-6.58c0-5.061-3.27-8.994-9.303-8.994c-5.957 
                            0-11.175 4.673-11.175 12.1 c0 6.5 4.2 10.2 10 10.201c1.986 0 4.089-0.43 5.646-1.245L20.111 
                            26.147z M16.646 10.1 c-0.311-0.078-0.701-0.155-1.207-0.155c-2.571 0-4.595 2.53-4.595 5.529c0 
                            1.5 0.7 2.4 1.9 2.4 c1.441 0 2.959-1.828 3.311-4.087L16.646 10.068z"></path></g>
                </svg>
            </span>
            <span class="text">email</span>
        </a>
    </li>
    <li class="twitter" data-initwidth="16.666666666666668" data-size="48" style="width: calc(50% - 84px);">
        <!-- Replace href with your Meta and URL information  -->
        <a href="http://twitter.com/home?status=Compiler+Patterns+-+CodeProject+-+http%3a%2f%2fwww.codeproject.com%2fArticles%2f286121%2fCompiler-Patterns" class="popup">
            <span class="icon">
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32
                    c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155
                    C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965
                    C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683
                    c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851
                    C26.275,7.229,25.39,8.196,24.253,8.756z"></path>
                </svg>
            </span>
            <span class="text">twitter</span>
        </a>
    </li>

    <li class="facebook small" data-initwidth="16.666666666666668" data-size="57" style="width: 42px;">
        <!-- Replace with your URL. For best results, make sure you page has the proper FB Open Graph tags in header: 
        https://developers.facebook.com/docs/opengraph/howtos/maximizing-distribution-media-content/ -->
        <a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fwww.codeproject.com%2fArticles%2f286121%2fCompiler-Patterns" class="popup">
            <span class="icon">
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                    <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434
                        c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726
                        c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"></path>
                </svg>
            </span>
            <span class="text">facebook</span>
        </a>
    </li>
    
    <li class="linkedin small" data-initwidth="16.666666666666668" data-size="52" style="width: 42px;">
        <!-- Replace href with your meta and URL information -->
        <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fwww.codeproject.com%2fArticles%2f286121%2fCompiler-Patterns&amp;title=Compiler+Patterns+-+CodeProject&amp;summary=&amp;source=codeproject.com" class="popup">
            <span class="icon">
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                    <path d="M25.424,15.887v8.447h-4.896v-7.882c0-1.979-0.709-3.331-2.48-3.331c-1.354,0-2.158,0.911-2.514,1.803
                        c-0.129,0.315-0.162,0.753-0.162,1.194v8.216h-4.899c0,0,0.066-13.349,0-14.731h4.899v2.088c-0.01,0.016-0.023,0.032-0.033,0.048
                        h0.033V11.69c0.65-1.002,1.812-2.435,4.414-2.435C23.008,9.254,25.424,11.361,25.424,15.887z M5.348,2.501
                        c-1.676,0-2.772,1.092-2.772,2.539c0,1.421,1.066,2.538,2.717,2.546h0.032c1.709,0,2.771-1.132,2.771-2.546
                        C8.054,3.593,7.019,2.501,5.343,2.501H5.348z M2.867,24.334h4.897V9.603H2.867V24.334z"></path>
                </svg>
            </span>
            <span class="text">linkedin</span>
        </a>
    </li>
    <li class="reddit small" data-initwidth="16.666666666666668" data-size="40" style="width: 42px;">
        <a href="http://www.reddit.com/submit?url=http%3a%2f%2fwww.codeproject.com%2fArticles%2f286121%2fCompiler-Patterns&amp;title=Compiler+Patterns+-+CodeProject">
            <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve"><g>
                <path d="M11.794 15.316c0-1.029-0.835-1.895-1.866-1.895c-1.03 0-1.893 0.865-1.893 1.895s0.863 1.9 1.9 1.9 C10.958 17.2 11.8 16.3 11.8 15.316z"></path>
                <path d="M18.1 13.422c-1.029 0-1.895 0.864-1.895 1.895c0 1 0.9 1.9 1.9 1.865c1.031 0 1.869-0.836 1.869-1.865 C19.969 14.3 19.1 13.4 18.1 13.422z"></path>
                <path d="M17.527 19.791c-0.678 0.678-1.826 1.006-3.514 1.006c-0.004 0-0.009 0-0.014 0c-0.004 0-0.01 0-0.015 0 
                c-1.686 0-2.834-0.328-3.51-1.005c-0.264-0.265-0.693-0.265-0.958 0c-0.264 0.265-0.264 0.7 0 1 c0.943 0.9 2.4 1.4 
                4.5 1.402c0.005 0 0 0 0 0c0.005 0 0 0 0 0c2.066 0 3.527-0.459 4.47-1.402 c0.265-0.264 0.265-0.693 0.002-0.958C18.221 
                19.5 17.8 19.5 17.5 19.791z"></path><path d="M27.707 13.267c0-1.785-1.453-3.237-3.236-3.237c-0.793 0-1.518 0.287-2.082 
                0.761c-2.039-1.295-4.646-2.069-7.438-2.219 l1.483-4.691l4.062 0.956c0.071 1.4 1.3 2.6 2.7 2.555c1.488 0 2.695-1.208 
                2.695-2.695C25.881 3.2 24.7 2 23.2 2 c-1.059 0-1.979 0.616-2.42 1.508l-4.633-1.091c-0.344-0.081-0.693 0.118-0.803 
                0.455l-1.793 5.7 C10.548 8.6 7.7 9.4 5.6 10.75C5.006 10.3 4.3 10 3.5 10.029c-1.785 0-3.237 1.452-3.237 3.2 c0 1.1 0.6 
                2.1 1.4 2.69c-0.04 0.272-0.061 0.551-0.061 0.831c0 2.3 1.3 4.4 3.7 5.9 c2.299 1.5 5.3 2.3 8.6 2.325c3.228 0 6.271-0.825 
                8.571-2.325c2.387-1.56 3.7-3.66 3.7-5.917 c0-0.26-0.016-0.514-0.051-0.768C27.088 15.5 27.7 14.4 27.7 13.267z M23.186 
                3.355c0.74 0 1.3 0.6 1.3 1.3 c0 0.738-0.6 1.34-1.34 1.34s-1.342-0.602-1.342-1.34C21.844 4 22.4 3.4 23.2 3.355z M1.648 
                13.3 c0-1.038 0.844-1.882 1.882-1.882c0.31 0 0.6 0.1 0.9 0.209c-1.049 0.868-1.813 1.861-2.26 2.9 C1.832 14.2 1.6 13.8 1.6 
                13.267z M21.773 21.57c-2.082 1.357-4.863 2.105-7.831 2.105c-2.967 0-5.747-0.748-7.828-2.105 
                c-1.991-1.301-3.088-3-3.088-4.782c0-1.784 1.097-3.484 3.088-4.784c2.081-1.358 4.861-2.106 7.828-2.106 c2.967 0 5.7 
                0.7 7.8 2.106c1.99 1.3 3.1 3 3.1 4.784C24.859 18.6 23.8 20.3 21.8 21.57z M25.787 14.6 
                c-0.432-1.084-1.191-2.095-2.244-2.977c0.273-0.156 0.59-0.245 0.928-0.245c1.035 0 1.9 0.8 1.9 1.9 
                C26.354 13.8 26.1 14.3 25.8 14.605z"></path></g></svg>
            </span>
            <span class="text">reddit</span>
        </a>
    </li>
    <li class="googleplus small" data-initwidth="16.666666666666668" data-size="52" style="width: 42px;">
        <!-- Replace href with your meta and URL information.  -->
        <a href="https://plus.google.com/share?url=http%3a%2f%2fwww.codeproject.com%2fArticles%2f286121%2fCompiler-Patterns" class="popup">
            <span class="icon">
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                    <g>
                        <g>
                            <path d="M14.703,15.854l-1.219-0.948c-0.372-0.308-0.88-0.715-0.88-1.459c0-0.748,0.508-1.223,0.95-1.663
                                c1.42-1.119,2.839-2.309,2.839-4.817c0-2.58-1.621-3.937-2.399-4.581h2.097l2.202-1.383h-6.67c-1.83,0-4.467,0.433-6.398,2.027
                                C3.768,4.287,3.059,6.018,3.059,7.576c0,2.634,2.022,5.328,5.604,5.328c0.339,0,0.71-0.033,1.083-0.068
                                c-0.167,0.408-0.336,0.748-0.336,1.324c0,1.04,0.551,1.685,1.011,2.297c-1.524,0.104-4.37,0.273-6.467,1.562
                                c-1.998,1.188-2.605,2.916-2.605,4.137c0,2.512,2.358,4.84,7.289,4.84c5.822,0,8.904-3.223,8.904-6.41
                                c0.008-2.327-1.359-3.489-2.829-4.731H14.703z M10.269,11.951c-2.912,0-4.231-3.765-4.231-6.037c0-0.884,0.168-1.797,0.744-2.511
                                c0.543-0.679,1.489-1.12,2.372-1.12c2.807,0,4.256,3.798,4.256,6.242c0,0.612-0.067,1.694-0.845,2.478
                                c-0.537,0.55-1.438,0.948-2.295,0.951V11.951z M10.302,25.609c-3.621,0-5.957-1.732-5.957-4.142c0-2.408,2.165-3.223,2.911-3.492
                                c1.421-0.479,3.25-0.545,3.555-0.545c0.338,0,0.52,0,0.766,0.034c2.574,1.838,3.706,2.757,3.706,4.479
                                c-0.002,2.073-1.736,3.665-4.982,3.649L10.302,25.609z"></path>
                            <polygon points="23.254,11.89 23.254,8.521 21.569,8.521 21.569,11.89 18.202,11.89 18.202,13.604 21.569,13.604 21.569,17.004
                                23.254,17.004 23.254,13.604 26.653,13.604 26.653,11.89      "></polygon>
                        </g>
                    </g>
                </svg>
            </span>
            <span class="text">google+</span>
        </a>
    </li>
    
</ul>
<!-- Buttons end here -->

				        </div> 
    			        


						
						<h2 id="ctl00_AboutHeading">About the Author</h2>
						    


<div class="author-wrapper">

    <div class="pic-wrapper"> 
        <img id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberPhoto" class="profile-pic" src="./Compiler Patterns - CodeProject_files/member_unknown.gif" style="border-width:0px;transform:rotate(3deg);">

    </div>

    <div class="container-member">  
        <b><a id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberProfileLink" class="author" href="http://www.codeproject.com/Members/DQNOK">DQNOK</a></b>

        <table class="extended">
        <tbody><tr>
            <td rowspan="2" nowrap="" valign="middle">
            
            </td>
            <td width="100%">
                <div class="company">
                    <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberJobTitle">Software Developer</span>
	                <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberCompany">Quite Large</span>
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberLocation">United States <img src="./Compiler Patterns - CodeProject_files/US.gif" alt="United States" width="16px" height="11px"></span>
            </td>
        </tr>
        </tbody></table>
    </div>

    <div class="description">
        Education:<br>
-BS Mechanical Engineering<br>
-MS Mechanical Engineering<br>
Languages:<br>
-Perl<br>
-C (and some C++)<br>
-Fortran<br>
-VB <br>
Past Jobs:<br>
-Jet engines<br>
-Adjunct Engineering Professor<br>
-Structural Tracking System IT Engr<br>
Current Job:<br>
-Mathematician/Forecasting Models Architect/Implementer

        
    </div>

</div><br>
						
						

						<div class="clearfix"></div>

						<div style="padding-top:8px">
							
						</div>

					

				    
					</form>

				</div>

				
				<div class="bottom-promo"> 
				    <div class="msg-728x90" data-format="728x90" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="General-Programming/Algorithms-Recipes/Compilers" data-loadonview="true" data-tags="C, Intermediate, BNF,rating4.5,pos_bottom"></div>
				</div>
				

                
        <h2 id="ctl00_AlsoRead_RelatedResults_ctl00_Header" class="also-read">You may also be interested in...</h2>
        <table class="spaced content-list also-read">
    
	    <tbody><tr>
        <td class="content-list-item" width="50%" valign="top">
            <div class="thumbnail"><a id="ctl00_AlsoRead_RelatedResults_ctl01_Thumbnail" href="http://www.codeproject.com/Articles/438922/Design-Patterns-of-Structural-Design-Patterns"><img src="./Compiler Patterns - CodeProject_files/Thumb-438922.jpg" alt="" style="border-width:0px;"></a></div>
            <div class="text">
                <div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl01_Link" href="http://www.codeproject.com/Articles/438922/Design-Patterns-of-Structural-Design-Patterns">Design Patterns 2 of 3 - Structural Design Patterns</a></div>
                
            </div>
        </td>
	
        <td class="content-list-item" width="50%" valign="top">
            <div class="thumbnail"><a id="ctl00_AlsoRead_RelatedResults_ctl02_Thumbnail" href="http://www.codeproject.com/ResearchLibrary/123/Challenging-Some-of-the-Myths-About-Static-Code-An"><img src="./Compiler Patterns - CodeProject_files/LibraryItemThumbnail_123_100x130.png" alt="" style="border-width:0px;"></a></div>
            <div class="text">
                <div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl02_Link" href="http://www.codeproject.com/ResearchLibrary/123/Challenging-Some-of-the-Myths-About-Static-Code-An">Challenging Some of the Myths About Static Code Analysis</a></div>
                
            </div>
        </td>
	    </tr>
	
	    <tr>
        <td class="content-list-item" width="50%" valign="top">
            <div class="thumbnail"><a id="ctl00_AlsoRead_RelatedResults_ctl03_Thumbnail" href="http://www.codeproject.com/Articles/17607/The-Option-Pattern"><img src="./Compiler Patterns - CodeProject_files/article100x80.png" alt="" style="border-width:0px;"></a></div>
            <div class="text">
                <div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl03_Link" href="http://www.codeproject.com/Articles/17607/The-Option-Pattern">The Option Pattern</a></div>
                
            </div>
        </td>
	
        <td class="content-list-item" width="50%" valign="top">
            <div class="thumbnail"><a id="ctl00_AlsoRead_RelatedResults_ctl04_Thumbnail" href="http://www.codeproject.com/Articles/1086361/Java-for-Bluetooth-LE-applications"><img src="./Compiler Patterns - CodeProject_files/article100x80.png" alt="" style="border-width:0px;"></a></div>
            <div class="text">
                <div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl04_Link" href="http://www.codeproject.com/Articles/1086361/Java-for-Bluetooth-LE-applications">Java for Bluetooth LE applications </a></div>
                
            </div>
        </td>
	    </tr>
	
	    <tr>
        <td class="content-list-item" width="50%" valign="top">
            <div class="thumbnail"><a id="ctl00_AlsoRead_RelatedResults_ctl05_Thumbnail" href="http://www.codeproject.com/Articles/511874/Understanding-the-Decorator-Pattern"><img src="./Compiler Patterns - CodeProject_files/article100x80.png" alt="" style="border-width:0px;"></a></div>
            <div class="text">
                <div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl05_Link" href="http://www.codeproject.com/Articles/511874/Understanding-the-Decorator-Pattern">Understanding the Decorator Pattern</a></div>
                
            </div>
        </td>
	
        <td class="content-list-item" width="50%" valign="top">
            <div class="thumbnail"><a id="ctl00_AlsoRead_RelatedResults_ctl06_Thumbnail" href="http://www.codeproject.com/Articles/1086350/Case-Study-Build-a-Smart-Conference-System-by-Enab"><img src="./Compiler Patterns - CodeProject_files/Thumb-1086350.png" alt="" style="border-width:0px;"></a></div>
            <div class="text">
                <div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl06_Link" href="http://www.codeproject.com/Articles/1086350/Case-Study-Build-a-Smart-Conference-System-by-Enab">Case Study：Build a Smart Conference System by Enabling ZigBee on the Intel® Edison Platform</a></div>
                
            </div>
        </td>
	    </tr>
	
		</tbody></table>
	



				
				

					<h2>Comments and Discussions</h2>
					<a class="float-left" name="_comments" id="_comments">&nbsp;</a><div id="_MessageBoardctl00_MessageBoard" onclick="return SwitchMessage(event, null)">
<table id="ForumTable" class="forum relaxed" cellpadding="0" cellspacing="0">
<tbody><tr>
<td class="header1 callout"><b>You must <a href="https://www.codeproject.com/script/Membership/LogOn.aspx?rp=%2fArticles%2f286121%2fCompiler-Patterns%3ffid%3d1666082%26df%3d90%26mpp%3d25%26prof%3dFalse%26sort%3dPosition%26view%3dNormal%26spc%3dRelaxed">Sign In</a> to use this message board.</b></td>
</tr><tr>
<td><table width="100%" border="0" cellpadding="3px" cellspacing="0">
<tbody><tr class="header1">
<td colspan="2" style="white-space:nowrap;"><div class="container">
<div class="float-right">
<form action="http://www.codeproject.com/Search.aspx?sbo=fm" method="get" class="searchbar">
<input type="hidden" name="fid" value="1666082"><input type="hidden" name="sbo" value="fm"><b>Search Comments </b><input type="search" class="search" name="qf">&nbsp;<input type="submit" value="Go" class="button">
</form>
</div>
</div></td>
</tr><tr class="header2">
<td></td><td style="width:100%;"><div style="text-align:right;">
<form action="http://www.codeproject.com/script/Forums/SetOptions.aspx?floc=%2fArticles%2f286121%2fCompiler-Patterns&amp;fid=1666082&amp;df=90&amp;mpp=25&amp;prof=False&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed" method="get" style="margin:0;padding:0;">
<input type="hidden" name="fid" value="1666082"><input type="hidden" name="currentQS" value="?floc=%2fArticles%2f286121%2fCompiler-Patterns&amp;fid=1666082&amp;df=90&amp;mpp=25&amp;prof=False&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed"><input type="hidden" name="floc" value="/Articles/286121/Compiler-Patterns"><input type="checkbox" name="prof" id="prof" style="vertical-align:middle;"><label for="prof">Profile popups</label>&nbsp;&nbsp;&nbsp;&nbsp;Spacing<select size="1" class="dropdown" name="spc">
<option selected="" value="Relaxed">Relaxed</option><option value="Compact">Compact</option><option value="Tight">Tight</option>
</select>&nbsp;&nbsp;Layout<select size="1" class="dropdown" name="view">
<option selected="" value="Normal">Normal</option><option value="Topic">Open Topics</option><option value="Expanded">Open All</option><option value="Thread">Thread View</option>
</select>&nbsp;&nbsp;Per page<select size="1" class="dropdown" name="mpp">
<option value="10">10</option><option selected="" value="25">25</option><option value="50">50</option>
</select>&nbsp;&nbsp;&nbsp;<input type="submit" value="Update" name="SetOpt" class="button">
</form>
</div></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><a name="xx0xx"></a><table border="0" cellpadding="2px" cellspacing="0" width="100%">
<tbody><tr class="navbar">
<td></td><td style="text-align:right;width:50%;"></td><td style="text-align:right;white-space:nowrap;"><span class="nav-link disabled">First</span> <span class="nav-link disabled">Prev</span> <span class="nav-link disabled">Next</span></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%" class="fixed-layout blank-background">
<tbody><tr>
<td><img src="./Compiler Patterns - CodeProject_files/t(1).gif" border="0" width="1px" height="5px" alt=""></td>
</tr><tr id="F5137192_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx5137192xx"></a><img height="16px" width="16px" align="top" src="./Compiler Patterns - CodeProject_files/msg_general.gif" alt="General"></td><td class="subject hover-container"><a class="message-link" name="5137192" parent="0" thread="5137192" href="http://www.codeproject.com/Messages/5137192/My-vote-of.aspx">My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" title="Click to pin message"><img src="./Compiler Patterns - CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Mohammad Shuvo</span><span class="date">2-Oct-15  7:30</span>
</div></td><td class="icon"><img border="0" src="./Compiler Patterns - CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=9344542">Mohammad Shuvo</a></span></td><td class="date"><span>2-Oct-15  7:30&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5137192_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div class="voteform vertical" ownerid="9344542" msgid="5137192" votingtype="GoodOrBad">

</div><img src="./Compiler Patterns - CodeProject_files/t(1).gif" height="1px" width="20px" alt=""></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Nice. This article is very very helpful for me.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/286121/Compiler-Patterns">Sign In</a>·<wbr><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=5137192" title="View Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/5137192/My-vote-of.aspx" title="Get permanent link">Permalink</a></td><td style="text-align:right;"><span id="MVF5137192" data-ref="3_5137192" class="rating-label" style="white-space:nowrap;"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4366096_h0" class="header hover-row root">
<td class="subject-line normal  vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4366096xx"></a><img height="16px" width="16px" align="top" src="./Compiler Patterns - CodeProject_files/msg_general.gif" alt="General"></td><td class="subject hover-container"><a class="message-link" name="4366096" parent="0" thread="4366096" href="http://www.codeproject.com/Messages/4366096/My-vote-of.aspx">My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" title="Click to pin message"><img src="./Compiler Patterns - CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Kanasz Robert</span><span class="date">13-Sep-12  7:46</span>
</div></td><td class="icon"><img border="0" src="./Compiler Patterns - CodeProject_files/icn-MVP-16.gif" title="mvp" alt="mvp" height="16px"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=7059641">Kanasz Robert</a></span></td><td class="date"><span>13-Sep-12  7:46&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4366096_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div class="voteform vertical" ownerid="7059641" msgid="4366096" votingtype="GoodOrBad">

</div><img src="./Compiler Patterns - CodeProject_files/t(1).gif" height="1px" width="20px" alt=""></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Excellent<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/286121/Compiler-Patterns">Sign In</a>·<wbr><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4366096" title="View Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4366096/My-vote-of.aspx" title="Get permanent link">Permalink</a></td><td style="text-align:right;"><span id="MVF4366096" data-ref="3_4366096" class="rating-label" style="white-space:nowrap;"><span>5.00/5 (1 vote)</span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4161266_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4161266xx"></a><img height="16px" width="16px" align="top" src="./Compiler Patterns - CodeProject_files/msg_general.gif" alt="General"></td><td class="subject hover-container"><a class="message-link" name="4161266" parent="0" thread="4161266" href="http://www.codeproject.com/Messages/4161266/My-vote-of.aspx">My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" title="Click to pin message"><img src="./Compiler Patterns - CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Member 4320844</span><span class="date">19-Feb-12  6:34</span>
</div></td><td class="icon"><img border="0" src="./Compiler Patterns - CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4320844">Member 4320844</a></span></td><td class="date"><span>19-Feb-12  6:34&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4161266_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div class="voteform vertical" ownerid="4320844" msgid="4161266" votingtype="GoodOrBad">

</div><img src="./Compiler Patterns - CodeProject_files/t(1).gif" height="1px" width="20px" alt=""></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Hi,<br>
 Thanks for your share, I don't<br>
 know if this article answers my previous question, I hope so.<br>
 Thanks again.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/286121/Compiler-Patterns">Sign In</a>·<wbr><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4161266" title="View Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4161266/My-vote-of.aspx" title="Get permanent link">Permalink</a></td><td style="text-align:right;"><span id="MVF4161266" data-ref="3_4161266" class="rating-label" style="white-space:nowrap;"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4144227_h0" class="header hover-row root">
<td class="subject-line normal  vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4144227xx"></a><img height="16px" width="16px" align="top" src="./Compiler Patterns - CodeProject_files/msg_general.gif" alt="General"></td><td class="subject hover-container"><a class="message-link" name="4144227" parent="0" thread="4144227" href="http://www.codeproject.com/Messages/4144227/My-vote-of.aspx">My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" title="Click to pin message"><img src="./Compiler Patterns - CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Steppenwolfe</span><span class="date">31-Jan-12  13:26</span>
</div></td><td class="icon"><img border="0" src="./Compiler Patterns - CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=1472575">Steppenwolfe</a></span></td><td class="date"><span>31-Jan-12  13:26&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4144227_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div class="voteform vertical" ownerid="1472575" msgid="4144227" votingtype="GoodOrBad">

</div><img src="./Compiler Patterns - CodeProject_files/t(1).gif" height="1px" width="20px" alt=""></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">This is an excellent article.. thank you<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/286121/Compiler-Patterns">Sign In</a>·<wbr><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4144227" title="View Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4144227/My-vote-of.aspx" title="Get permanent link">Permalink</a></td><td style="text-align:right;"><span id="MVF4144227" data-ref="3_4144227" class="rating-label" style="white-space:nowrap;"><span>5.00/5 (1 vote)</span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4097166_h0" class="header hover-row root">
<td class="subject-line normal  vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4097166xx"></a><img height="16px" width="16px" align="top" src="./Compiler Patterns - CodeProject_files/msg_general.gif" alt="General"></td><td class="subject hover-container"><a class="message-link" name="4097166" parent="0" thread="4097166" href="http://www.codeproject.com/Messages/4097166/My-vote-of.aspx">My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" title="Click to pin message"><img src="./Compiler Patterns - CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">RugbyLeague</span><span class="date">7-Dec-11  2:35</span>
</div></td><td class="icon"><img border="0" src="./Compiler Patterns - CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=3278028">RugbyLeague</a></span></td><td class="date"><span>7-Dec-11  2:35&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4097166_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div class="voteform vertical" ownerid="3278028" msgid="4097166" votingtype="GoodOrBad">

</div><img src="./Compiler Patterns - CodeProject_files/t(1).gif" height="1px" width="20px" alt=""></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">An excellent article<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/286121/Compiler-Patterns">Sign In</a>·<wbr><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4097166" title="View Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4097166/My-vote-of.aspx" title="Get permanent link">Permalink</a></td><td style="text-align:right;"><span id="MVF4097166" data-ref="3_4097166" class="rating-label" style="white-space:nowrap;"><span>5.00/5 (1 vote)</span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4096536_h0" class="header hover-row root">
<td class="subject-line normal  vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4096536xx"></a><img height="16px" width="16px" align="top" src="./Compiler Patterns - CodeProject_files/msg_general.gif" alt="General"></td><td class="subject hover-container"><a class="message-link" name="4096536" parent="0" thread="4096536" href="http://www.codeproject.com/Messages/4096536/My-vote-of.aspx">My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" title="Click to pin message"><img src="./Compiler Patterns - CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Jamming1</span><span class="date">6-Dec-11  10:04</span>
</div></td><td class="icon"><img border="0" src="./Compiler Patterns - CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=1675293">Jamming1</a></span></td><td class="date"><span>6-Dec-11  10:04&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4096536_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div class="voteform vertical" ownerid="1675293" msgid="4096536" votingtype="GoodOrBad">

</div><img src="./Compiler Patterns - CodeProject_files/t(1).gif" height="1px" width="20px" alt=""></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Thanks a lot for this beautiful tutorial<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/286121/Compiler-Patterns">Sign In</a>·<wbr><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4096536" title="View Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4096536/My-vote-of.aspx" title="Get permanent link">Permalink</a></td><td style="text-align:right;"><span id="MVF4096536" data-ref="3_4096536" class="rating-label" style="white-space:nowrap;"><span>5.00/5 (1 vote)</span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4096362_h0" class="header hover-row root">
<td class="subject-line normal  vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4096362xx"></a><img height="16px" width="16px" align="top" src="./Compiler Patterns - CodeProject_files/msg_general.gif" alt="General"></td><td class="subject hover-container"><a class="message-link" name="4096362" parent="0" thread="4096362" href="http://www.codeproject.com/Messages/4096362/My-vote-of.aspx">My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" title="Click to pin message"><img src="./Compiler Patterns - CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Harold Bamford</span><span class="date">6-Dec-11  5:49</span>
</div></td><td class="icon"><img border="0" src="./Compiler Patterns - CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=12540">Harold Bamford</a></span></td><td class="date"><span>6-Dec-11  5:49&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4096362_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div class="voteform vertical" ownerid="12540" msgid="4096362" votingtype="GoodOrBad">

</div><img src="./Compiler Patterns - CodeProject_files/t(1).gif" height="1px" width="20px" alt=""></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Just the thing to show to somebody that thinks this stuff is "double-park and do it" easy!<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/286121/Compiler-Patterns">Sign In</a>·<wbr><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4096362" title="View Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4096362/My-vote-of.aspx" title="Get permanent link">Permalink</a></td><td style="text-align:right;"><span id="MVF4096362" data-ref="3_4096362" class="rating-label" style="white-space:nowrap;"><span>5.00/5 (1 vote)</span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4085983_h0" class="header hover-row root">
<td class="subject-line normal  vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4085983xx"></a><img height="16px" width="16px" align="top" src="./Compiler Patterns - CodeProject_files/msg_general.gif" alt="General"></td><td class="subject hover-container"><a class="message-link" name="4085983" parent="0" thread="4085983" href="http://www.codeproject.com/Messages/4085983/My-vote-of.aspx">My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" title="Click to pin message"><img src="./Compiler Patterns - CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">eslipak</span><span class="date">23-Nov-11  5:20</span>
</div></td><td class="icon"><img border="0" src="./Compiler Patterns - CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=2167671">eslipak</a></span></td><td class="date"><span>23-Nov-11  5:20&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4085983_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div class="voteform vertical" ownerid="2167671" msgid="4085983" votingtype="GoodOrBad">

</div><img src="./Compiler Patterns - CodeProject_files/t(1).gif" height="1px" width="20px" alt=""></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Im trying to write my own compiler, so i googled a lot. Your article is one of the best explanation of "hand written" recursive descent compiler. It helped me a lot (even if i needed to read it more than twice... <img src="./Compiler Patterns - CodeProject_files/smiley_wink.gif" align="top" alt="Wink | ;)"> ).<br>
Thanks a lot.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/286121/Compiler-Patterns">Sign In</a>·<wbr><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4085983" title="View Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4085983/My-vote-of.aspx" title="Get permanent link">Permalink</a></td><td style="text-align:right;"><span id="MVF4085983" data-ref="3_4085983" class="rating-label" style="white-space:nowrap;"><span>5.00/5 (1 vote)</span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4089745_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx4089745xx"></a><img height="16px" width="16px" align="top" src="./Compiler Patterns - CodeProject_files/msg_general.gif" alt="General"></td><td class="subject hover-container"><a class="message-link" name="4089745" parent="4085983" thread="4085983" href="http://www.codeproject.com/Messages/4089745/Re-My-vote-of.aspx">Re: My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" title="Click to pin message"><img src="./Compiler Patterns - CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">DQNOK</span><span class="date">28-Nov-11  7:35</span>
</div></td><td class="icon"><img border="0" src="./Compiler Patterns - CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=3403440">DQNOK</a></span></td><td class="date"><span>28-Nov-11  7:35&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4089745_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div class="voteform vertical" ownerid="3403440" msgid="4089745" votingtype="GoodOrBad">

</div><img src="./Compiler Patterns - CodeProject_files/t(1).gif" height="1px" width="38px" alt=""></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4085983);" href="http://www.codeproject.com/Messages/4085983/My-vote-of.aspx"><img src="./Compiler Patterns - CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>You're welcome; and thanks for the compliment (and for the vote).<br>
<br>
I'm not surprised you've had to read it multiple times.  It's a tough subject.  I wish it was easier, just like I wish all of life was easier.  But that's the breaks.<br>
<br>
I worked-on/modified/re-wrote the article for months (in my spare time) before I finally publised it.  Every time I re-read it I made little changes to try to make it easier to read and understand.  Eventually I decided it just needed to be available for folks, even if it wasn't perfect.  I'm glad you found it useful; hopefully others will as well.<br>
<div class="signature">David<br>
---------<br>
<small>Empirical studies indicate that 20% of the people drink 80% of the beer. With C++ developers, the rule is that 80% of the developers understand at most 20% of the language. It is not the same 20% for different people, so don't count on them to understand each other's code. <br>
http://yosefk.com/c++fqa/picture.html#fqa-6.6</small><br>
---------</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/286121/Compiler-Patterns">Sign In</a>·<wbr><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4085983" title="View Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4089745/Re-My-vote-of.aspx" title="Get permanent link">Permalink</a></td><td style="text-align:right;"><span id="MVF4089745" data-ref="3_4089745" class="rating-label" style="white-space:nowrap;"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4081980_h0" class="header hover-row root">
<td class="subject-line normal  vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4081980xx"></a><img height="16px" width="16px" align="top" src="./Compiler Patterns - CodeProject_files/msg_general.gif" alt="General"></td><td class="subject hover-container"><a class="message-link" name="4081980" parent="0" thread="4081980" href="http://www.codeproject.com/Messages/4081980/nice-one.aspx">nice one</a> <a onclick="return Pin(this);" rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" title="Click to pin message"><img src="./Compiler Patterns - CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Shakti Misra</span><span class="date">18-Nov-11  7:49</span>
</div></td><td class="icon"><img border="0" src="./Compiler Patterns - CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4791998">Shakti Misra</a></span></td><td class="date"><span>18-Nov-11  7:49&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4081980_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div class="voteform vertical" ownerid="4791998" msgid="4081980" votingtype="GoodOrBad">

</div><img src="./Compiler Patterns - CodeProject_files/t(1).gif" height="1px" width="20px" alt=""></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Well this was a nice read. Keep it up.<img src="./Compiler Patterns - CodeProject_files/thumbs_up.gif" align="top" alt="Thumbs Up | :thumbsup:"> <br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/286121/Compiler-Patterns">Sign In</a>·<wbr><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4081980" title="View Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4081980/nice-one.aspx" title="Get permanent link">Permalink</a></td><td style="text-align:right;"><span id="MVF4081980" data-ref="3_4081980" class="rating-label" style="white-space:nowrap;"><span>5.00/5 (1 vote)</span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4081952_h0" class="header hover-row root">
<td class="subject-line normal  vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="20px" class="indent"><a name="xx4081952xx"></a><img height="16px" width="16px" align="top" src="./Compiler Patterns - CodeProject_files/msg_general.gif" alt="General"></td><td class="subject hover-container"><a class="message-link" name="4081952" parent="0" thread="4081952" href="http://www.codeproject.com/Messages/4081952/A-good-read.aspx">A good read :)</a> <a onclick="return Pin(this);" rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" title="Click to pin message"><img src="./Compiler Patterns - CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Espen Harlinn</span><span class="date">18-Nov-11  7:22</span>
</div></td><td class="icon"><img border="0" src="./Compiler Patterns - CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=22364">Espen Harlinn</a></span></td><td class="date"><span>18-Nov-11  7:22&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4081952_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div class="voteform vertical" ownerid="22364" msgid="4081952" votingtype="GoodOrBad">

</div><img src="./Compiler Patterns - CodeProject_files/t(1).gif" height="1px" width="20px" alt=""></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Interesting article, I worked my way through Allen I. Holub's Compiler Design in C about 20 years ago - and ended up creating my three first parsers "by hand", before I finally managed to wrap my head around flex and bison. <br>
<br>
I would say that this article is a good place to start when you want to understand parsing, even if you want to use a lexer and a compiler compiler.<br>
<div class="signature"><a href="http://harlinn.com/">Espen Harlinn</a><br>
Senior Architect, Software - Goodtech Projects &amp; Services</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/286121/Compiler-Patterns">Sign In</a>·<wbr><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4081952" title="View Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4081952/A-good-read.aspx" title="Get permanent link">Permalink</a></td><td style="text-align:right;"><span id="MVF4081952" data-ref="3_4081952" class="rating-label" style="white-space:nowrap;"><span>5.00/5 (1 vote)</span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4081969_h0" class="header hover-row">
<td class="subject-line normal  vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="38px" class="indent"><a name="xx4081969xx"></a><img height="16px" width="16px" align="top" src="./Compiler Patterns - CodeProject_files/msg_general.gif" alt="General"></td><td class="subject hover-container"><a class="message-link" name="4081969" parent="4081952" thread="4081952" href="http://www.codeproject.com/Messages/4081969/Re-A-good-read.aspx">Re: A good read :)</a> <a onclick="return Pin(this);" rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" title="Click to pin message"><img src="./Compiler Patterns - CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">DQNOK</span><span class="date">18-Nov-11  7:43</span>
</div></td><td class="icon"><img border="0" src="./Compiler Patterns - CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=3403440">DQNOK</a></span></td><td class="date"><span>18-Nov-11  7:43&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4081969_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div class="voteform vertical" ownerid="3403440" msgid="4081969" votingtype="GoodOrBad">

</div><img src="./Compiler Patterns - CodeProject_files/t(1).gif" height="1px" width="38px" alt=""></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4081952);" href="http://www.codeproject.com/Messages/4081952/A-good-read.aspx"><img src="./Compiler Patterns - CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Thanks!<br>
<br>
<blockquote class="FQ"><div class="FQA">Espen Harlinn wrote:</div>I worked my way through Allen I. Holub's Compiler Design in C about 20 years ago </blockquote><br>
<br>
Me too.  But I ended up using Paul Mann's product instead of learning lex and YACC.<br>
<br>
My problem is that I write parsers so seldom that I completely forget how to use the compiler-compiler products in between projects.  Plus, for this expression evaluator, we needed to avoid using outside code and extra tools (beyond the basic C compiler).<br>
<div class="signature">David<br>
---------<br>
<small>Empirical studies indicate that 20% of the people drink 80% of the beer. With C++ developers, the rule is that 80% of the developers understand at most 20% of the language. It is not the same 20% for different people, so don't count on them to understand each other's code. <br>
http://yosefk.com/c++fqa/picture.html#fqa-6.6</small><br>
---------</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/286121/Compiler-Patterns">Sign In</a>·<wbr><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4081952" title="View Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4081969/Re-A-good-read.aspx" title="Get permanent link">Permalink</a></td><td style="text-align:right;"><span id="MVF4081969" data-ref="3_4081969" class="rating-label" style="white-space:nowrap;"><span>5.00/5 (1 vote)</span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4082009_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td width="56px" class="indent"><a name="xx4082009xx"></a><img height="16px" width="16px" align="top" src="./Compiler Patterns - CodeProject_files/msg_general.gif" alt="General"></td><td class="subject hover-container"><a class="message-link" name="4082009" parent="4081969" thread="4081952" href="http://www.codeproject.com/Messages/4082009/Re-A-good-read.aspx">Re: A good read :)</a> <a onclick="return Pin(this);" rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#" title="Click to pin message"><img src="./Compiler Patterns - CodeProject_files/pin.png" border="0" align="top" alt="Pin" width="13px" height="13px"></a><div class="mobile-only">
	<span class="author">Espen Harlinn</span><span class="date">18-Nov-11  8:29</span>
</div></td><td class="icon"><img border="0" src="./Compiler Patterns - CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=22364">Espen Harlinn</a></span></td><td class="date"><span>18-Nov-11  8:29&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4082009_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"><div class="voteform vertical" ownerid="22364" msgid="4082009" votingtype="GoodOrBad">

</div><img src="./Compiler Patterns - CodeProject_files/t(1).gif" height="1px" width="56px" alt=""></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4081969);" href="http://www.codeproject.com/Messages/4081969/Re-A-good-read.aspx"><img src="./Compiler Patterns - CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div><blockquote class="FQ"><div class="FQA">DQNOK wrote:</div>But I ended up using Paul Mann's product instead of learning lex and YACC.<br></blockquote><br>
I've mostly switched to antlr<br>
<div class="signature"><a href="http://harlinn.com/">Espen Harlinn</a><br>
Senior Architect, Software - Goodtech Projects &amp; Services</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a href="http://www.codeproject.com/script/Membership/LogOn.aspx?rp=/Articles/286121/Compiler-Patterns">Sign In</a>·<wbr><a href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4081952" title="View Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4082009/Re-A-good-read.aspx" title="Get permanent link">Permalink</a></td><td style="text-align:right;"><span id="MVF4082009" data-ref="3_4082009" class="rating-label" style="white-space:nowrap;"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><img src="./Compiler Patterns - CodeProject_files/t(1).gif" border="0" width="1px" height="5px" alt=""></td>
</tr><tr>
<td><table width="100%" cellpadding="2px" cellspacing="0">
<tbody><tr class="footer">
<td><span class="last-visit desktop-only tablet-only">Last Visit: 31-Dec-99  19:00 &nbsp; &nbsp; Last Update: 7-Apr-16  23:54</span></td><td><a rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;prof=False&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed">Refresh</a></td><td style="text-align:right;white-space:nowrap;"><input id="_mbnUrl" type="hidden" value="/Articles/286121/Compiler-Patterns?fid=1666082&amp;df=90&amp;mpp=25&amp;prof=False&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed&amp;fr=14"><span class="nav-link selected">1</span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table>
</div><p class="small-text"><img align="top" src="./Compiler Patterns - CodeProject_files/msg_general.gif" width="16px" height="16px" alt="General"> General &nbsp;&nbsp; <img align="top" src="./Compiler Patterns - CodeProject_files/msg_news.gif" width="16px" height="16px" alt="News"> News &nbsp;&nbsp; <img align="top" src="./Compiler Patterns - CodeProject_files/msg_idea.gif" width="16px" height="16px" alt="Suggestion"> Suggestion &nbsp;&nbsp; <img align="top" src="./Compiler Patterns - CodeProject_files/msg_question.gif" width="16px" height="16px" alt="Question"> Question &nbsp;&nbsp; <img align="top" src="./Compiler Patterns - CodeProject_files/msg_bug.gif" width="16px" height="16px" alt="Bug"> Bug &nbsp;&nbsp; <img align="top" src="./Compiler Patterns - CodeProject_files/msg_answer.gif" width="16px" height="16px" alt="Answer"> Answer &nbsp;&nbsp; <img align="top" src="./Compiler Patterns - CodeProject_files/msg_joke.gif" width="16px" height="16px" alt="Joke"> Joke &nbsp;&nbsp; <img align="top" src="./Compiler Patterns - CodeProject_files/msg_kudos.gif" width="16px" height="16px" alt="Praise"> Praise &nbsp;&nbsp; <img align="top" src="./Compiler Patterns - CodeProject_files/msg_rant.gif" width="16px" height="16px" alt="Rant"> Rant &nbsp;&nbsp; <img align="top" src="./Compiler Patterns - CodeProject_files/msg_admin.gif" width="16px" height="16px" alt="Admin"> Admin &nbsp;&nbsp; </p><p class="small-text">Use Ctrl+Left/Right to switch messages, Ctrl+Up/Down to switch threads, Ctrl+Shift+Left/Right to switch pages.</p>
				

			</div>
			
		</td>
		<td width="170px" class="article-wing-right">
			<div id="ctl00_RightSideBar" class="container-article-info">

                <div id="RHSticky" class="container-article-info-sticky" style="position: static; top: 235px; left: 1071.5px;">
        			


<div class="article-summary">

    


    

    

    
</div>

				    

				    <div style="width:160px;margin: 10px auto;">
					    <div class="msg-160x600" data-format="160x600" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="General-Programming/Algorithms-Recipes/Compilers" data-tags="C, Intermediate, BNF,rating4.5"><div id="div-gpt-ad-lqm.codeproject.site/general-programming/algorithms-recipes/compilers-4" style="height: 600px; width: 160px; box-sizing: border-box; border: 0px; font-size: 0px;"><div id="google_ads_iframe_/6839/lqm.codeproject.site/general-programming/algorithms-recipes/compilers_1__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/6839/lqm.codeproject.site/general-programming/algorithms-recipes/compilers_1" title="3rd party ad content" name="google_ads_iframe_/6839/lqm.codeproject.site/general-programming/algorithms-recipes/compilers_1" width="160" height="600" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:&quot;&lt;html&gt;&lt;body style=&#39;background:transparent&#39;&gt;&lt;/body&gt;&lt;/html&gt;&quot;" style="border: 0px; vertical-align: bottom;"></iframe></div><iframe id="google_ads_iframe_/6839/lqm.codeproject.site/general-programming/algorithms-recipes/compilers_1__hidden__" title="" name="google_ads_iframe_/6839/lqm.codeproject.site/general-programming/algorithms-recipes/compilers_1__hidden__" width="0" height="0" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:&quot;&lt;html&gt;&lt;body style=&#39;background:transparent&#39;&gt;&lt;/body&gt;&lt;/html&gt;&quot;" style="border: 0px; vertical-align: bottom; visibility: hidden; display: none;"></iframe></div></div>
				    </div>

                    

				    

				    

				    

                    <div class="anchorLink gototop" id="gototop">
                        <a id="ctl00_GoToTop" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns#_articleTop">Go to top</a>
                    </div>

				</div>

			</div>
		</td>
		</tr></tbody></table>

		
		<div class="theme1-background" style="height:2px" id="stickyStop"></div>

		<div class="extended tiny-text">
			<div class="row">
				<div class="float-left">
					<a id="ctl00_PermaLink" itemprop="url" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns">Permalink</a> | 
					<a id="ctl00_AdvertiseLink" href="http://developermedia.com/">Advertise </a> |
					<a id="ctl00_PrivacyLink" href="http://www.codeproject.com/info/privacy.aspx">Privacy</a> |
                    <a id="ctl00_TermsOfUseLink" href="http://www.codeproject.com/info/TermsOfUse.aspx">Terms of Use</a> |
					<a id="ctl00_Mobile">Mobile</a>
					<br>
								
					
					Web02 |
					2.8.160406.2 |
					Last Updated 6 Dec 2011								
				</div>

                <div id="ctl00_GoogleTranslate" class="translate float-left"><div class="skiptranslate goog-te-gadget" dir="ltr"><div id=":0.targetLanguage" class="goog-te-gadget-simple" style="white-space: nowrap;"><img src="./Compiler Patterns - CodeProject_files/cleardot.gif" class="goog-te-gadget-icon" style="background-image: url(&quot;https://translate.googleapis.com/translate_static/img/te_ctrl3.gif&quot;); background-position: -65px 0px;"><span style="vertical-align: middle;"><a class="goog-te-menu-value" href="javascript:void(0)"><span>Select Language</span><img src="./Compiler Patterns - CodeProject_files/cleardot.gif" width="1" height="1"><span style="border-left-width: 1px; border-left-style: solid; border-left-color: rgb(187, 187, 187);">​</span><img src="./Compiler Patterns - CodeProject_files/cleardot.gif" width="1" height="1"><span style="color: rgb(155, 155, 155);">▼</span></a></span></div></div></div>      

				<div class="float-right align-right">
					Article Copyright 2011 by DQNOK<br>Everything else
					Copyright © <a href="mailto:webmaster@codeproject.com">CodeProject</a>, 1999-2016 <br>
				</div>

				


<div class="page-width">
Layout: <a id="ctl00_PageWidth_FixedT" title="Fixed width layout" rel="nofollow" class=" active" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?PageFlow=FixedWidth">fixed</a>
|
<a id="ctl00_PageWidth_FluidT" title="Fluid layout" rel="nofollow" href="http://www.codeproject.com/Articles/286121/Compiler-Patterns?PageFlow=Fluid">fluid</a>
</div>



			</div>
		</div>
		

		<br clear="all">
		
			

	</div> 
	</div>
</div>






<script type="text/javascript" language="Javascript" src="./Compiler Patterns - CodeProject_files/jquery.min.js"></script><script type="text/javascript">//<![CDATA[
if (typeof jQuery == 'undefined') {
    document.write(unescape("%3Cscript src='/script/JS/jquery-1.6.2.min.js' type='text/javascript' %3E%3C/script%3E"));
}//]]></script>
<script type="text/javascript" language="Javascript" src="./Compiler Patterns - CodeProject_files/article.min.js"></script>
<script type="text/javascript" language="Javascript" src="./Compiler Patterns - CodeProject_files/element.js"></script>
<script type="text/javascript" language="Javascript" src="./Compiler Patterns - CodeProject_files/navbar.min.js"></script>
<script type="text/javascript" language="Javascript" src="./Compiler Patterns - CodeProject_files/Notifications.min.js"></script>
<script type="text/javascript" language="Javascript">//<![CDATA[
$(document).ready(function () { processCodeBlocks.Initialise('#contentdiv'); });
function googleTranslateElementInit() {  new google.translate.TranslateElement({   pageLanguage: 'en',   layout: google.translate.TranslateElement.InlineLayout.SIMPLE,   autoDisplay: false,   gaTrack: true,   gaId: 'UA-1735123-1'},  'ctl00_GoogleTranslate');}
$(document).ready(function() { anchorAnimate();
$('#RHSticky').sticky($('#stickyStop'));
$('#ctl00_Nav').sticky($('#stickyStop'));
});
$(function ()
                {
                    $('.oauth').click(function () {
                        $this = $(this);
                        href = $this.attr('href');
                        var myWindow = window.open(href, 'popup',
                                    'width=800,height=600,location=0,menubar=0,resizeable=0,scrollbars=0,toolbar=0');
                        myWindow.focus();
                        var timer = setInterval(function () {
                                        if (myWindow.closed) {
                                            clearInterval(timer);
                                            // window.location.reload(); // May do a POST reload, shows a warning
                                            window.location = window.location; // force a GET reload
                                        }
                                    }, 200);
                        return false;
                    });
                });
var oSrchFlt = false, oSrchBox=false,srchBoxFoc=false;
$(document).ready(function() {
 if(InitWatermark)InitWatermark('sb_tb', 'Search for articles, questions, tips');
 var sbar = $('#sb_tb'); 
 var sfilter = $('#SearchFilter');
 if (sbar && sfilter) {
  sfilter.removeClass('popup'); sfilter.hide(); sfilter.removeClass('open');
  sbar.blur(function() {
 if (!oSrchFlt) {sfilter.hide(); sfilter.removeClass('open');}
 srchBoxFoc=false;
 });
  sbar.focus(function() {
 oSrchFlt=false; srchBoxFoc=true;
 sfilter.show(); sfilter.addClass('open');
 });
  sbar.mouseleave(function() { oSrchBox=false; });
  sbar.mouseover(function() { oSrchBox=true; });
  sfilter.mouseleave(function() { oSrchFlt=false; if (!srchBoxFoc&&!oSrchBox) { sfilter.hide(); sfilter.removeClass('open'); }});
  sfilter.mouseover(function() { oSrchFlt=true; });
 }
});
$('#clear-rate_ctl00_RateArticle_RSU').click(function () {    $('#ctl00_RateArticle_RSU').hide(); return false;});$("#ctl00_RateArticle_RateItemWrapper")   .removeClass("container-rating")   .hover( function() { $('#ctl00_RateArticle_RSU').fadeIn('fast'); },            function() { $('#ctl00_RateArticle_RSU').fadeOut('fast'); } );
function PostBack_ctl00_RateArticle_RateItemWrapper() {
  return rateItem(286121,2,1,true,true,0,'LargeStars');
}

                        function getVotesHistogram(objectId, objectTypeId, containerId, loadingId) {
                            if (!$('#' + containerId).attr('alreadyRequested')){
                                $.ajax({
                                    url: '/script/Ratings/Ajax/Histogram.aspx?obid=' + objectId + '&obtid='+objectTypeId,
                                    success: function (data) {
                                        $('#' + containerId).html(data);
                                        $('#' + loadingId).hide();
                                    }
                                });
                                $('#' + containerId).attr('alreadyRequested', 'true');
                            }
                        }
$(document).ready(function() {   new starRating('#ctl00_RateArticle_VoteFormDiv', PostBack_ctl00_RateArticle_RateItemWrapper,'ctl00_RateArticle');
  $('#ctl00_RateArticle_RB').mouseenter(function() {     getVotesHistogram(286121,2   ,'ctl00_RateArticle_Histogram','ctl00_RateArticle_Loading');  })})
$(document).ready(function() { $('#ctl00_RateArticle_SubmitRateBtn').hide(); });
$(document).ready(function() { $('#ctl00_RateArticle_SubmitRateBtn').hide(); });function ChkRtctl00_RateArticle(){}

forumDir = '/script/Forums/';
allowReporting = false;
allowRating = false;
allowRatingDisplay = true;
var smoothScroll = true;
Selected        = -1;
oldTitle        = document.title;
minMessageScore = 1;
minMessageScore = 5;
abuseScore      = -2;
spamScore       = -1;
getRatingUrl    = '/script/Ratings/Ajax/GetRatings.aspx';
getRatingRefKey = 'obrs';


//]]>
</script><iframe src="./Compiler Patterns - CodeProject_files/container.html" style="visibility: hidden; display: none;"></iframe>



<canvas id="cv1" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./Compiler Patterns - CodeProject_files/translate_24dp.png" width="20" height="20"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">Original text</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">Contribute a better translation</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div><canvas id="cv2" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><iframe frameborder="0" class="goog-te-menu-frame skiptranslate" style="visibility: visible; box-sizing: content-box; width: 1030px; height: 263px; display: none;"></iframe><iframe id="google_osd_static_frame_4678879285149" name="google_osd_static_frame" style="display: none; width: 0px; height: 0px;"></iframe></body></html>